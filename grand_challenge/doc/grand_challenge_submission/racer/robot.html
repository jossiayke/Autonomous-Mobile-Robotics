<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>grand_challenge_submission.racer.robot API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Robot">Robot</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Robot.__init__">Robot</a>
                        </li>
                        <li>
                                <a class="function" href="#Robot.plot_path">plot_path</a>
                        </li>
                        <li>
                                <a class="function" href="#Robot.start">start</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
grand_challenge_submission<wbr>.racer<wbr>.robot    </h1>

                
                        <input id="mod-robot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-robot-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># General Python packages</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">cv2</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">gpio</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">serial</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">threading</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">queue</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="n">custom_module_path</span> <span class="o">=</span> <span class="s1">&#39;/home/pi/ENPM701-assignments/grand_challenge_submission/&#39;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">custom_module_path</span><span class="p">)</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="c1"># This is the main interface script that will control the robot</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="c1"># as it traverses in the challenge arena.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="c1"># Below are the necessary imports for its different features</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="c1"># For visual perception tasks</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span> <span class="nn">Perception</span> <span class="kn">import</span> <span class="n">cntr_bbox</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="c1"># Imports for sending pictures via email</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span> <span class="nn">smtplib</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span> <span class="nn">smtplib</span> <span class="kn">import</span> <span class="n">SMTP</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span> <span class="nn">smtplib</span> <span class="kn">import</span> <span class="n">SMTPException</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">import</span> <span class="nn">email</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">from</span> <span class="nn">email.mime.image</span> <span class="kn">import</span> <span class="n">MIMEImage</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">import</span> <span class="nn">imaplib</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="k">class</span> <span class="nc">Robot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">    A class defining basic attributes of Baron robot that</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    will be autonomously achieving objective</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">    </span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    Attributes:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        name (str): Name of robot</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">        _x (float): horizontal position of robot from start postion</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        _y (float): vertical position of robot from start position</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">        _yaw (float): yaw orientation from +x as horizontal [0,180] or (-180,0)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        _travel(float): estimating the distance to drive and reach block</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">        _turn (float): keeps the next turn needed by block</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">        _depth (float): measures distance of obstacle in front of robot from image</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">        _path (list): stores the path traveled by robot as list of (x,y) points and yaw</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        _pwms (list): stores a list of pwms for the robot motors</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">        _dutycycle (dict): holds the baseline pwm dutycycle for forward,reverse,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">                           pivotleft and pivotright</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">        _success (bool): keeps track whether a given task is successful or not</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">        _gripper_state (str): stores gripper duty cycle state as opened or closed</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">        _order(list): List of blocks to pickup</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">        _end_game (bool): tells competition is over by victory or failure</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">        _order_no (int): keeps track of number of orders completed</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        _block_now (str): the block being pursued now</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">        _task_now (str): keeps track of the task being completed at the moment</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        _actions (dict): holding list of all service actions robot performs with bool</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">                         on which process is being done at a given time</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        _status (dict): a dictionary keeping track of completed actions along with</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">        _img_frame (img): saves current image frame</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        _out (cv2 video obj): gather all frames into a video</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">        _logger (log): log statements for debuging and status over the terminal</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        _kp (float): proportional gain</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        _ki (float): integral gain</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        _kd (float): derivative gain</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        _direction (str): tells weather robot is moving forward or reverse</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        _event (event): event object to end the thread call</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        _pause_event (event): event object to pause and resume thread</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">        imu_reader (thread): threading object to read from imu during forward run</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">        _ser (serial): object reading serial input streams from imu sensor</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">        _img_saved (img): keeping track of saved image to send in an email</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">        _survey_loc (List): containes x,y locations for the robot to navigate and scan</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">                            so that to extract toy blocks for mission</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">        </span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="c1"># define the codec and create VideoWriter object</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;XVID&#39;</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="c1"># Gripper States</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="n">grip_state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="mf">2.5</span><span class="p">),(</span><span class="s1">&#39;opened&#39;</span><span class="p">,</span><span class="mf">7.5</span><span class="p">)])</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="c1"># Matrix for Image frame</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">480</span><span class="o">*</span><span class="mi">640</span><span class="o">*</span><span class="mi">3</span><span class="p">,),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="c1"># define the codec and create VideoWriter object</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;XVID&#39;</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="c1"># Open .txt file to save data</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;robot_path_final.txt&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="n">dutyset</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span><span class="mi">70</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;rev&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]),(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)]</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>    <span class="n">duty</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dutyset</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="n">font</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_COMPLEX_SMALL</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="c1"># turn angel</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="n">turn</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="c1"># detect radius</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    <span class="n">bbox_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>    <span class="c1"># Initialize FL and BR button count</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="n">counterBR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="n">counterFL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>    <span class="n">buttonFL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="c1"># Proportional Control Gain</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>    <span class="n">Kp</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>    <span class="n">Ki</span> <span class="o">=</span> <span class="mf">0.05</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>    <span class="n">Kd</span> <span class="o">=</span> <span class="mf">0.08</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>    <span class="c1"># Important locations in map in units of feet</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>    <span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>    <span class="n">start_pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>    <span class="n">clutter_env</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="n">const_zone</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.25</span><span class="p">,</span><span class="mf">6.5</span><span class="p">]</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>    
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>    <span class="c1"># create object to read camera</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>    <span class="n">video</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>    <span class="n">frame_center</span> <span class="o">=</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span><span class="mi">240</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">cy</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">frame_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="n">img_folder</span> <span class="o">=</span> <span class="s1">&#39;challenge_pics&#39;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>    <span class="c1"># Environment assessment points</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>    <span class="n">scan_spots</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">8</span><span class="p">)]</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="c1"># Global x, y, positions and yaw from fixed reference</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>    <span class="c1"># frame (0,0)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="n">global_x</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="n">global_y</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>    <span class="n">global_yaw</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        Initialize Robot attributes</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        </span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        Args:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">            name: str - takes name of robot</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        </span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        Returns:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">            None</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_travel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_order_no</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;driving&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;rotating&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;picking&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;placing&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;localizing&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;returning&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;scanning&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)])</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;started&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;picked_up&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;found&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;placed&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;finished&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;arrived&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)])</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s1">&#39;grand_chall_vid.avi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fourcc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">))</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ki</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">imu_reader</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial_straight</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,))</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;/dev/ttyUSB0&#39;</span><span class="p">,</span> <span class="mi">19200</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_survey_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_spots</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="c1"># Set up logger with Debug initially</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="c1"># Create console handler and set level to debug</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="c1"># log terminal messages to a file</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;gc_log_3.log&#39;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="c1"># Create formatter</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="c1"># Add formatter to handler</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="c1"># Add console handler to logger</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="c1"># Initialize gpios and pwms</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>    <span class="nd">@property</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>    
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Initialize gpio pins and set pwms to command DC motors, encoders and</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        servo</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        </span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        Args:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">            None</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        </span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        Returns:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">            None</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">BOARD</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="c1"># Setup GPIO pin(s)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># Servo</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN1</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN2</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN3</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN4</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull_up_down</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PUD_UP</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull_up_down</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PUD_UP</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="c1"># initialize pwm signal to control motor</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>        <span class="n">pwm01</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># BackLeft motor</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="n">pwm11</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># FrontLeft motor</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="n">pwm22</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># FrontRight motor</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        <span class="n">pwm02</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># BackRight motor</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>        <span class="n">pwmS</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># Servo</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span> <span class="o">=</span> <span class="p">[</span><span class="n">pwm01</span><span class="p">,</span><span class="n">pwm11</span><span class="p">,</span><span class="n">pwm22</span><span class="p">,</span><span class="n">pwm02</span><span class="p">,</span><span class="n">pwmS</span><span class="p">]</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>        
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="k">for</span> <span class="n">pwm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="k">def</span> <span class="nf">_pwmZero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">        Stops motors by zeroing pwm values in all pins</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        controlling DC motors</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        </span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        Args:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">            None</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        </span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">        Returns:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">            None</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="k">def</span> <span class="nf">_gameover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        Terminates run by stopping pwms and cleaning up</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        gpio pins</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">        </span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        Args:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">            None</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        </span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">        Returns:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">            None</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="k">for</span> <span class="n">pwm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">        Commands DC motors to drive robot forward by sending</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        </span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        Args:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">            None</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">        </span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">        Returns:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">            None</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="c1"># Left wheels</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="c1"># Right wheels</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        Commands DC motors to drive robot in reverses by sending</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        </span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        Args:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">            None</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        </span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        Returns:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">            None</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="c1"># Left wheels</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="c1"># Right wheels</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>    <span class="k">def</span> <span class="nf">_pivotleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        Commands DC motors to pivot robot left by sending</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">        </span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">        Args:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">            None</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">        </span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        Returns:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">            None</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="c1"># Left wheels</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>        <span class="c1"># Right wheels</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>    <span class="k">def</span> <span class="nf">_pivotright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        Commands DC motors to pivot robot right by sending</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        </span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        Args:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">            None</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        </span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        Returns:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">            None</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="c1"># Left wheels</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="c1"># Right wheels</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>    <span class="k">def</span> <span class="nf">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">duty_cycle</span><span class="p">):</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        Commands servo motors to open and close gripper by sending</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">        </span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        Args:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">            None</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        </span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        Returns:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">            None</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">servo_img</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">())</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="c1">#cntr_bbox.img_show(&quot;Servo status&quot;,self._img_frame)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>    <span class="k">def</span> <span class="nf">_picam_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">        Calls picamera object to take image frame from the pi camera</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">        and applies corrections by flipping to reflect reality</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        </span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        Args:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">            None</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        </span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        Returns:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">            None</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="c1"># Take picture with camera</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;bgr&quot;</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">480</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="k">def</span> <span class="nf">_mask_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageHSV</span><span class="p">):</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">==</span> <span class="s1">&#39;green&#39;</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="c1"># Trail Green Bock - LAB</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="n">minHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">46</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">121</span><span class="p">])</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="n">maxHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">255</span><span class="p">])</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">==</span> <span class="s1">&#39;red&#39;</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>            <span class="c1"># Trail Red block - LAB</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>            <span class="n">minHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">151</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">147</span><span class="p">])</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="n">maxHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">])</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">==</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>            <span class="c1"># Trail Blue block - LAB</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>            <span class="n">minHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">72</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">97</span><span class="p">])</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="n">maxHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">126</span><span class="p">,</span><span class="mi">188</span><span class="p">,</span><span class="mi">212</span><span class="p">])</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="n">maskHSV</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">imageHSV</span><span class="p">,</span> <span class="n">minHSV</span><span class="p">,</span> <span class="n">maxHSV</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">return</span> <span class="n">maskHSV</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>    
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>    <span class="k">def</span> <span class="nf">_prep_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        Processes images by applying HSV masking and gaussian blur</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        for use by latter object detection functions</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        </span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        Args:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">            None</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        </span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        Returns:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">            None</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>    
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>         <span class="c1"># Convert image from BGR to HSV space</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="n">imageHSV</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="c1"># mask the green light from HSV and convert to grayscale</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_color</span><span class="p">(</span><span class="n">imageHSV</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="c1"># Mask HSV masked image of arrow</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="n">blurred</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">mask</span><span class="p">,(</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="k">return</span> <span class="n">blurred</span> 
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="k">def</span> <span class="nf">_grip_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">        Processes images by applying a rectangular mask over desired</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">        region of interest to verify whether gripper has held toy block </span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">        </span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        Args:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">            None</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        </span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        Returns:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">            self._image_frame (img): Masked image</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inside Grip Checker Function&quot;</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>        <span class="c1"># Create a mask of gripped block in image</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>        <span class="c1"># Save the shape of the image array</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="c1"># Create mask of image just like picture </span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>        <span class="c1"># Create a white rectangle</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span>  <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="c1"># Extract the image that aligns in the rectangle</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>    <span class="k">def</span> <span class="nf">_wait2start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">        Waits for the competition start QR code to be visible,</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">        and reads QR code in, which if corresponds to &quot;ENPM701&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        returns a True boolean to begin competition</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        </span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">        Args:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">            None</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        </span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        Returns:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">            start (bool): True/False based on detection of expected QR</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="c1"># Define detector</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="n">detector</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">QRCodeDetector</span><span class="p">()</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="c1"># Check if program start initiated</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for start cue . . . &quot;</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture_continuous</span><span class="p">(</span><span class="n">cntr_bbox</span><span class="o">.</span><span class="n">rawCapture</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;bgr&quot;</span><span class="p">,</span> <span class="n">use_video_port</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                <span class="c1"># grab the current frame</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detectAndDecode</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="k">if</span><span class="p">(</span><span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)):</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">tuple</span><span class="p">(</span><span class="n">bbox</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="n">thickness</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">)),</span><span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                    <span class="k">pass</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>                        
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="c1"># Show resutls to the screen</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;QR Code detector&quot;</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                <span class="c1"># write frame into file</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                <span class="c1"># clear the stream in preparation for the next frame</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">rawCapture</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="c1"># Break out of loop by pressing the q key</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="k">if</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)):</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Program Terminated&quot;</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>                    <span class="k">break</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;ENPM701&quot;</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cue Received </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;@&#39;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Grand Challenge! </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                    <span class="n">start</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>                    <span class="k">break</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>            
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="k">return</span> <span class="n">start</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="nf">_email_media</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>    
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="c1"># Take a picture of gripped block to email</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="c1"># Append status of servo on image</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">servo_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="c1"># Save to designated directory</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">img_folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="c1">#time.sleep(1)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="c1"># Read saved image</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="n">img_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">img_folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s1">.png&#39;</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="c1"># send email to user with images</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="n">smtpUser</span> <span class="o">=</span> <span class="s1">&#39;ykebede2@terpmail.umd.edu&#39;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="n">smtpPass</span> <span class="o">=</span> <span class="s1">&#39;QwE@$d1219&#39;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="n">toAdd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ENPM809TS19@gmail.com&#39;</span><span class="p">,</span><span class="s1">&#39;yosephcollege@gmail.com&#39;</span><span class="p">]</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="n">fromAdd</span> <span class="o">=</span> <span class="n">smtpUser</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="n">f_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> %b @ %H:%M&#39;</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="n">subject</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ENPM701-GrandChallenge-</span><span class="si">{</span><span class="n">f_time</span><span class="si">}</span><span class="s1">-yosephK-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromAdd</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="s2">&quot;Image @ &quot;</span> <span class="o">+</span> <span class="n">f_time</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">mime</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MIMEText</span><span class="p">(</span><span class="s2">&quot;Baron Robot image: &quot;</span> <span class="o">+</span> <span class="n">f_time</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s1">&#39;smtp.gmail.com&#39;</span><span class="p">,</span> <span class="mi">587</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">smtpUser</span><span class="p">,</span> <span class="n">smtpPass</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">fromAdd</span><span class="p">,</span> <span class="n">toAdd</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Email delivered!&quot;</span><span class="p">)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>    
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    <span class="k">def</span> <span class="nf">_meter2encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">        Reads in distance values in meters and converts to</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">        encoder counts</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">        </span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        Args:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">            None</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        </span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">        Returns:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">            encod (int): converted encoder counts from distance in m </span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="n">encod</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0325</span><span class="p">))</span><span class="o">*</span><span class="mi">960</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="k">return</span> <span class="n">encod</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>    
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>    <span class="k">def</span> <span class="nf">_encoder2meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encd</span><span class="p">):</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">        Reads in encoder values and converts them to meters</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        </span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        Args:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">            None</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">        </span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        Returns:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">            cms (float): converted encoder counts to distance in m </span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">((</span><span class="n">encd</span> <span class="o">/</span> <span class="mi">960</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0325</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="k">return</span> <span class="n">dist</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>    <span class="k">def</span> <span class="nf">_cm2encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        Reads in distance values in centimeters and converts to</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        encoder counts</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        </span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        Args:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">            None</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        </span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">        Returns:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">            encod (int): converted encoder counts from distance in cms </span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">x_dist</span><span class="o">/</span><span class="mi">100</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="n">encod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter2encoder</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="k">return</span> <span class="n">encod</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>    <span class="k">def</span> <span class="nf">_encoder2cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encd</span><span class="p">):</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        Reads in encoder values and converts them to centimeters</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        </span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        Args:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">            None</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        </span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        Returns:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">            cms (float): converted encoder counts to distance in cms </span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2meter</span><span class="p">(</span><span class="n">encd</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">cms</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">dist</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">return</span> <span class="n">cms</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="k">def</span> <span class="nf">_feet2encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        Reads in distance values in feet and converts to</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        encoder counts</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        </span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        Args:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">            None</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        </span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">        Returns:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">            encod (int): converted encoder counts from distance in feet </span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">*</span> <span class="mf">0.3048</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="n">encod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter2encoder</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="k">return</span> <span class="n">encod</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>    
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>    <span class="k">def</span> <span class="nf">_encoder2feet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_encod</span><span class="p">):</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">        Reads in encoder values and converts to</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        feet</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        </span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        Args:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">            None</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">        </span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">        Returns:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">            feet (float): converted encoder counts from distance in feet </span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="n">meter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2meter</span><span class="p">(</span><span class="n">x_encod</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="n">feet</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">meter</span> <span class="o">*</span> <span class="mf">3.28084</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="k">return</span> <span class="n">feet</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>    <span class="k">def</span> <span class="nf">_feet2cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">        Reads in distance values in feet and converts to</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">        encoder counts</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">        </span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">        Args:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">            None</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">        </span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">        Returns:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">            encod (int): converted encoder counts from distance in feet </span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mf">2.54</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="k">return</span> <span class="n">dist</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>    <span class="k">def</span> <span class="nf">_cm2feet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        Reads in distance values in feet and converts to</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">        encoder counts</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">        </span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">        Args:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">            None</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">        </span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        Returns:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">            encod (int): converted encoder counts from distance in feet </span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="mf">2.54</span><span class="p">)),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="k">return</span> <span class="n">dist</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>    <span class="k">def</span> <span class="nf">_imu_serial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        Reads in serial robot&#39;s yaw angle value from imu sensor, cleans buffer,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        and converts it into a float data type. Convers reading from 0-360 to</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        -180 &lt; yaw &lt; 180.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        </span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        Args:</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">            None</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        </span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        Returns:</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">            self._yaw (float): robots yaw in degrees</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">reset_input_buffer</span><span class="p">()</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                <span class="c1"># Read for imu from serial</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="c1">#                 if cnt &gt;5:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                    <span class="c1"># Strip serial stream of extra characters</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;b&#39;&quot;</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>                    <span class="c1"># Return float</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>                    
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">line</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                        
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="n">line</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imu Error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="k">def</span> <span class="nf">_imu_serial_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">queue</span><span class="p">):</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        Reads in serial robot&#39;s yaw angle value from imu sensor, cleans buffer,</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">        and converts it into a float data type. Convers reading from 0-360 to</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">        -180 &lt; yaw &lt; 180.</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">        </span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        Only difference from self._imu_serial() is that this is run in a separate</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">        thread which is controlled by events to start, pause, and stop function call </span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">        </span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">        Args:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">            None</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">        </span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        Returns:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">            self._yaw (float): robots yaw in degrees</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">reset_input_buffer</span><span class="p">()</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                    <span class="c1"># Read for imu from serial</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;b&#39;&quot;</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                            <span class="c1"># Return float</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                            
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">line</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                                
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                            <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imu Error inside thread: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>    
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="k">def</span> <span class="nf">_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        Reads in serial robot&#39;s distance from an obstacle using ultrasonic sensor by</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">        sending a trigger pulse and listening the returning echo to compuse the separation</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">        distance from nearby object using triangulation technique. Then it saves computed</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">        distance in self._depth</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        </span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        Args:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">            None</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">        </span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        Returns:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">            None</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="n">pulse_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">pulse_end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="c1"># Define pin allocations</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="n">trig</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="n">echo</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="c1"># Setup GPIO board &amp; pins</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">echo</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="c1"># Ensure output has no value</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="c1"># Generate trigger pulse</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.00001</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="c1"># Generate echo time signal</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>        <span class="k">while</span> <span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="n">pulse_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="k">while</span> <span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="n">pulse_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>            
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>        <span class="n">pulse_duration</span> <span class="o">=</span> <span class="n">pulse_end</span> <span class="o">-</span> <span class="n">pulse_start</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>        
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="c1"># Convert time to distance</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="n">distance</span> <span class="o">=</span> <span class="n">pulse_duration</span> <span class="o">*</span> <span class="mi">17150</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>        
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="k">def</span> <span class="nf">_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">        Reads in direction of rotation requested, and starts</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">        rotating the motors accordingly to achieve desired orientation.</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        </span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        </span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        Args:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">            None</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        </span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        Returns:</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">            None</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pivotright</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pivotleft</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="k">def</span> <span class="nf">_dist_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">        Reads in radius of bounding box from bbox detector function, and </span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">        plugs radius into precomputed correlation function to estimate the</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        depth of toy block from robot.</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">        </span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        Assigns results to self._travel and saves image showing value of distance</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">        appended to it in self._img_frame and writes frame to video object self._out</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">        </span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        Args:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">            None</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">        </span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">        Returns:</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">            None</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="c1"># Take image with picamera</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="c1"># Plug in pixel size into depth equation</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0099</span> <span class="o">*</span> <span class="n">bbox_radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.8846</span><span class="o">*</span><span class="n">bbox_radius</span><span class="p">)</span> <span class="o">+</span> <span class="mf">103.47</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_travel</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="c1"># Append image of estimated distance on image frame</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="p">)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>            <span class="c1"># save image into video object</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="k">def</span> <span class="nf">_corner_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">origImg</span><span class="p">):</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="c1"># Create a list to store the x,y location of points</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="n">pts_loc</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="c1"># Detect corners from image</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="k">if</span> <span class="n">corners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int0</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>            <span class="c1"># identify location of corners in image</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                <span class="c1"># Extract x,y coordinate of points</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>                <span class="n">pts_loc</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                <span class="c1"># Draw circle ontop of original image</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">origImg</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="c1"># Create a column vector from pts list</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="n">pts_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts_loc</span><span class="p">)</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>            
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">pts_loc</span><span class="p">,</span> <span class="n">origImg</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">pts_loc</span><span class="p">,</span> <span class="n">origImg</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>    
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="k">def</span> <span class="nf">_center_det</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pt_list</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="c1"># Extract x,y points from pt_list</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">pt_list</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">pt_list</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="c1"># Determine the min and max width &amp; height values</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="c1"># of the points, as if to drow rectangle around arrow</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>        <span class="n">y_min</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">y_max</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="c1"># Store height of bounding box</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="n">vert_dst</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="c1"># Store width of bounding box</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="n">horz_dst</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="c1"># Compute and store half dimensions of</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="c1"># box, will come later when determining</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="c1"># arrow direction</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="n">y_half</span> <span class="o">=</span> <span class="n">vert_dst</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y_min</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="n">x_half</span> <span class="o">=</span> <span class="n">horz_dst</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_min</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>        <span class="c1"># Store center of the block</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="c1">#center = [int(round(x_half)), int(round(y_half))]</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="n">center</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x_half</span><span class="p">)))</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="n">center</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y_half</span><span class="p">)))</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="c1"># Estimate radius</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_half</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_half</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_radius</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>    <span class="k">def</span> <span class="nf">_bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">        Reads in an image, and then applies preprocessing functions that mask and</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">        blur image. Then, attempts to detect corners of an object in frame, and if </span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">        successful it will run further computation to determine the center and radius</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">        of detected object. Finally adds the draws the bounding circle and center point</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">        as well as write computed values on original image</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">        </span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">        Assigns results to self._travel and saves image showing value of distance</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">        appended to it in self._img_frame and writes frame to video object self._out</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">        </span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">        Args:</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">            image (image): Original colored image taken in from camera</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">        </span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">        Returns:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">            bbox_radius (float): Radius of bounding circle detecting object</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">            len(pts_loc) (int): The number of corner points identified on object from frame</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="c1"># Initialize list to save corner points and bbox radius</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="n">bbox_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="n">pts_loc</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="c1"># Take image using camera frame</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="c1"># Prepare image by masking and blurring</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="n">image_blurred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">()</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="c1"># Extract bbox radius from image</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="n">image_blurred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="c1">#         # Detect corners from image</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="c1">#         img_crnr, pts_loc, image, var = self._corner_detect(image_blurred, self._img_frame)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="c1">#         </span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="c1">#         if var is not None:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="c1"># </span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="c1">#             # Check if corners are detected</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="c1">#             if len(pts_loc) &gt; 3:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="c1">#                 ## Draw contours over an image, if available</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="c1">#                 center, bbox_radius = self._center_det(pts_loc, center)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="c1"># </span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="c1">#                 block_coordinate = &quot;(&quot; + str(center[0]) + &quot;,&quot; + str(center[1]) + &quot;)&quot;</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="c1">#                 </span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="c1">#                 # Draw circle ontop of original image</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="c1">#                 cv2.circle(image, tuple(center), bbox_radius, (0,255,255),2)</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="c1">#                 cv2.circle(image, tuple(center), 0,(0,0,255),5)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="c1">#                 cv2.putText(image,block_coordinate,(0,int(self.cy)),self.font,2,(0,0,0),2)</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="c1">#                 </span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="c1">#                 # Draw a cross at center of frame</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="c1">#                 cv2.line(image,(self.frame_center[0]-100, self.frame_center[1]),(self.frame_center[0]+100, self.frame_center[1]), (0,0,0))</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="c1">#                 cv2.line(image,(self.frame_center[0], self.frame_center[1]-100),(self.frame_center[0], self.frame_center[1]+100), (0,0,0))</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="c1">#                 </span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="c1">#                 success = True</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="c1">#                 </span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="c1">#                 self._logger.info(f&quot;{self._block_now} block is detected&quot;)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="c1">#                 time.sleep(1)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="c1">#                             </span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="c1">#                 return image, center, bbox_radius, success</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="c1">#             </span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="c1">#             else:</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="c1">#                 self._logger.info(&quot;Not clearly detected&quot;)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="c1">#                 success = False</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="c1">#                 </span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="c1">#                 return image, center, bbox_radius, success</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="c1">#     </span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="c1">#         else:</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="c1">#             print(&quot;No object of interest in scene&quot;)</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="c1">#             return image, 0, 0, success</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Radius </span><span class="si">{</span><span class="n">bbox_radius</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of corners/edges detected are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pts_loc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>        <span class="c1">#return bbox_radius, center #, len(pts_loc),</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>    
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>    <span class="k">def</span> <span class="nf">_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">deg_diff</span><span class="p">,</span><span class="n">just_turn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">steady</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        This function pivots robot to deseired angle</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        Args:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">            deg_diff (float): Amount of angular rotation to turn.</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">                      Default value is self._turn parameter</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">            </span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">        Returns:</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">            None</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">            </span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inside pivot function&quot;</span><span class="p">)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;rotating&#39;</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="c1"># To know the direction of turn. Notation based on camera object detection</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="c1"># notation</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="c1">#         thresh = 0.8</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>        <span class="k">if</span> <span class="n">deg_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="c1">#             thresh = -0.8</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="c1"># Initialize change in time for derivative control</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="n">zones</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>        
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="n">yaw_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>        
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="c1"># Angle diff initialized</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="n">yaw_diff0</span> <span class="o">=</span> <span class="n">deg_diff</span> <span class="o">+</span> <span class="mf">0.001</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">yaw_final</span> <span class="o">=</span> <span class="n">yaw_start</span> <span class="o">+</span> <span class="n">deg_diff</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="n">yaw_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="n">yaw_start</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="n">yaw_diff_old</span> <span class="o">=</span> <span class="n">yaw_diff</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Needed final yaw is </span><span class="si">{</span><span class="n">yaw_final</span><span class="si">}</span><span class="s2"> degrees&quot;</span><span class="p">)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">yaw_current</span> <span class="o">=</span> <span class="n">yaw_start</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="c1"># Lower and upper bounds of dutycycle initialized</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">90</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="c1"># Divide the distance traveled into three zones</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="n">trip</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">yaw_diff</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">]</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="c1"># Variables for PID control</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="n">derivative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>        <span class="n">yaw_diff_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="n">yaw_diff_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="n">window_size</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                <span class="c1">#prcnt = abs(self._imu_serial() - yaw_start)/deg_diff</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                <span class="n">prcnt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">yaw_diff</span><span class="o">/</span><span class="n">yaw_diff0</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                <span class="c1"># Adopting moving average</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="c1">#                 cumsum = np.cumsum(yaw_diff_list)</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="c1">#                 cumsum[window_size:] = cumsum[window_size:] - cumsum[:-window_size]</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="c1">#                 moving_avg = cumsum[window_size - 1:] / window_size</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                <span class="k">if</span> <span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prcnt</span> <span class="o">&lt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                <span class="k">elif</span> <span class="n">prcnt</span> <span class="o">&gt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                    
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                <span class="c1"># Save robots pose by saving its x, yaw position            </span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">],</span> <span class="n">lower_dc</span><span class="p">,</span> <span class="n">upper_dc</span><span class="p">)</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                    
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                    
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">:</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>                    
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                    <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">yaw_diff_old</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="o">-</span><span class="n">yaw_diff_old</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)):</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="c1">#                     if (abs(yaw_diff - np.mean(yaw_diff_list[-3:-1])) &lt; 5):</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="c1">#                     if abs(yaw_diff) &gt;= 0.5:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current yaw </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span><span class="si">}</span><span class="s2">; Angle turning towards </span><span class="si">{</span><span class="n">yaw_final</span><span class="si">}</span><span class="s2">; Error yaw </span><span class="si">{</span><span class="n">yaw_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotright</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">])</span> 
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotleft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">])</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>                        <span class="k">else</span><span class="p">:</span>                        
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotright</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span> 
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotleft</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>                        
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>                    <span class="n">total_turn</span> <span class="o">=</span> <span class="n">yaw_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span><span class="c1">#self.queue.get() </span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current yaw </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span><span class="si">}</span><span class="s2">, Total turn </span><span class="si">{</span><span class="n">total_turn</span><span class="si">}</span><span class="s2">, Final Angle diff </span><span class="si">{</span><span class="n">yaw_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Robot turn done&quot;</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>                    
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                    <span class="n">yaw_diff</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>                    
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">just_turn</span><span class="p">:</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>                        <span class="k">if</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>                        <span class="c1">#if (abs(yaw_diff) &gt;= 0.):</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>                        <span class="c1"># Check for overshooting</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>                        
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>                            <span class="n">deg_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>                            
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>                            <span class="k">if</span> <span class="n">deg_diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>                            
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                                    
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="c1">#                             time.sleep(1)</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                                    <span class="c1"># Return pwm dutcycle back to base</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                                    
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>                                    
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="c1">#                         if abs(yaw_diff) &gt;= 0.6:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="c1">#                             self._dutycycle[self._direction] = 70</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="c1">#                                 </span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="c1">#                             self._pivot(yaw_diff,steady=True)</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>                    
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="c1">#                     elif abs(yaw_diff) &gt; 0.6:</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="c1">#                         </span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="c1">#                         # Return pwm dutcycle back to base</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="c1">#                         self._dutycycle[self._direction] = 70</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="c1">#                         </span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="c1">#                         self._pivot(yaw_diff)            </span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>                    <span class="c1"># Return pwm dutcycle back to base</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                    
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>                    <span class="c1"># Save robots pose by saving its x, yaw position            </span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">(),</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Final orientation reached&quot;</span><span class="p">)</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                    <span class="k">break</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>            
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                <span class="n">yaw_diff_old</span> <span class="o">=</span> <span class="n">yaw_diff</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                <span class="n">yaw_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="n">yaw_diff_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>                
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="c1">#                 if ((np.sign(yaw_diff) != np.sign(yaw_diff_old)) and (abs(yaw_diff-yaw_diff_old) &lt; 3)):</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="c1">#                     yaw_diff_list.pop()</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="c1">#                     yaw_diff = yaw_diff_old</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>                <span class="c1"># Filtering data via median thresholding</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="c1">#                 if len(yaw_diff_list) &gt; 6:</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="c1">#                     median = np.median(yaw_diff_list[-5:-1])    </span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="c1">#                 else:</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="c1">#                     median = np.median(yaw_diff_list[-3:-1])</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="c1">#                 if (abs(yaw_diff - median) &lt; 5):</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="c1">#                     yaw_diff_list.append(yaw_diff)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="c1">#                 else:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="c1">#                     yaw_diff_list.pop()</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="c1">#                     yaw_diff = yaw_diff_old</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="c1">#                     yaw_diff_list.append(yaw_diff_old)</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pivot Interrupted&quot;</span><span class="p">)</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pivot Finished&quot;</span><span class="p">)</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>      
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>    <span class="k">def</span> <span class="nf">_go2block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">eucl_disp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">just_drive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">steady</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">        This function drives the robot in a straight path, either forward</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        or reverse</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">        Args:</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">            direction: Direction of drive, forward or reverse</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">            </span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">        Returns:</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">            None</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">            </span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;driving&#39;</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going toward block (go2block)&quot;</span><span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>        
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="c1"># Divide the separation distance into three zones</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="c1"># First zone is 70% into drive</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>        <span class="c1"># Second zone is 20%</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="c1"># Third zone is the last 10%</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="c1"># Each of the zones have their own dutycycle. Robot will</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="c1"># drive and stop at each zone, scan, align, and resume drive</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="n">zones</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="c1"># Check if straight drive mode is requested andd steady drive mode</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">just_drive</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="c1"># Use image from camera to estimate distance</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dist_estimate</span><span class="p">()</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="c1"># convert depth to encoder count</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2encoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="o">-</span><span class="mi">35</span><span class="p">)</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance estimated </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance to drive </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">35</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="k">elif</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>            <span class="c1"># Use image from camera to estimate distance</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dist_estimate</span><span class="p">()</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>            <span class="c1"># convert depth to encoder count</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2encoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance estimated </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Driving slowly </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="o">-</span><span class="mi">5</span><span class="si">}</span><span class="s2"> cms&quot;</span><span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="k">elif</span> <span class="n">just_drive</span><span class="p">:</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>            <span class="c1"># Drive straight command</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feet2encoder</span><span class="p">(</span><span class="n">eucl_disp</span><span class="p">)</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Just Driving Distance estimated </span><span class="si">{</span><span class="n">orig_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="k">elif</span> <span class="n">just_drive</span> <span class="ow">and</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="c1"># Drive straight command</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2encoder</span><span class="p">(</span><span class="n">eucl_disp</span><span class="p">)</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Just Driving Distance estimated </span><span class="si">{</span><span class="n">orig_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance to drive </span><span class="si">{</span><span class="n">orig_dist</span><span class="si">}</span><span class="s2"> encoder&quot;</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="n">pos_encoder_orig</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>        <span class="n">pos_encoder</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="n">orig_error</span> <span class="o">=</span> <span class="n">orig_dist</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>        
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="c1"># Defining the limit of dutycycle</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="n">z1</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="n">z2</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">-</span> <span class="mi">20</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>        <span class="n">z3</span> <span class="o">=</span> <span class="n">z2</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>        
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="c1"># Divide up the path in different zones</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="n">trip</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">orig_dist</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">]</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="c1"># Determine if function completed successfully</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="c1">#time.sleep(1)</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>        <span class="n">yaw0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>        <span class="c1"># For encoder level control</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>        <span class="n">integral_error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>        <span class="n">derivative_error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="n">error_encoder0</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="n">error_encoder</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="c1"># For achieving overall distance</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="n">derivative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="n">error0</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="n">startD</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="c1"># Assign direciton of drive from argument</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="n">direction</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        <span class="c1"># Compute the difference in distance between start state  and goal state        </span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sending command toward thrusters&quot;</span><span class="p">)</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking encoder to cm </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">orig_dist</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">orig_dist</span><span class="p">))</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>        
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>        <span class="c1">#To avoid division by zero</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">orig_dist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="mf">0.001</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>        
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="c1"># Save robots pose by saving its x, yaw position</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>        <span class="c1"># Convert imu notation to general +ccw from positive x</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>        
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>                            
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                                
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>            <span class="c1"># by considering the minimum of the two encoders</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>            <span class="n">pos_encoder</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span><span class="p">))</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>            
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="c1"># Global error between start and goal state will be</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>            <span class="n">error</span> <span class="o">=</span> <span class="n">orig_dist</span> <span class="o">-</span> <span class="n">pos_encoder</span>  
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>            <span class="n">prcnt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">error</span><span class="o">/</span><span class="n">orig_dist</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>            
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_encoder</span> <span class="o">%</span> <span class="mi">150</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>                
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>                <span class="c1"># Save robots pose by saving its x, yaw position</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="c1">#                 if (self._distance() &lt; 30):</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>                <span class="k">if</span> <span class="p">((</span><span class="mi">10</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="mi">10</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">)):</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Too close to border. Stop and Exit straight drive&quot;</span><span class="p">)</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>    
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                    <span class="k">break</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                <span class="c1">#Record encoder states to txt file</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>             
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>            <span class="k">if</span> <span class="n">prcnt</span> <span class="o">&lt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                    
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>                    <span class="n">error</span> <span class="o">=</span> <span class="n">orig_dist</span> <span class="o">-</span> <span class="n">pos_encoder</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">=</span> <span class="n">pos_encoder</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                    
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="mi">55</span><span class="p">]</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>                    
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prcnt</span> <span class="o">&lt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">35</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>                    
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">+=</span> <span class="n">pos_encoder</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>                    
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">]</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>                    
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>                
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prcnt</span> <span class="o">&lt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">28</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">+=</span> <span class="n">pos_encoder</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                    
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>                    
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>            <span class="k">elif</span> <span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">28</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>                    
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">+=</span> <span class="n">pos_encoder</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>                    
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">22</span><span class="p">]</span> 
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>                    
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>            
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>            
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">lower_dc</span><span class="p">,</span> <span class="n">upper_dc</span><span class="p">),</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>                                                <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">lower_dc</span><span class="p">,</span> <span class="n">upper_dc</span><span class="p">)]</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>            
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>            <span class="k">if</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>               
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>                <span class="c1"># Drive robot towards direction</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]))</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;rev&#39;</span><span class="p">:</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>                <span class="c1"># Drive robot towards direction</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_reverse</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]))</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>                
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>            <span class="c1"># Count encoders for left and right motors</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span><span class="p">):</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span><span class="p">):</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>                
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>            <span class="c1"># PD Controller for encoder balance</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>            <span class="n">error_encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>                
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>            <span class="k">if</span> <span class="n">error_encoder</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>                <span class="c1"># Give power to corresponding motors</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span>  <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="c1">#                 self._dutycycle[self._direction][1] += 0.1 * self.duty[self._direction][1]</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>            <span class="k">elif</span> <span class="n">error_encoder</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">25</span><span class="p">:</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>                <span class="c1"># Give power to corresponding motors</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a><span class="c1">#                 self._dutycycle[self._direction][0] += 0.1 * self.duty[self._direction][0]</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span>  <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>                <span class="c1"># Give power to corresponding motors</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>            
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>            
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;rev&#39;</span><span class="p">]):</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>                <span class="n">angle_diff</span> <span class="o">=</span> <span class="n">yaw0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;counterBR: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span><span class="si">}</span><span class="s2"> counterFL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angle shifted: </span><span class="si">{</span><span class="n">angle_diff</span><span class="si">}</span><span class="s2"> deg &quot;</span><span class="p">)</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated distance traveled: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span><span class="si">}</span><span class="s2"> cms&quot;</span><span class="p">)</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Arrived in front of block&quot;</span><span class="p">)</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>                
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>                <span class="c1"># Convert imu notation to general +ccw from positive x</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>                <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>                
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>                <span class="c1"># Save robots pose by saving its x, yaw position</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">+=</span> <span class="n">x</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">+=</span> <span class="n">y</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>                <span class="c1">#self.global_yaw += self._yaw</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>                
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>                
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x value </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> and y value </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>                                
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>                <span class="c1"># Take image and save to video object</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>                <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>                                                
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>                <span class="c1">#Record encoder states to txt file</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="s1">&#39;End of Driving </span><span class="si">{self._direction}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>                <span class="k">break</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="c1"># Return pwm dutcycle back to base</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>    <span class="k">def</span> <span class="nf">_scan4object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="sd">        This function scans for block in environment by turning in place</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="sd">        until it finds the block. If it doesn&#39;t find the block after full 360</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">        degree turn, it returns false to say not found</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">        </span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">        Args:</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">            None</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">            </span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">        Returns:</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="sd">            None</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>        
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;scanning&#39;</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scanning for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block started&quot;</span><span class="p">)</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>        <span class="n">scan_turn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>            <span class="c1"># Detect object in frame</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>            <span class="c1">#self._img_frame, ave_center, bbox_radius, success = self._bbox_detect()</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">ave_center</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>            
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>            <span class="k">if</span> <span class="n">success</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">False</span><span class="p">]:</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                <span class="c1"># Object found</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                <span class="n">diff</span> <span class="o">=</span> <span class="n">ave_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                <span class="c1"># Convert the pixel difference to degrees</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">pixel2deg</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>                
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>                
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>                
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;scanning&#39;</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>                
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>                <span class="c1"># Pivot the robot to a predefined turn angle</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turn</span><span class="p">)</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>                <span class="c1"># Read the distance from obstacle for reference</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">()</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>                <span class="c1"># Keep track of turn</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>                <span class="c1">#self._yaw += self.turn</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>                <span class="n">scan_turn</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">+=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>            
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="c1">#             if scan_turn &gt;= 90:</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="c1">#                 # Scan the other side</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="c1">#                 self._pivot(-self.turn)</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="c1">#                 # Add scan angle</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="c1">#                 scan_turn += -self.turn</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="c1">#                 self._yaw += self._turn</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="c1">#                 self._path.append((round(self.global_x,2),round(self.global_y,2),round(self._yaw,2)))</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a><span class="c1">#                 </span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="c1">#             if scan_turn &lt;= -90:</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="c1">#                 self._status[&#39;found&#39;] = False</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a><span class="c1">#                 self._success = False</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a><span class="c1">#                 self._task_now = &#39;scanning&#39;</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a><span class="c1">#                 self._actions[self._task_now] = False</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="c1">#                 self._logger.warning(&quot;No objects in nearby vicinity&quot;)</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a><span class="c1">#                 return None</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>                
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scan_turn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;scanning&#39;</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No objects in nearby vicinity&quot;</span><span class="p">)</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>    
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>    <span class="k">def</span> <span class="nf">_pick_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a><span class="sd">        This function drives the robot to steadily approach and picks up toy block</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a><span class="sd">        </span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="sd">        Args:</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">            None</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a><span class="sd">            </span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a><span class="sd">        Returns:</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a><span class="sd">            None</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;picking&#39;</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>        
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>        <span class="c1"># Take image and save to video object</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>        
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>            <span class="c1"># Open gripper</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">])</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">]</span> 
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Servo Opened&quot;</span><span class="p">)</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>            <span class="c1"># Take image and save to video object</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>            <span class="c1"># Align robot fine turne rotation</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>            <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>            
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="c1">#             while True:</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="c1">#                 if degree is not None:</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a><span class="c1">#                     if abs(degree) &gt; 0.6:</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="c1">#                         self._pivot(degree, steady=True)</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="c1">#                     else:</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="c1">#                         break</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="c1">#                 else:</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="c1">#                     break</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>            <span class="c1"># Scan block and drive slowly towards it</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Driving slowly toward block&quot;</span><span class="p">)</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Slow drive completed&quot;</span><span class="p">)</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>            
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>            <span class="c1"># Take image and save to video object</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>            
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>            <span class="c1"># Close gripper</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Servo Closed&quot;</span><span class="p">)</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>            
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>            <span class="c1"># Take image and save to video object</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>            
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>            <span class="c1">#if (abs(radius2 - radius1) &lt; 5) or (abs(center2[0] - center1[0]) &lt; 3):</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block has been gripped successfully&quot;</span><span class="p">)</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;picked_up&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>            
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>        <span class="c1"># Read saved image and send via email</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_email_media</span><span class="p">()</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>    <span class="k">def</span> <span class="nf">_go2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">destination</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="sd">        This function computes the difference in pose between the robot and the desired destination,</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a><span class="sd">        then estimates the displacement vector along with the angle of rotation needed</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="sd">        to align the robot head  on. It then calls the pivot and go2block functions respectively</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a><span class="sd">        and command the robot to enter the construction zone.</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="sd">        </span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="sd">        Args:</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">            destination (tuple): contans x,y location of destination</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">            area (str): Describes where that destination is</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">            </span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">        Returns:</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">            None</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initiating travel to </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;returning&#39;</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>        
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>        <span class="c1"># Read last position from the appended path</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>        <span class="c1"># self.global_x = self._path[-1][0]</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>        <span class="c1"># self.global_y = self._path[-1][1]</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>        <span class="c1">#self.global_yaw = self._path[-1][2]</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>        
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pose Now: X- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="si">}</span><span class="s2"> and Y- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="si">}</span><span class="s2"> and Yaw- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>        <span class="c1"># Compute the euclidean distance between current robot location and construction zone</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>        <span class="n">disp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">delta_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>        <span class="c1"># Calculate the yaw angle difference between these two points using slope equation</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>        <span class="n">rad_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">delta_y</span><span class="p">,</span><span class="n">delta_x</span><span class="p">)</span>                
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>        <span class="c1"># Convert from radians to angle</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>        <span class="n">target_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rad_diff</span><span class="p">)</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>        <span class="c1"># Ensure angle is between [0, 360]</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>        <span class="n">target_angle</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>        
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed target angle is </span><span class="si">{</span><span class="n">target_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>        
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="c1"># # Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>        <span class="k">if</span> <span class="n">target_angle</span> <span class="o">&gt;=-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">target_angle</span> <span class="o">&lt;=</span><span class="mi">180</span><span class="p">:</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>            <span class="n">target_angle</span> <span class="o">=</span> <span class="o">-</span><span class="n">target_angle</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">target_angle</span> <span class="o">&gt;=</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">target_angle</span> <span class="o">&lt;</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>            <span class="n">target_angle</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">target_angle</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">target_angle</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">360</span> <span class="ow">and</span> <span class="n">target_angle</span> <span class="o">&lt;=-</span><span class="mi">180</span><span class="p">):</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>            <span class="n">target_angle</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">target_angle</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>            
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normalized target angle is </span><span class="si">{</span><span class="n">target_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="c1">#         # Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="c1">#         target_angle = (target_angle + 180) % 360 - 180</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>        <span class="c1"># # Angle difference from current and target</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>        <span class="c1"># deg_diff = self._yaw - target_angle </span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>        <span class="c1"># deg_diff %= 360</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>        <span class="c1"># Based on the quadrant of the point heading towards normalize</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>        <span class="c1"># the target angle</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a><span class="c1">#         if delta_x &lt; 0:</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a><span class="c1">#             if delta_y &gt; 0:</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a><span class="c1">#                 #target_angle = 180 - target_angle</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a><span class="c1">#                 pass</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a><span class="c1">#             else:</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a><span class="c1"># #                 target_angle = target_angle - 180</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a><span class="c1">#                 pass</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a><span class="c1">#         else:</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a><span class="c1">#             if delta_y &lt; 0:</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a><span class="c1"># #                 target_angle = -target_angle</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a><span class="c1">#                 pass</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>        <span class="c1"># convert target angle with respect to imu configuration</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>        <span class="c1"># target_angle = -target_angle</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>        
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>        <span class="c1"># Angle difference from current and target</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">target_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>  
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>        <span class="c1">#deg_diff %= 360</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>        
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="c1">#         if (deg_diff &gt; 180 and deg_diff &lt;360):</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a><span class="c1">#             deg_diff = (deg_diff - 360) # Turning to the right</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a><span class="c1">#         elif (deg_diff &gt; -360 and deg_diff &lt;=-180):</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a><span class="c1">#             deg_diff = (deg_diff + 360) # Turning to the left</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>            
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a><span class="c1">#         # Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a><span class="c1">#         if (deg_diff &gt; 180 and deg_diff &lt;=360):</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a><span class="c1">#             deg_diff = deg_diff - 360</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a><span class="c1">#         # Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a><span class="c1">#         deg_diff = (deg_diff + 180) % 360 - 180</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>        
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yaw that vehicle will pivot to </span><span class="si">{</span><span class="n">deg_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>        <span class="c1"># Pivot robot to face construction zone</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span> <span class="n">just_turn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started driving straight to </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>        <span class="c1"># Drive robot foward to construction zone</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">eucl_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span><span class="n">just_drive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arrived at </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>        
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>        <span class="c1"># New global yaw</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">global_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>        
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;arrived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>        
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>    <span class="k">def</span> <span class="nf">_place</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a><span class="sd">        This function places toy block</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a><span class="sd">        </span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a><span class="sd">        Args:</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a><span class="sd">            None</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a><span class="sd">            </span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a><span class="sd">        Returns:</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a><span class="sd">            None</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;placing&#39;</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>        
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>        <span class="c1"># Open gripper</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">])</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">]</span> 
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gripper Opened to place </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>        
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>        <span class="c1"># Drive in reverse</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;rev&#39;</span><span class="p">,</span><span class="n">eucl_disp</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">just_drive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backed away from toy block&quot;</span><span class="p">)</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>        
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>        <span class="c1"># Close gripper</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span> 
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gripper Closed to prepare for next order&quot;</span><span class="p">)</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>        
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;placed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>        
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block is now placed inside construction zone&quot;</span><span class="p">)</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>        
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>        <span class="c1"># Read saved image and send via email</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_email_media</span><span class="p">()</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>        
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>    <span class="k">def</span> <span class="nf">_localize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a><span class="sd">        This function uses distance sensor to read from borderwall</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a><span class="sd">        so that the robot&#39;s exact position in arena can easily be</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a><span class="sd">        identified</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a><span class="sd">        </span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="sd">        Args:</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a><span class="sd">            None</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a><span class="sd">            </span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="sd">        Returns:</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="sd">            None</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;localizing&#39;</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>        
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>        <span class="c1"># pivot the robot to positive y first and read from distance sensor</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>        <span class="n">yaw_final</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>        <span class="n">yaw_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="n">yaw_current</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>        
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>        <span class="c1">#deg_diff %= 360</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>        <span class="c1"># Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">deg_diff</span>   
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">360</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">180</span><span class="p">):</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">deg_diff</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>    
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>        
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>        <span class="c1"># Turn towards borderwall</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span> <span class="n">just_turn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>        
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>        <span class="c1"># Now read distance sensor value</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">()</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>        <span class="n">delta_ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2feet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_depth</span><span class="p">)</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>        <span class="n">x1</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>        
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>        <span class="c1"># Extract y pose by normalizing from border wall</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">-</span> <span class="n">y1</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">=</span> <span class="n">y1</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>        
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>        <span class="c1"># pivot the robot to negative x first and read from distance sensor</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>        <span class="n">yaw_final</span> <span class="o">=</span> <span class="o">-</span><span class="mi">179</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>        <span class="n">yaw_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="n">yaw_current</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>        <span class="c1">#deg_diff %= 360</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>        
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>        <span class="c1"># Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">deg_diff</span>   
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">360</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">180</span><span class="p">):</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">deg_diff</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>        <span class="c1"># Turn towards borderwall</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span> <span class="n">just_turn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>        
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>        <span class="c1"># Now read distance sensor value</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">()</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>        <span class="n">delta_ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2feet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_depth</span><span class="p">)</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>        <span class="n">x2</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>        
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>        <span class="c1"># Extract x pose by normalizing from border wall</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">-</span> <span class="n">x2</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">=</span> <span class="n">x2</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>        
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>        <span class="c1"># Add detected pose of robot into path list    </span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>    
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>            
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Localization complete&quot;</span><span class="p">)</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>            
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>    <span class="k">def</span> <span class="nf">_go2site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a><span class="sd">        This function commands the robot to drive back to the center</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a><span class="sd">        of the arena or near the cluttered enviorment to resume delivering</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a><span class="sd">        order</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a><span class="sd">        </span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a><span class="sd">        Args:</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a><span class="sd">            None</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a><span class="sd">            </span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a><span class="sd">        Returns:</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a><span class="sd">            None</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>        
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initiating travel to cluttered environment&quot;</span><span class="p">)</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>        <span class="c1"># Compute the euclidean distance between current robot location and construction zone</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>        <span class="n">disp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>        <span class="c1"># Calculate the yaw angle difference between these two points using slope equation</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>        <span class="n">rad_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>        <span class="c1"># Convert from radians to angle</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rad_diff</span><span class="p">)</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="c1"># Ensure angle is between [0, 360]</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>        <span class="n">deg_diff</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>        <span class="c1"># Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">deg_diff</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>            
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orienting to cluttered environment&quot;</span><span class="p">)</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>        <span class="c1"># Pivot robot to face construction zone</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">)</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started driving straight to cluttered environment&quot;</span><span class="p">)</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>        <span class="c1"># Drive robot foward to construction zone</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">eucl_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span><span class="n">just_drive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Arrived at cluttered environment&quot;</span><span class="p">)</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>        
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>    <span class="k">def</span> <span class="nf">_go_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a><span class="sd">        This function commands the robot to drive back to its home location</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a><span class="sd">        marking the end of the challenge.</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a><span class="sd">        </span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a><span class="sd">        Args:</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a><span class="sd">            None</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a><span class="sd">            </span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a><span class="sd">        Returns:</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a><span class="sd">            None</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initiating travel to home base&quot;</span><span class="p">)</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>        <span class="c1"># Compute the euclidean distance between current robot location and construction zone</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>        <span class="n">disp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>        <span class="c1"># Calculate the yaw angle difference between these two points using slope equation</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>        <span class="n">rad_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>        <span class="c1"># Convert from radians to angle</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rad_diff</span><span class="p">)</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>        <span class="c1"># Ensure angle is between [0, 360]</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>        <span class="n">deg_diff</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>        <span class="c1"># Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">deg_diff</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>            
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orienting to home base&quot;</span><span class="p">)</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>        <span class="c1"># Pivot robot to face construction zone</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">)</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started driving straight to home base&quot;</span><span class="p">)</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>        <span class="c1"># Drive robot foward to construction zone</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">eucl_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span><span class="n">just_drive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Arrived at home&quot;</span><span class="p">)</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Thank you for playing game.&quot;</span><span class="p">)</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Powering off.&quot;</span><span class="p">)</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>        
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>    <span class="k">def</span> <span class="nf">plot_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a><span class="sd">        Plot the path of the robot during the grand challenge. </span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a><span class="sd">        </span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="sd">        Args:</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a><span class="sd">            None</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a><span class="sd">        Return:</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a><span class="sd">            None</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>        <span class="c1"># Take in the path list as an array 2D NumPy array</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>        
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>        <span class="c1"># Create figure and plot</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>        
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Motor Encoder Analysis&#39;</span><span class="p">)</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s1"> Path&#39;</span><span class="p">)</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>        <span class="c1"># 3) Label the axes, title, legend</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;grandChallenge-robotPath.png&#39;</span><span class="p">)</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a><span class="sd">        The sequence of actions occuring while baron robot works to pick and place</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a><span class="sd">        all toy blocks to the construction zone. This function lists the steps needed</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a><span class="sd">        for the robot to complete the orders passed to it at the beginning of competition</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a><span class="sd">        </span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a><span class="sd">        Args:</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a><span class="sd">            order: List[Blocks] list of all toy blocks needed to complete challenge</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a><span class="sd">        </span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a><span class="sd">        Returns:</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a><span class="sd">            None</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>        
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>            <span class="c1"># Assign order from object initialization</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>        
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>            <span class="c1"># First wait until startup QR Code has been read</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait2start</span><span class="p">():</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>                    <span class="k">break</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>            
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;While Robot is still active, resume challenge&quot;&quot;&quot;</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span><span class="p">):</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_order_no</span> <span class="o">+=</span><span class="mi">1</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>                    <span class="c1"># Begin challenge with choesn block</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*** Picking Up </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>                
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>                    <span class="c1"># Track the number of times robot drives to search area</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>                    <span class="n">search</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>                    
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>                    <span class="c1"># Drive robot to center of arena, get view of toy blocks and begin</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>                    <span class="c1"># extracting blocks</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;cluttered environment&#39;</span><span class="p">)</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>                
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>                
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>                        <span class="c1"># Begin by scanning for toy block object</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>                        <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>                        
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                        <span class="c1"># Take image and save to video object</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>                        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>                        
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>                        <span class="c1"># Drive toward block if successful, else pivot to</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>                        <span class="c1"># a free space and drive</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>                            <span class="c1">#self._logger(f&quot;Pivoting Robot towards {self._block_now} block&quot;)</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>                            
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>                            <span class="c1"># Take image and save to video object</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>                            <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span><span class="n">__</span><span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>                            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>                            
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drive Robot forward to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">()</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>                            
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>                            <span class="c1"># # Update global x and y</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>                            <span class="c1"># self.global_x += self._x</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>                            <span class="c1"># self.global_y += self._y</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>                            
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>                            <span class="c1">##self._logger(f&quot;{self._name} is now at x- {self.global_x} and y- {self.global_y}&quot;)</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>                            
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>                            <span class="c1"># Take image and save to video object</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>                            <span class="c1">#cntr_bbox.img_show(&quot;Arrived at Block&quot;,self._img_frame)</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>                            
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>                            <span class="c1">##self._logger(f&quot;Pick up {self._block_now} block with gripper&quot;)</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_pick_up</span><span class="p">()</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>                            
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>                            <span class="c1"># Drive robot to construction zone to place block</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>                            <span class="c1">##self._logger(f&quot;Take {self._block_now} block to construction zone&quot;)</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">const_zone</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;construction zone&#39;</span><span class="p">)</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>                            
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>                            <span class="c1">#self._logger(f&quot;Place {self._block_now} block inside construction zone&quot;)</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_place</span><span class="p">()</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>                            
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a><span class="c1">#                             #self._logger(&quot;Localizing to get accurate location of robot&quot;)</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_localize</span><span class="p">()</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>                            
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>                            <span class="c1">##self._logger(f&quot;Pick up and place the next order in the queue&quot;)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>                            <span class="k">break</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>                            <span class="c1">#self._logger(&quot;No toy blocks found in current pose. Change pose and&quot;)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>                            <span class="c1">#self._logger(&quot;try again.&quot;)</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>                            
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>                            <span class="c1"># Drive robot to the predetermined survey locations</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>                            <span class="k">if</span> <span class="n">search</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_survey_loc</span><span class="p">[</span><span class="n">search</span><span class="p">],</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;Alternative survey area&#39;</span><span class="p">)</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>                                <span class="c1">#self._logger(f&quot;Robot can&#39;t find {self._block_now} block in time.&quot;)</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>                                <span class="c1">#self._logger(&quot;In pursuit of time, moving on to next block in queue&quot;)</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>                                <span class="k">break</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>                            <span class="n">search</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>                            
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>                <span class="c1">#self._logger(f&quot;Mission complete. Take robot back to home base&quot;)</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;home base&#39;</span><span class="p">)</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>                <span class="k">return</span> 
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>        
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>        
</span></pre></div>


            </section>
                <section id="Robot">
                            <input id="Robot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Robot</span>:

                <label class="view-source-button" for="Robot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Robot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Robot-41"><a href="#Robot-41"><span class="linenos">  41</span></a><span class="k">class</span> <span class="nc">Robot</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="Robot-42"><a href="#Robot-42"><span class="linenos">  42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-43"><a href="#Robot-43"><span class="linenos">  43</span></a><span class="sd">    A class defining basic attributes of Baron robot that</span>
</span><span id="Robot-44"><a href="#Robot-44"><span class="linenos">  44</span></a><span class="sd">    will be autonomously achieving objective</span>
</span><span id="Robot-45"><a href="#Robot-45"><span class="linenos">  45</span></a><span class="sd">    </span>
</span><span id="Robot-46"><a href="#Robot-46"><span class="linenos">  46</span></a><span class="sd">    Attributes:</span>
</span><span id="Robot-47"><a href="#Robot-47"><span class="linenos">  47</span></a><span class="sd">        name (str): Name of robot</span>
</span><span id="Robot-48"><a href="#Robot-48"><span class="linenos">  48</span></a><span class="sd">        _x (float): horizontal position of robot from start postion</span>
</span><span id="Robot-49"><a href="#Robot-49"><span class="linenos">  49</span></a><span class="sd">        _y (float): vertical position of robot from start position</span>
</span><span id="Robot-50"><a href="#Robot-50"><span class="linenos">  50</span></a><span class="sd">        _yaw (float): yaw orientation from +x as horizontal [0,180] or (-180,0)</span>
</span><span id="Robot-51"><a href="#Robot-51"><span class="linenos">  51</span></a><span class="sd">        _travel(float): estimating the distance to drive and reach block</span>
</span><span id="Robot-52"><a href="#Robot-52"><span class="linenos">  52</span></a><span class="sd">        _turn (float): keeps the next turn needed by block</span>
</span><span id="Robot-53"><a href="#Robot-53"><span class="linenos">  53</span></a><span class="sd">        _depth (float): measures distance of obstacle in front of robot from image</span>
</span><span id="Robot-54"><a href="#Robot-54"><span class="linenos">  54</span></a><span class="sd">        _path (list): stores the path traveled by robot as list of (x,y) points and yaw</span>
</span><span id="Robot-55"><a href="#Robot-55"><span class="linenos">  55</span></a><span class="sd">        _pwms (list): stores a list of pwms for the robot motors</span>
</span><span id="Robot-56"><a href="#Robot-56"><span class="linenos">  56</span></a><span class="sd">        _dutycycle (dict): holds the baseline pwm dutycycle for forward,reverse,</span>
</span><span id="Robot-57"><a href="#Robot-57"><span class="linenos">  57</span></a><span class="sd">                           pivotleft and pivotright</span>
</span><span id="Robot-58"><a href="#Robot-58"><span class="linenos">  58</span></a><span class="sd">        _success (bool): keeps track whether a given task is successful or not</span>
</span><span id="Robot-59"><a href="#Robot-59"><span class="linenos">  59</span></a><span class="sd">        _gripper_state (str): stores gripper duty cycle state as opened or closed</span>
</span><span id="Robot-60"><a href="#Robot-60"><span class="linenos">  60</span></a><span class="sd">        _order(list): List of blocks to pickup</span>
</span><span id="Robot-61"><a href="#Robot-61"><span class="linenos">  61</span></a><span class="sd">        _end_game (bool): tells competition is over by victory or failure</span>
</span><span id="Robot-62"><a href="#Robot-62"><span class="linenos">  62</span></a><span class="sd">        _order_no (int): keeps track of number of orders completed</span>
</span><span id="Robot-63"><a href="#Robot-63"><span class="linenos">  63</span></a><span class="sd">        _block_now (str): the block being pursued now</span>
</span><span id="Robot-64"><a href="#Robot-64"><span class="linenos">  64</span></a><span class="sd">        _task_now (str): keeps track of the task being completed at the moment</span>
</span><span id="Robot-65"><a href="#Robot-65"><span class="linenos">  65</span></a><span class="sd">        _actions (dict): holding list of all service actions robot performs with bool</span>
</span><span id="Robot-66"><a href="#Robot-66"><span class="linenos">  66</span></a><span class="sd">                         on which process is being done at a given time</span>
</span><span id="Robot-67"><a href="#Robot-67"><span class="linenos">  67</span></a><span class="sd">        _status (dict): a dictionary keeping track of completed actions along with</span>
</span><span id="Robot-68"><a href="#Robot-68"><span class="linenos">  68</span></a><span class="sd">        _img_frame (img): saves current image frame</span>
</span><span id="Robot-69"><a href="#Robot-69"><span class="linenos">  69</span></a><span class="sd">        _out (cv2 video obj): gather all frames into a video</span>
</span><span id="Robot-70"><a href="#Robot-70"><span class="linenos">  70</span></a><span class="sd">        _logger (log): log statements for debuging and status over the terminal</span>
</span><span id="Robot-71"><a href="#Robot-71"><span class="linenos">  71</span></a><span class="sd">        _kp (float): proportional gain</span>
</span><span id="Robot-72"><a href="#Robot-72"><span class="linenos">  72</span></a><span class="sd">        _ki (float): integral gain</span>
</span><span id="Robot-73"><a href="#Robot-73"><span class="linenos">  73</span></a><span class="sd">        _kd (float): derivative gain</span>
</span><span id="Robot-74"><a href="#Robot-74"><span class="linenos">  74</span></a><span class="sd">        _direction (str): tells weather robot is moving forward or reverse</span>
</span><span id="Robot-75"><a href="#Robot-75"><span class="linenos">  75</span></a><span class="sd">        _event (event): event object to end the thread call</span>
</span><span id="Robot-76"><a href="#Robot-76"><span class="linenos">  76</span></a><span class="sd">        _pause_event (event): event object to pause and resume thread</span>
</span><span id="Robot-77"><a href="#Robot-77"><span class="linenos">  77</span></a><span class="sd">        imu_reader (thread): threading object to read from imu during forward run</span>
</span><span id="Robot-78"><a href="#Robot-78"><span class="linenos">  78</span></a><span class="sd">        _ser (serial): object reading serial input streams from imu sensor</span>
</span><span id="Robot-79"><a href="#Robot-79"><span class="linenos">  79</span></a><span class="sd">        _img_saved (img): keeping track of saved image to send in an email</span>
</span><span id="Robot-80"><a href="#Robot-80"><span class="linenos">  80</span></a><span class="sd">        _survey_loc (List): containes x,y locations for the robot to navigate and scan</span>
</span><span id="Robot-81"><a href="#Robot-81"><span class="linenos">  81</span></a><span class="sd">                            so that to extract toy blocks for mission</span>
</span><span id="Robot-82"><a href="#Robot-82"><span class="linenos">  82</span></a><span class="sd">        </span>
</span><span id="Robot-83"><a href="#Robot-83"><span class="linenos">  83</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Robot-84"><a href="#Robot-84"><span class="linenos">  84</span></a>    
</span><span id="Robot-85"><a href="#Robot-85"><span class="linenos">  85</span></a>    <span class="c1"># define the codec and create VideoWriter object</span>
</span><span id="Robot-86"><a href="#Robot-86"><span class="linenos">  86</span></a>    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;XVID&#39;</span><span class="p">)</span>
</span><span id="Robot-87"><a href="#Robot-87"><span class="linenos">  87</span></a>    <span class="c1"># Gripper States</span>
</span><span id="Robot-88"><a href="#Robot-88"><span class="linenos">  88</span></a>    <span class="n">grip_state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="mf">2.5</span><span class="p">),(</span><span class="s1">&#39;opened&#39;</span><span class="p">,</span><span class="mf">7.5</span><span class="p">)])</span>
</span><span id="Robot-89"><a href="#Robot-89"><span class="linenos">  89</span></a>    <span class="c1"># Matrix for Image frame</span>
</span><span id="Robot-90"><a href="#Robot-90"><span class="linenos">  90</span></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">480</span><span class="o">*</span><span class="mi">640</span><span class="o">*</span><span class="mi">3</span><span class="p">,),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="Robot-91"><a href="#Robot-91"><span class="linenos">  91</span></a>    <span class="c1"># define the codec and create VideoWriter object</span>
</span><span id="Robot-92"><a href="#Robot-92"><span class="linenos">  92</span></a>    <span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;XVID&#39;</span><span class="p">)</span>
</span><span id="Robot-93"><a href="#Robot-93"><span class="linenos">  93</span></a>    <span class="c1"># Open .txt file to save data</span>
</span><span id="Robot-94"><a href="#Robot-94"><span class="linenos">  94</span></a>    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;robot_path_final.txt&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="Robot-95"><a href="#Robot-95"><span class="linenos">  95</span></a>    
</span><span id="Robot-96"><a href="#Robot-96"><span class="linenos">  96</span></a>    <span class="n">dutyset</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span><span class="mi">70</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;rev&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]),(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)]</span>
</span><span id="Robot-97"><a href="#Robot-97"><span class="linenos">  97</span></a>
</span><span id="Robot-98"><a href="#Robot-98"><span class="linenos">  98</span></a>    <span class="n">duty</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dutyset</span><span class="p">)</span>
</span><span id="Robot-99"><a href="#Robot-99"><span class="linenos">  99</span></a>    <span class="n">font</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_COMPLEX_SMALL</span>
</span><span id="Robot-100"><a href="#Robot-100"><span class="linenos"> 100</span></a>    
</span><span id="Robot-101"><a href="#Robot-101"><span class="linenos"> 101</span></a>    <span class="c1"># turn angel</span>
</span><span id="Robot-102"><a href="#Robot-102"><span class="linenos"> 102</span></a>    <span class="n">turn</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="Robot-103"><a href="#Robot-103"><span class="linenos"> 103</span></a>    
</span><span id="Robot-104"><a href="#Robot-104"><span class="linenos"> 104</span></a>    <span class="c1"># detect radius</span>
</span><span id="Robot-105"><a href="#Robot-105"><span class="linenos"> 105</span></a>    <span class="n">bbox_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-106"><a href="#Robot-106"><span class="linenos"> 106</span></a>    
</span><span id="Robot-107"><a href="#Robot-107"><span class="linenos"> 107</span></a>    <span class="c1"># Initialize FL and BR button count</span>
</span><span id="Robot-108"><a href="#Robot-108"><span class="linenos"> 108</span></a>    <span class="n">counterBR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-109"><a href="#Robot-109"><span class="linenos"> 109</span></a>    <span class="n">counterFL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-110"><a href="#Robot-110"><span class="linenos"> 110</span></a>    <span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-111"><a href="#Robot-111"><span class="linenos"> 111</span></a>    <span class="n">buttonFL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-112"><a href="#Robot-112"><span class="linenos"> 112</span></a>    
</span><span id="Robot-113"><a href="#Robot-113"><span class="linenos"> 113</span></a>    <span class="c1"># Proportional Control Gain</span>
</span><span id="Robot-114"><a href="#Robot-114"><span class="linenos"> 114</span></a>    <span class="n">Kp</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Robot-115"><a href="#Robot-115"><span class="linenos"> 115</span></a>    <span class="n">Ki</span> <span class="o">=</span> <span class="mf">0.05</span>
</span><span id="Robot-116"><a href="#Robot-116"><span class="linenos"> 116</span></a>    <span class="n">Kd</span> <span class="o">=</span> <span class="mf">0.08</span>
</span><span id="Robot-117"><a href="#Robot-117"><span class="linenos"> 117</span></a>    
</span><span id="Robot-118"><a href="#Robot-118"><span class="linenos"> 118</span></a>    <span class="c1"># Important locations in map in units of feet</span>
</span><span id="Robot-119"><a href="#Robot-119"><span class="linenos"> 119</span></a>    <span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-120"><a href="#Robot-120"><span class="linenos"> 120</span></a>    <span class="n">start_pt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-121"><a href="#Robot-121"><span class="linenos"> 121</span></a>    <span class="n">clutter_env</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
</span><span id="Robot-122"><a href="#Robot-122"><span class="linenos"> 122</span></a>    <span class="n">const_zone</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.25</span><span class="p">,</span><span class="mf">6.5</span><span class="p">]</span>
</span><span id="Robot-123"><a href="#Robot-123"><span class="linenos"> 123</span></a>    
</span><span id="Robot-124"><a href="#Robot-124"><span class="linenos"> 124</span></a>    <span class="c1"># create object to read camera</span>
</span><span id="Robot-125"><a href="#Robot-125"><span class="linenos"> 125</span></a>    <span class="n">video</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-126"><a href="#Robot-126"><span class="linenos"> 126</span></a>
</span><span id="Robot-127"><a href="#Robot-127"><span class="linenos"> 127</span></a>    <span class="n">frame_center</span> <span class="o">=</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span><span class="mi">240</span><span class="p">)</span>
</span><span id="Robot-128"><a href="#Robot-128"><span class="linenos"> 128</span></a>    <span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">cy</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">frame_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
</span><span id="Robot-129"><a href="#Robot-129"><span class="linenos"> 129</span></a>    
</span><span id="Robot-130"><a href="#Robot-130"><span class="linenos"> 130</span></a>    <span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="Robot-131"><a href="#Robot-131"><span class="linenos"> 131</span></a>    
</span><span id="Robot-132"><a href="#Robot-132"><span class="linenos"> 132</span></a>    <span class="n">img_folder</span> <span class="o">=</span> <span class="s1">&#39;challenge_pics&#39;</span>
</span><span id="Robot-133"><a href="#Robot-133"><span class="linenos"> 133</span></a>    
</span><span id="Robot-134"><a href="#Robot-134"><span class="linenos"> 134</span></a>    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-135"><a href="#Robot-135"><span class="linenos"> 135</span></a>    
</span><span id="Robot-136"><a href="#Robot-136"><span class="linenos"> 136</span></a>    <span class="c1"># Environment assessment points</span>
</span><span id="Robot-137"><a href="#Robot-137"><span class="linenos"> 137</span></a>    <span class="n">scan_spots</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">8</span><span class="p">)]</span>
</span><span id="Robot-138"><a href="#Robot-138"><span class="linenos"> 138</span></a>    
</span><span id="Robot-139"><a href="#Robot-139"><span class="linenos"> 139</span></a>    <span class="c1"># Global x, y, positions and yaw from fixed reference</span>
</span><span id="Robot-140"><a href="#Robot-140"><span class="linenos"> 140</span></a>    <span class="c1"># frame (0,0)</span>
</span><span id="Robot-141"><a href="#Robot-141"><span class="linenos"> 141</span></a>    <span class="n">global_x</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Robot-142"><a href="#Robot-142"><span class="linenos"> 142</span></a>    <span class="n">global_y</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Robot-143"><a href="#Robot-143"><span class="linenos"> 143</span></a>    <span class="n">global_yaw</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-144"><a href="#Robot-144"><span class="linenos"> 144</span></a>    
</span><span id="Robot-145"><a href="#Robot-145"><span class="linenos"> 145</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Robot-146"><a href="#Robot-146"><span class="linenos"> 146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-147"><a href="#Robot-147"><span class="linenos"> 147</span></a><span class="sd">        Initialize Robot attributes</span>
</span><span id="Robot-148"><a href="#Robot-148"><span class="linenos"> 148</span></a><span class="sd">        </span>
</span><span id="Robot-149"><a href="#Robot-149"><span class="linenos"> 149</span></a><span class="sd">        Args:</span>
</span><span id="Robot-150"><a href="#Robot-150"><span class="linenos"> 150</span></a><span class="sd">            name: str - takes name of robot</span>
</span><span id="Robot-151"><a href="#Robot-151"><span class="linenos"> 151</span></a><span class="sd">        </span>
</span><span id="Robot-152"><a href="#Robot-152"><span class="linenos"> 152</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-153"><a href="#Robot-153"><span class="linenos"> 153</span></a><span class="sd">            None</span>
</span><span id="Robot-154"><a href="#Robot-154"><span class="linenos"> 154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-155"><a href="#Robot-155"><span class="linenos"> 155</span></a>
</span><span id="Robot-156"><a href="#Robot-156"><span class="linenos"> 156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Robot-157"><a href="#Robot-157"><span class="linenos"> 157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-158"><a href="#Robot-158"><span class="linenos"> 158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-159"><a href="#Robot-159"><span class="linenos"> 159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Robot-160"><a href="#Robot-160"><span class="linenos"> 160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_travel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-161"><a href="#Robot-161"><span class="linenos"> 161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-162"><a href="#Robot-162"><span class="linenos"> 162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-163"><a href="#Robot-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="Robot-164"><a href="#Robot-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot-165"><a href="#Robot-165"><span class="linenos"> 165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span>
</span><span id="Robot-166"><a href="#Robot-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-167"><a href="#Robot-167"><span class="linenos"> 167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span>
</span><span id="Robot-168"><a href="#Robot-168"><span class="linenos"> 168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot-169"><a href="#Robot-169"><span class="linenos"> 169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-170"><a href="#Robot-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_order_no</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-171"><a href="#Robot-171"><span class="linenos"> 171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Robot-172"><a href="#Robot-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Robot-173"><a href="#Robot-173"><span class="linenos"> 173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;driving&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;rotating&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;picking&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;placing&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;localizing&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;returning&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;scanning&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)])</span>
</span><span id="Robot-174"><a href="#Robot-174"><span class="linenos"> 174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;started&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;picked_up&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;found&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;placed&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;finished&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;arrived&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)])</span>
</span><span id="Robot-175"><a href="#Robot-175"><span class="linenos"> 175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="Robot-176"><a href="#Robot-176"><span class="linenos"> 176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s1">&#39;grand_chall_vid.avi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fourcc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">))</span>
</span><span id="Robot-177"><a href="#Robot-177"><span class="linenos"> 177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Robot-178"><a href="#Robot-178"><span class="linenos"> 178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span>
</span><span id="Robot-179"><a href="#Robot-179"><span class="linenos"> 179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ki</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span>
</span><span id="Robot-180"><a href="#Robot-180"><span class="linenos"> 180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span>
</span><span id="Robot-181"><a href="#Robot-181"><span class="linenos"> 181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
</span><span id="Robot-182"><a href="#Robot-182"><span class="linenos"> 182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="Robot-183"><a href="#Robot-183"><span class="linenos"> 183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="Robot-184"><a href="#Robot-184"><span class="linenos"> 184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">imu_reader</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial_straight</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,))</span>
</span><span id="Robot-185"><a href="#Robot-185"><span class="linenos"> 185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;/dev/ttyUSB0&#39;</span><span class="p">,</span> <span class="mi">19200</span><span class="p">)</span>
</span><span id="Robot-186"><a href="#Robot-186"><span class="linenos"> 186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="Robot-187"><a href="#Robot-187"><span class="linenos"> 187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_survey_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_spots</span>
</span><span id="Robot-188"><a href="#Robot-188"><span class="linenos"> 188</span></a>        
</span><span id="Robot-189"><a href="#Robot-189"><span class="linenos"> 189</span></a>        <span class="c1"># Set up logger with Debug initially</span>
</span><span id="Robot-190"><a href="#Robot-190"><span class="linenos"> 190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="Robot-191"><a href="#Robot-191"><span class="linenos"> 191</span></a>        <span class="c1"># Create console handler and set level to debug</span>
</span><span id="Robot-192"><a href="#Robot-192"><span class="linenos"> 192</span></a>        <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span><span id="Robot-193"><a href="#Robot-193"><span class="linenos"> 193</span></a>        <span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="Robot-194"><a href="#Robot-194"><span class="linenos"> 194</span></a>        <span class="c1"># log terminal messages to a file</span>
</span><span id="Robot-195"><a href="#Robot-195"><span class="linenos"> 195</span></a>        <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;gc_log_3.log&#39;</span><span class="p">)</span>
</span><span id="Robot-196"><a href="#Robot-196"><span class="linenos"> 196</span></a>        <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="Robot-197"><a href="#Robot-197"><span class="linenos"> 197</span></a>        <span class="c1"># Create formatter</span>
</span><span id="Robot-198"><a href="#Robot-198"><span class="linenos"> 198</span></a>        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Robot-199"><a href="#Robot-199"><span class="linenos"> 199</span></a>        <span class="c1"># Add formatter to handler</span>
</span><span id="Robot-200"><a href="#Robot-200"><span class="linenos"> 200</span></a>        <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="Robot-201"><a href="#Robot-201"><span class="linenos"> 201</span></a>        <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="Robot-202"><a href="#Robot-202"><span class="linenos"> 202</span></a>        <span class="c1"># Add console handler to logger</span>
</span><span id="Robot-203"><a href="#Robot-203"><span class="linenos"> 203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
</span><span id="Robot-204"><a href="#Robot-204"><span class="linenos"> 204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</span><span id="Robot-205"><a href="#Robot-205"><span class="linenos"> 205</span></a>        <span class="c1"># Initialize gpios and pwms</span>
</span><span id="Robot-206"><a href="#Robot-206"><span class="linenos"> 206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
</span><span id="Robot-207"><a href="#Robot-207"><span class="linenos"> 207</span></a>        
</span><span id="Robot-208"><a href="#Robot-208"><span class="linenos"> 208</span></a>        
</span><span id="Robot-209"><a href="#Robot-209"><span class="linenos"> 209</span></a>    <span class="nd">@property</span>
</span><span id="Robot-210"><a href="#Robot-210"><span class="linenos"> 210</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-211"><a href="#Robot-211"><span class="linenos"> 211</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="Robot-212"><a href="#Robot-212"><span class="linenos"> 212</span></a>    
</span><span id="Robot-213"><a href="#Robot-213"><span class="linenos"> 213</span></a>    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Robot-214"><a href="#Robot-214"><span class="linenos"> 214</span></a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="Robot-215"><a href="#Robot-215"><span class="linenos"> 215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Robot-216"><a href="#Robot-216"><span class="linenos"> 216</span></a>        
</span><span id="Robot-217"><a href="#Robot-217"><span class="linenos"> 217</span></a>    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-218"><a href="#Robot-218"><span class="linenos"> 218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-219"><a href="#Robot-219"><span class="linenos"> 219</span></a><span class="sd">        Initialize gpio pins and set pwms to command DC motors, encoders and</span>
</span><span id="Robot-220"><a href="#Robot-220"><span class="linenos"> 220</span></a><span class="sd">        servo</span>
</span><span id="Robot-221"><a href="#Robot-221"><span class="linenos"> 221</span></a><span class="sd">        </span>
</span><span id="Robot-222"><a href="#Robot-222"><span class="linenos"> 222</span></a><span class="sd">        Args:</span>
</span><span id="Robot-223"><a href="#Robot-223"><span class="linenos"> 223</span></a><span class="sd">            None</span>
</span><span id="Robot-224"><a href="#Robot-224"><span class="linenos"> 224</span></a><span class="sd">        </span>
</span><span id="Robot-225"><a href="#Robot-225"><span class="linenos"> 225</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-226"><a href="#Robot-226"><span class="linenos"> 226</span></a><span class="sd">            None</span>
</span><span id="Robot-227"><a href="#Robot-227"><span class="linenos"> 227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-228"><a href="#Robot-228"><span class="linenos"> 228</span></a>        
</span><span id="Robot-229"><a href="#Robot-229"><span class="linenos"> 229</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="Robot-230"><a href="#Robot-230"><span class="linenos"> 230</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">BOARD</span><span class="p">)</span>
</span><span id="Robot-231"><a href="#Robot-231"><span class="linenos"> 231</span></a>        
</span><span id="Robot-232"><a href="#Robot-232"><span class="linenos"> 232</span></a>        <span class="c1"># Setup GPIO pin(s)</span>
</span><span id="Robot-233"><a href="#Robot-233"><span class="linenos"> 233</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># Servo</span>
</span><span id="Robot-234"><a href="#Robot-234"><span class="linenos"> 234</span></a>        
</span><span id="Robot-235"><a href="#Robot-235"><span class="linenos"> 235</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN1</span>
</span><span id="Robot-236"><a href="#Robot-236"><span class="linenos"> 236</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN2</span>
</span><span id="Robot-237"><a href="#Robot-237"><span class="linenos"> 237</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN3</span>
</span><span id="Robot-238"><a href="#Robot-238"><span class="linenos"> 238</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># IN4</span>
</span><span id="Robot-239"><a href="#Robot-239"><span class="linenos"> 239</span></a>        
</span><span id="Robot-240"><a href="#Robot-240"><span class="linenos"> 240</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull_up_down</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PUD_UP</span><span class="p">)</span>
</span><span id="Robot-241"><a href="#Robot-241"><span class="linenos"> 241</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull_up_down</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PUD_UP</span><span class="p">)</span>
</span><span id="Robot-242"><a href="#Robot-242"><span class="linenos"> 242</span></a>        
</span><span id="Robot-243"><a href="#Robot-243"><span class="linenos"> 243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="Robot-244"><a href="#Robot-244"><span class="linenos"> 244</span></a>
</span><span id="Robot-245"><a href="#Robot-245"><span class="linenos"> 245</span></a>        <span class="c1"># initialize pwm signal to control motor</span>
</span><span id="Robot-246"><a href="#Robot-246"><span class="linenos"> 246</span></a>        <span class="n">pwm01</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># BackLeft motor</span>
</span><span id="Robot-247"><a href="#Robot-247"><span class="linenos"> 247</span></a>        <span class="n">pwm11</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># FrontLeft motor</span>
</span><span id="Robot-248"><a href="#Robot-248"><span class="linenos"> 248</span></a>        <span class="n">pwm22</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># FrontRight motor</span>
</span><span id="Robot-249"><a href="#Robot-249"><span class="linenos"> 249</span></a>        <span class="n">pwm02</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># BackRight motor</span>
</span><span id="Robot-250"><a href="#Robot-250"><span class="linenos"> 250</span></a>        <span class="n">pwmS</span> <span class="o">=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># Servo</span>
</span><span id="Robot-251"><a href="#Robot-251"><span class="linenos"> 251</span></a>
</span><span id="Robot-252"><a href="#Robot-252"><span class="linenos"> 252</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span> <span class="o">=</span> <span class="p">[</span><span class="n">pwm01</span><span class="p">,</span><span class="n">pwm11</span><span class="p">,</span><span class="n">pwm22</span><span class="p">,</span><span class="n">pwm02</span><span class="p">,</span><span class="n">pwmS</span><span class="p">]</span>
</span><span id="Robot-253"><a href="#Robot-253"><span class="linenos"> 253</span></a>        
</span><span id="Robot-254"><a href="#Robot-254"><span class="linenos"> 254</span></a>        <span class="k">for</span> <span class="n">pwm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">:</span>
</span><span id="Robot-255"><a href="#Robot-255"><span class="linenos"> 255</span></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-256"><a href="#Robot-256"><span class="linenos"> 256</span></a>
</span><span id="Robot-257"><a href="#Robot-257"><span class="linenos"> 257</span></a>    <span class="k">def</span> <span class="nf">_pwmZero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-258"><a href="#Robot-258"><span class="linenos"> 258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-259"><a href="#Robot-259"><span class="linenos"> 259</span></a><span class="sd">        Stops motors by zeroing pwm values in all pins</span>
</span><span id="Robot-260"><a href="#Robot-260"><span class="linenos"> 260</span></a><span class="sd">        controlling DC motors</span>
</span><span id="Robot-261"><a href="#Robot-261"><span class="linenos"> 261</span></a><span class="sd">        </span>
</span><span id="Robot-262"><a href="#Robot-262"><span class="linenos"> 262</span></a><span class="sd">        Args:</span>
</span><span id="Robot-263"><a href="#Robot-263"><span class="linenos"> 263</span></a><span class="sd">            None</span>
</span><span id="Robot-264"><a href="#Robot-264"><span class="linenos"> 264</span></a><span class="sd">        </span>
</span><span id="Robot-265"><a href="#Robot-265"><span class="linenos"> 265</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-266"><a href="#Robot-266"><span class="linenos"> 266</span></a><span class="sd">            None</span>
</span><span id="Robot-267"><a href="#Robot-267"><span class="linenos"> 267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-268"><a href="#Robot-268"><span class="linenos"> 268</span></a>
</span><span id="Robot-269"><a href="#Robot-269"><span class="linenos"> 269</span></a>
</span><span id="Robot-270"><a href="#Robot-270"><span class="linenos"> 270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-271"><a href="#Robot-271"><span class="linenos"> 271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-272"><a href="#Robot-272"><span class="linenos"> 272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-273"><a href="#Robot-273"><span class="linenos"> 273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-274"><a href="#Robot-274"><span class="linenos"> 274</span></a>        
</span><span id="Robot-275"><a href="#Robot-275"><span class="linenos"> 275</span></a>    <span class="k">def</span> <span class="nf">_gameover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-276"><a href="#Robot-276"><span class="linenos"> 276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-277"><a href="#Robot-277"><span class="linenos"> 277</span></a><span class="sd">        Terminates run by stopping pwms and cleaning up</span>
</span><span id="Robot-278"><a href="#Robot-278"><span class="linenos"> 278</span></a><span class="sd">        gpio pins</span>
</span><span id="Robot-279"><a href="#Robot-279"><span class="linenos"> 279</span></a><span class="sd">        </span>
</span><span id="Robot-280"><a href="#Robot-280"><span class="linenos"> 280</span></a><span class="sd">        Args:</span>
</span><span id="Robot-281"><a href="#Robot-281"><span class="linenos"> 281</span></a><span class="sd">            None</span>
</span><span id="Robot-282"><a href="#Robot-282"><span class="linenos"> 282</span></a><span class="sd">        </span>
</span><span id="Robot-283"><a href="#Robot-283"><span class="linenos"> 283</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-284"><a href="#Robot-284"><span class="linenos"> 284</span></a><span class="sd">            None</span>
</span><span id="Robot-285"><a href="#Robot-285"><span class="linenos"> 285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-286"><a href="#Robot-286"><span class="linenos"> 286</span></a>    
</span><span id="Robot-287"><a href="#Robot-287"><span class="linenos"> 287</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="Robot-288"><a href="#Robot-288"><span class="linenos"> 288</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span>
</span><span id="Robot-289"><a href="#Robot-289"><span class="linenos"> 289</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-290"><a href="#Robot-290"><span class="linenos"> 290</span></a>        <span class="k">for</span> <span class="n">pwm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">:</span>
</span><span id="Robot-291"><a href="#Robot-291"><span class="linenos"> 291</span></a>            <span class="n">pwm</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Robot-292"><a href="#Robot-292"><span class="linenos"> 292</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="Robot-293"><a href="#Robot-293"><span class="linenos"> 293</span></a>        
</span><span id="Robot-294"><a href="#Robot-294"><span class="linenos"> 294</span></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="Robot-295"><a href="#Robot-295"><span class="linenos"> 295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-296"><a href="#Robot-296"><span class="linenos"> 296</span></a><span class="sd">        Commands DC motors to drive robot forward by sending</span>
</span><span id="Robot-297"><a href="#Robot-297"><span class="linenos"> 297</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="Robot-298"><a href="#Robot-298"><span class="linenos"> 298</span></a><span class="sd">        </span>
</span><span id="Robot-299"><a href="#Robot-299"><span class="linenos"> 299</span></a><span class="sd">        Args:</span>
</span><span id="Robot-300"><a href="#Robot-300"><span class="linenos"> 300</span></a><span class="sd">            None</span>
</span><span id="Robot-301"><a href="#Robot-301"><span class="linenos"> 301</span></a><span class="sd">        </span>
</span><span id="Robot-302"><a href="#Robot-302"><span class="linenos"> 302</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-303"><a href="#Robot-303"><span class="linenos"> 303</span></a><span class="sd">            None</span>
</span><span id="Robot-304"><a href="#Robot-304"><span class="linenos"> 304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-305"><a href="#Robot-305"><span class="linenos"> 305</span></a>        <span class="c1"># Left wheels</span>
</span><span id="Robot-306"><a href="#Robot-306"><span class="linenos"> 306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Robot-307"><a href="#Robot-307"><span class="linenos"> 307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-308"><a href="#Robot-308"><span class="linenos"> 308</span></a>        <span class="c1"># Right wheels</span>
</span><span id="Robot-309"><a href="#Robot-309"><span class="linenos"> 309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-310"><a href="#Robot-310"><span class="linenos"> 310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Robot-311"><a href="#Robot-311"><span class="linenos"> 311</span></a>        
</span><span id="Robot-312"><a href="#Robot-312"><span class="linenos"> 312</span></a>    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="Robot-313"><a href="#Robot-313"><span class="linenos"> 313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-314"><a href="#Robot-314"><span class="linenos"> 314</span></a><span class="sd">        Commands DC motors to drive robot in reverses by sending</span>
</span><span id="Robot-315"><a href="#Robot-315"><span class="linenos"> 315</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="Robot-316"><a href="#Robot-316"><span class="linenos"> 316</span></a><span class="sd">        </span>
</span><span id="Robot-317"><a href="#Robot-317"><span class="linenos"> 317</span></a><span class="sd">        Args:</span>
</span><span id="Robot-318"><a href="#Robot-318"><span class="linenos"> 318</span></a><span class="sd">            None</span>
</span><span id="Robot-319"><a href="#Robot-319"><span class="linenos"> 319</span></a><span class="sd">        </span>
</span><span id="Robot-320"><a href="#Robot-320"><span class="linenos"> 320</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-321"><a href="#Robot-321"><span class="linenos"> 321</span></a><span class="sd">            None</span>
</span><span id="Robot-322"><a href="#Robot-322"><span class="linenos"> 322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-323"><a href="#Robot-323"><span class="linenos"> 323</span></a>        <span class="c1"># Left wheels</span>
</span><span id="Robot-324"><a href="#Robot-324"><span class="linenos"> 324</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-325"><a href="#Robot-325"><span class="linenos"> 325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Robot-326"><a href="#Robot-326"><span class="linenos"> 326</span></a>        <span class="c1"># Right wheels</span>
</span><span id="Robot-327"><a href="#Robot-327"><span class="linenos"> 327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Robot-328"><a href="#Robot-328"><span class="linenos"> 328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-329"><a href="#Robot-329"><span class="linenos"> 329</span></a>
</span><span id="Robot-330"><a href="#Robot-330"><span class="linenos"> 330</span></a>    <span class="k">def</span> <span class="nf">_pivotleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="Robot-331"><a href="#Robot-331"><span class="linenos"> 331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-332"><a href="#Robot-332"><span class="linenos"> 332</span></a><span class="sd">        Commands DC motors to pivot robot left by sending</span>
</span><span id="Robot-333"><a href="#Robot-333"><span class="linenos"> 333</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="Robot-334"><a href="#Robot-334"><span class="linenos"> 334</span></a><span class="sd">        </span>
</span><span id="Robot-335"><a href="#Robot-335"><span class="linenos"> 335</span></a><span class="sd">        Args:</span>
</span><span id="Robot-336"><a href="#Robot-336"><span class="linenos"> 336</span></a><span class="sd">            None</span>
</span><span id="Robot-337"><a href="#Robot-337"><span class="linenos"> 337</span></a><span class="sd">        </span>
</span><span id="Robot-338"><a href="#Robot-338"><span class="linenos"> 338</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-339"><a href="#Robot-339"><span class="linenos"> 339</span></a><span class="sd">            None</span>
</span><span id="Robot-340"><a href="#Robot-340"><span class="linenos"> 340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-341"><a href="#Robot-341"><span class="linenos"> 341</span></a>        <span class="c1"># Left wheels</span>
</span><span id="Robot-342"><a href="#Robot-342"><span class="linenos"> 342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-343"><a href="#Robot-343"><span class="linenos"> 343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="Robot-344"><a href="#Robot-344"><span class="linenos"> 344</span></a>        <span class="c1"># Right wheels</span>
</span><span id="Robot-345"><a href="#Robot-345"><span class="linenos"> 345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-346"><a href="#Robot-346"><span class="linenos"> 346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="Robot-347"><a href="#Robot-347"><span class="linenos"> 347</span></a>        
</span><span id="Robot-348"><a href="#Robot-348"><span class="linenos"> 348</span></a>    <span class="k">def</span> <span class="nf">_pivotright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
</span><span id="Robot-349"><a href="#Robot-349"><span class="linenos"> 349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-350"><a href="#Robot-350"><span class="linenos"> 350</span></a><span class="sd">        Commands DC motors to pivot robot right by sending</span>
</span><span id="Robot-351"><a href="#Robot-351"><span class="linenos"> 351</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="Robot-352"><a href="#Robot-352"><span class="linenos"> 352</span></a><span class="sd">        </span>
</span><span id="Robot-353"><a href="#Robot-353"><span class="linenos"> 353</span></a><span class="sd">        Args:</span>
</span><span id="Robot-354"><a href="#Robot-354"><span class="linenos"> 354</span></a><span class="sd">            None</span>
</span><span id="Robot-355"><a href="#Robot-355"><span class="linenos"> 355</span></a><span class="sd">        </span>
</span><span id="Robot-356"><a href="#Robot-356"><span class="linenos"> 356</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-357"><a href="#Robot-357"><span class="linenos"> 357</span></a><span class="sd">            None</span>
</span><span id="Robot-358"><a href="#Robot-358"><span class="linenos"> 358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-359"><a href="#Robot-359"><span class="linenos"> 359</span></a>
</span><span id="Robot-360"><a href="#Robot-360"><span class="linenos"> 360</span></a>        <span class="c1"># Left wheels</span>
</span><span id="Robot-361"><a href="#Robot-361"><span class="linenos"> 361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="Robot-362"><a href="#Robot-362"><span class="linenos"> 362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-363"><a href="#Robot-363"><span class="linenos"> 363</span></a>        <span class="c1"># Right wheels</span>
</span><span id="Robot-364"><a href="#Robot-364"><span class="linenos"> 364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</span><span id="Robot-365"><a href="#Robot-365"><span class="linenos"> 365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-366"><a href="#Robot-366"><span class="linenos"> 366</span></a>        
</span><span id="Robot-367"><a href="#Robot-367"><span class="linenos"> 367</span></a>    <span class="k">def</span> <span class="nf">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">duty_cycle</span><span class="p">):</span>
</span><span id="Robot-368"><a href="#Robot-368"><span class="linenos"> 368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-369"><a href="#Robot-369"><span class="linenos"> 369</span></a><span class="sd">        Commands servo motors to open and close gripper by sending</span>
</span><span id="Robot-370"><a href="#Robot-370"><span class="linenos"> 370</span></a><span class="sd">        Dutycycles to respective pwm pins</span>
</span><span id="Robot-371"><a href="#Robot-371"><span class="linenos"> 371</span></a><span class="sd">        </span>
</span><span id="Robot-372"><a href="#Robot-372"><span class="linenos"> 372</span></a><span class="sd">        Args:</span>
</span><span id="Robot-373"><a href="#Robot-373"><span class="linenos"> 373</span></a><span class="sd">            None</span>
</span><span id="Robot-374"><a href="#Robot-374"><span class="linenos"> 374</span></a><span class="sd">        </span>
</span><span id="Robot-375"><a href="#Robot-375"><span class="linenos"> 375</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-376"><a href="#Robot-376"><span class="linenos"> 376</span></a><span class="sd">            None</span>
</span><span id="Robot-377"><a href="#Robot-377"><span class="linenos"> 377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-378"><a href="#Robot-378"><span class="linenos"> 378</span></a>        
</span><span id="Robot-379"><a href="#Robot-379"><span class="linenos"> 379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ChangeDutyCycle</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">)</span>
</span><span id="Robot-380"><a href="#Robot-380"><span class="linenos"> 380</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-381"><a href="#Robot-381"><span class="linenos"> 381</span></a>
</span><span id="Robot-382"><a href="#Robot-382"><span class="linenos"> 382</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">servo_img</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">)</span>
</span><span id="Robot-383"><a href="#Robot-383"><span class="linenos"> 383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">())</span>
</span><span id="Robot-384"><a href="#Robot-384"><span class="linenos"> 384</span></a>        
</span><span id="Robot-385"><a href="#Robot-385"><span class="linenos"> 385</span></a>        <span class="c1">#cntr_bbox.img_show(&quot;Servo status&quot;,self._img_frame)</span>
</span><span id="Robot-386"><a href="#Robot-386"><span class="linenos"> 386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Robot-387"><a href="#Robot-387"><span class="linenos"> 387</span></a>        
</span><span id="Robot-388"><a href="#Robot-388"><span class="linenos"> 388</span></a>    <span class="k">def</span> <span class="nf">_picam_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-389"><a href="#Robot-389"><span class="linenos"> 389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-390"><a href="#Robot-390"><span class="linenos"> 390</span></a><span class="sd">        Calls picamera object to take image frame from the pi camera</span>
</span><span id="Robot-391"><a href="#Robot-391"><span class="linenos"> 391</span></a><span class="sd">        and applies corrections by flipping to reflect reality</span>
</span><span id="Robot-392"><a href="#Robot-392"><span class="linenos"> 392</span></a><span class="sd">        </span>
</span><span id="Robot-393"><a href="#Robot-393"><span class="linenos"> 393</span></a><span class="sd">        Args:</span>
</span><span id="Robot-394"><a href="#Robot-394"><span class="linenos"> 394</span></a><span class="sd">            None</span>
</span><span id="Robot-395"><a href="#Robot-395"><span class="linenos"> 395</span></a><span class="sd">        </span>
</span><span id="Robot-396"><a href="#Robot-396"><span class="linenos"> 396</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-397"><a href="#Robot-397"><span class="linenos"> 397</span></a><span class="sd">            None</span>
</span><span id="Robot-398"><a href="#Robot-398"><span class="linenos"> 398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-399"><a href="#Robot-399"><span class="linenos"> 399</span></a>        <span class="c1"># Take picture with camera</span>
</span><span id="Robot-400"><a href="#Robot-400"><span class="linenos"> 400</span></a>        <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;bgr&quot;</span><span class="p">)</span>
</span><span id="Robot-401"><a href="#Robot-401"><span class="linenos"> 401</span></a>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">480</span><span class="p">,</span><span class="mi">640</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</span><span id="Robot-402"><a href="#Robot-402"><span class="linenos"> 402</span></a>
</span><span id="Robot-403"><a href="#Robot-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-404"><a href="#Robot-404"><span class="linenos"> 404</span></a>    
</span><span id="Robot-405"><a href="#Robot-405"><span class="linenos"> 405</span></a>    <span class="k">def</span> <span class="nf">_mask_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imageHSV</span><span class="p">):</span>
</span><span id="Robot-406"><a href="#Robot-406"><span class="linenos"> 406</span></a>
</span><span id="Robot-407"><a href="#Robot-407"><span class="linenos"> 407</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">==</span> <span class="s1">&#39;green&#39;</span><span class="p">:</span>
</span><span id="Robot-408"><a href="#Robot-408"><span class="linenos"> 408</span></a>            <span class="c1"># Trail Green Bock - LAB</span>
</span><span id="Robot-409"><a href="#Robot-409"><span class="linenos"> 409</span></a>            <span class="n">minHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">46</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">121</span><span class="p">])</span>
</span><span id="Robot-410"><a href="#Robot-410"><span class="linenos"> 410</span></a>            <span class="n">maxHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">255</span><span class="p">])</span>
</span><span id="Robot-411"><a href="#Robot-411"><span class="linenos"> 411</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">==</span> <span class="s1">&#39;red&#39;</span><span class="p">:</span>
</span><span id="Robot-412"><a href="#Robot-412"><span class="linenos"> 412</span></a>            <span class="c1"># Trail Red block - LAB</span>
</span><span id="Robot-413"><a href="#Robot-413"><span class="linenos"> 413</span></a>            <span class="n">minHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">151</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">147</span><span class="p">])</span>
</span><span id="Robot-414"><a href="#Robot-414"><span class="linenos"> 414</span></a>            <span class="n">maxHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">])</span>
</span><span id="Robot-415"><a href="#Robot-415"><span class="linenos"> 415</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">==</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span>
</span><span id="Robot-416"><a href="#Robot-416"><span class="linenos"> 416</span></a>            <span class="c1"># Trail Blue block - LAB</span>
</span><span id="Robot-417"><a href="#Robot-417"><span class="linenos"> 417</span></a>            <span class="n">minHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">72</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">97</span><span class="p">])</span>
</span><span id="Robot-418"><a href="#Robot-418"><span class="linenos"> 418</span></a>            <span class="n">maxHSV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">126</span><span class="p">,</span><span class="mi">188</span><span class="p">,</span><span class="mi">212</span><span class="p">])</span>
</span><span id="Robot-419"><a href="#Robot-419"><span class="linenos"> 419</span></a>
</span><span id="Robot-420"><a href="#Robot-420"><span class="linenos"> 420</span></a>        <span class="n">maskHSV</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">imageHSV</span><span class="p">,</span> <span class="n">minHSV</span><span class="p">,</span> <span class="n">maxHSV</span><span class="p">)</span>
</span><span id="Robot-421"><a href="#Robot-421"><span class="linenos"> 421</span></a>
</span><span id="Robot-422"><a href="#Robot-422"><span class="linenos"> 422</span></a>        <span class="k">return</span> <span class="n">maskHSV</span>
</span><span id="Robot-423"><a href="#Robot-423"><span class="linenos"> 423</span></a>    
</span><span id="Robot-424"><a href="#Robot-424"><span class="linenos"> 424</span></a>    <span class="k">def</span> <span class="nf">_prep_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-425"><a href="#Robot-425"><span class="linenos"> 425</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-426"><a href="#Robot-426"><span class="linenos"> 426</span></a><span class="sd">        Processes images by applying HSV masking and gaussian blur</span>
</span><span id="Robot-427"><a href="#Robot-427"><span class="linenos"> 427</span></a><span class="sd">        for use by latter object detection functions</span>
</span><span id="Robot-428"><a href="#Robot-428"><span class="linenos"> 428</span></a><span class="sd">        </span>
</span><span id="Robot-429"><a href="#Robot-429"><span class="linenos"> 429</span></a><span class="sd">        Args:</span>
</span><span id="Robot-430"><a href="#Robot-430"><span class="linenos"> 430</span></a><span class="sd">            None</span>
</span><span id="Robot-431"><a href="#Robot-431"><span class="linenos"> 431</span></a><span class="sd">        </span>
</span><span id="Robot-432"><a href="#Robot-432"><span class="linenos"> 432</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-433"><a href="#Robot-433"><span class="linenos"> 433</span></a><span class="sd">            None</span>
</span><span id="Robot-434"><a href="#Robot-434"><span class="linenos"> 434</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-435"><a href="#Robot-435"><span class="linenos"> 435</span></a>    
</span><span id="Robot-436"><a href="#Robot-436"><span class="linenos"> 436</span></a>         <span class="c1"># Convert image from BGR to HSV space</span>
</span><span id="Robot-437"><a href="#Robot-437"><span class="linenos"> 437</span></a>        <span class="n">imageHSV</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
</span><span id="Robot-438"><a href="#Robot-438"><span class="linenos"> 438</span></a>
</span><span id="Robot-439"><a href="#Robot-439"><span class="linenos"> 439</span></a>        <span class="c1"># mask the green light from HSV and convert to grayscale</span>
</span><span id="Robot-440"><a href="#Robot-440"><span class="linenos"> 440</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_color</span><span class="p">(</span><span class="n">imageHSV</span><span class="p">)</span>
</span><span id="Robot-441"><a href="#Robot-441"><span class="linenos"> 441</span></a>
</span><span id="Robot-442"><a href="#Robot-442"><span class="linenos"> 442</span></a>        <span class="c1"># Mask HSV masked image of arrow</span>
</span><span id="Robot-443"><a href="#Robot-443"><span class="linenos"> 443</span></a>        <span class="n">blurred</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">mask</span><span class="p">,(</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-444"><a href="#Robot-444"><span class="linenos"> 444</span></a>
</span><span id="Robot-445"><a href="#Robot-445"><span class="linenos"> 445</span></a>        <span class="k">return</span> <span class="n">blurred</span> 
</span><span id="Robot-446"><a href="#Robot-446"><span class="linenos"> 446</span></a>        
</span><span id="Robot-447"><a href="#Robot-447"><span class="linenos"> 447</span></a>    <span class="k">def</span> <span class="nf">_grip_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-448"><a href="#Robot-448"><span class="linenos"> 448</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-449"><a href="#Robot-449"><span class="linenos"> 449</span></a><span class="sd">        Processes images by applying a rectangular mask over desired</span>
</span><span id="Robot-450"><a href="#Robot-450"><span class="linenos"> 450</span></a><span class="sd">        region of interest to verify whether gripper has held toy block </span>
</span><span id="Robot-451"><a href="#Robot-451"><span class="linenos"> 451</span></a><span class="sd">        </span>
</span><span id="Robot-452"><a href="#Robot-452"><span class="linenos"> 452</span></a><span class="sd">        Args:</span>
</span><span id="Robot-453"><a href="#Robot-453"><span class="linenos"> 453</span></a><span class="sd">            None</span>
</span><span id="Robot-454"><a href="#Robot-454"><span class="linenos"> 454</span></a><span class="sd">        </span>
</span><span id="Robot-455"><a href="#Robot-455"><span class="linenos"> 455</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-456"><a href="#Robot-456"><span class="linenos"> 456</span></a><span class="sd">            self._image_frame (img): Masked image</span>
</span><span id="Robot-457"><a href="#Robot-457"><span class="linenos"> 457</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-458"><a href="#Robot-458"><span class="linenos"> 458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inside Grip Checker Function&quot;</span><span class="p">)</span>
</span><span id="Robot-459"><a href="#Robot-459"><span class="linenos"> 459</span></a>        <span class="c1"># Create a mask of gripped block in image</span>
</span><span id="Robot-460"><a href="#Robot-460"><span class="linenos"> 460</span></a>        <span class="c1"># Save the shape of the image array</span>
</span><span id="Robot-461"><a href="#Robot-461"><span class="linenos"> 461</span></a>        <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Robot-462"><a href="#Robot-462"><span class="linenos"> 462</span></a>
</span><span id="Robot-463"><a href="#Robot-463"><span class="linenos"> 463</span></a>        <span class="c1"># Create mask of image just like picture </span>
</span><span id="Robot-464"><a href="#Robot-464"><span class="linenos"> 464</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Robot-465"><a href="#Robot-465"><span class="linenos"> 465</span></a>
</span><span id="Robot-466"><a href="#Robot-466"><span class="linenos"> 466</span></a>        <span class="c1"># Create a white rectangle</span>
</span><span id="Robot-467"><a href="#Robot-467"><span class="linenos"> 467</span></a>        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span>
</span><span id="Robot-468"><a href="#Robot-468"><span class="linenos"> 468</span></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span>  <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="mi">255</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-469"><a href="#Robot-469"><span class="linenos"> 469</span></a>        
</span><span id="Robot-470"><a href="#Robot-470"><span class="linenos"> 470</span></a>        <span class="c1"># Extract the image that aligns in the rectangle</span>
</span><span id="Robot-471"><a href="#Robot-471"><span class="linenos"> 471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Robot-472"><a href="#Robot-472"><span class="linenos"> 472</span></a>        
</span><span id="Robot-473"><a href="#Robot-473"><span class="linenos"> 473</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span>
</span><span id="Robot-474"><a href="#Robot-474"><span class="linenos"> 474</span></a>        
</span><span id="Robot-475"><a href="#Robot-475"><span class="linenos"> 475</span></a>    <span class="k">def</span> <span class="nf">_wait2start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-476"><a href="#Robot-476"><span class="linenos"> 476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-477"><a href="#Robot-477"><span class="linenos"> 477</span></a><span class="sd">        Waits for the competition start QR code to be visible,</span>
</span><span id="Robot-478"><a href="#Robot-478"><span class="linenos"> 478</span></a><span class="sd">        and reads QR code in, which if corresponds to &quot;ENPM701&quot;</span>
</span><span id="Robot-479"><a href="#Robot-479"><span class="linenos"> 479</span></a><span class="sd">        returns a True boolean to begin competition</span>
</span><span id="Robot-480"><a href="#Robot-480"><span class="linenos"> 480</span></a><span class="sd">        </span>
</span><span id="Robot-481"><a href="#Robot-481"><span class="linenos"> 481</span></a><span class="sd">        Args:</span>
</span><span id="Robot-482"><a href="#Robot-482"><span class="linenos"> 482</span></a><span class="sd">            None</span>
</span><span id="Robot-483"><a href="#Robot-483"><span class="linenos"> 483</span></a><span class="sd">        </span>
</span><span id="Robot-484"><a href="#Robot-484"><span class="linenos"> 484</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-485"><a href="#Robot-485"><span class="linenos"> 485</span></a><span class="sd">            start (bool): True/False based on detection of expected QR</span>
</span><span id="Robot-486"><a href="#Robot-486"><span class="linenos"> 486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-487"><a href="#Robot-487"><span class="linenos"> 487</span></a>        <span class="c1"># Define detector</span>
</span><span id="Robot-488"><a href="#Robot-488"><span class="linenos"> 488</span></a>        <span class="n">detector</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">QRCodeDetector</span><span class="p">()</span>
</span><span id="Robot-489"><a href="#Robot-489"><span class="linenos"> 489</span></a>        
</span><span id="Robot-490"><a href="#Robot-490"><span class="linenos"> 490</span></a>        <span class="c1"># Check if program start initiated</span>
</span><span id="Robot-491"><a href="#Robot-491"><span class="linenos"> 491</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-492"><a href="#Robot-492"><span class="linenos"> 492</span></a>        
</span><span id="Robot-493"><a href="#Robot-493"><span class="linenos"> 493</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-494"><a href="#Robot-494"><span class="linenos"> 494</span></a>        
</span><span id="Robot-495"><a href="#Robot-495"><span class="linenos"> 495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for start cue . . . &quot;</span><span class="p">)</span>
</span><span id="Robot-496"><a href="#Robot-496"><span class="linenos"> 496</span></a>        
</span><span id="Robot-497"><a href="#Robot-497"><span class="linenos"> 497</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Robot-498"><a href="#Robot-498"><span class="linenos"> 498</span></a>        
</span><span id="Robot-499"><a href="#Robot-499"><span class="linenos"> 499</span></a>            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">capture_continuous</span><span class="p">(</span><span class="n">cntr_bbox</span><span class="o">.</span><span class="n">rawCapture</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;bgr&quot;</span><span class="p">,</span> <span class="n">use_video_port</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Robot-500"><a href="#Robot-500"><span class="linenos"> 500</span></a>
</span><span id="Robot-501"><a href="#Robot-501"><span class="linenos"> 501</span></a>                <span class="c1"># grab the current frame</span>
</span><span id="Robot-502"><a href="#Robot-502"><span class="linenos"> 502</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">array</span>
</span><span id="Robot-503"><a href="#Robot-503"><span class="linenos"> 503</span></a>
</span><span id="Robot-504"><a href="#Robot-504"><span class="linenos"> 504</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-505"><a href="#Robot-505"><span class="linenos"> 505</span></a>                
</span><span id="Robot-506"><a href="#Robot-506"><span class="linenos"> 506</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">detectAndDecode</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Robot-507"><a href="#Robot-507"><span class="linenos"> 507</span></a>
</span><span id="Robot-508"><a href="#Robot-508"><span class="linenos"> 508</span></a>                <span class="k">if</span><span class="p">(</span><span class="n">bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Robot-509"><a href="#Robot-509"><span class="linenos"> 509</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)):</span>
</span><span id="Robot-510"><a href="#Robot-510"><span class="linenos"> 510</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">tuple</span><span class="p">(</span><span class="n">bbox</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="n">thickness</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Robot-511"><a href="#Robot-511"><span class="linenos"> 511</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">)),</span><span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-512"><a href="#Robot-512"><span class="linenos"> 512</span></a>
</span><span id="Robot-513"><a href="#Robot-513"><span class="linenos"> 513</span></a>                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="Robot-514"><a href="#Robot-514"><span class="linenos"> 514</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-515"><a href="#Robot-515"><span class="linenos"> 515</span></a>                    <span class="k">pass</span>
</span><span id="Robot-516"><a href="#Robot-516"><span class="linenos"> 516</span></a>                        
</span><span id="Robot-517"><a href="#Robot-517"><span class="linenos"> 517</span></a>                <span class="c1"># Show resutls to the screen</span>
</span><span id="Robot-518"><a href="#Robot-518"><span class="linenos"> 518</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;QR Code detector&quot;</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
</span><span id="Robot-519"><a href="#Robot-519"><span class="linenos"> 519</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span><span id="Robot-520"><a href="#Robot-520"><span class="linenos"> 520</span></a>            
</span><span id="Robot-521"><a href="#Robot-521"><span class="linenos"> 521</span></a>                <span class="c1"># write frame into file</span>
</span><span id="Robot-522"><a href="#Robot-522"><span class="linenos"> 522</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Robot-523"><a href="#Robot-523"><span class="linenos"> 523</span></a>
</span><span id="Robot-524"><a href="#Robot-524"><span class="linenos"> 524</span></a>                <span class="c1"># clear the stream in preparation for the next frame</span>
</span><span id="Robot-525"><a href="#Robot-525"><span class="linenos"> 525</span></a>                <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">rawCapture</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-526"><a href="#Robot-526"><span class="linenos"> 526</span></a>                
</span><span id="Robot-527"><a href="#Robot-527"><span class="linenos"> 527</span></a>                <span class="c1"># Break out of loop by pressing the q key</span>
</span><span id="Robot-528"><a href="#Robot-528"><span class="linenos"> 528</span></a>                <span class="k">if</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)):</span>
</span><span id="Robot-529"><a href="#Robot-529"><span class="linenos"> 529</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Program Terminated&quot;</span><span class="p">)</span>
</span><span id="Robot-530"><a href="#Robot-530"><span class="linenos"> 530</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="Robot-531"><a href="#Robot-531"><span class="linenos"> 531</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span><span id="Robot-532"><a href="#Robot-532"><span class="linenos"> 532</span></a>                    <span class="k">break</span>
</span><span id="Robot-533"><a href="#Robot-533"><span class="linenos"> 533</span></a>
</span><span id="Robot-534"><a href="#Robot-534"><span class="linenos"> 534</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;ENPM701&quot;</span><span class="p">:</span>
</span><span id="Robot-535"><a href="#Robot-535"><span class="linenos"> 535</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cue Received </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-536"><a href="#Robot-536"><span class="linenos"> 536</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;@&#39;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
</span><span id="Robot-537"><a href="#Robot-537"><span class="linenos"> 537</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting Grand Challenge! </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-538"><a href="#Robot-538"><span class="linenos"> 538</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">45</span><span class="p">)</span>
</span><span id="Robot-539"><a href="#Robot-539"><span class="linenos"> 539</span></a>                    <span class="n">start</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-540"><a href="#Robot-540"><span class="linenos"> 540</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="Robot-541"><a href="#Robot-541"><span class="linenos"> 541</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span><span id="Robot-542"><a href="#Robot-542"><span class="linenos"> 542</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Robot-543"><a href="#Robot-543"><span class="linenos"> 543</span></a>                    <span class="k">break</span>
</span><span id="Robot-544"><a href="#Robot-544"><span class="linenos"> 544</span></a>            
</span><span id="Robot-545"><a href="#Robot-545"><span class="linenos"> 545</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot-546"><a href="#Robot-546"><span class="linenos"> 546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="Robot-547"><a href="#Robot-547"><span class="linenos"> 547</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="Robot-548"><a href="#Robot-548"><span class="linenos"> 548</span></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span><span id="Robot-549"><a href="#Robot-549"><span class="linenos"> 549</span></a>        
</span><span id="Robot-550"><a href="#Robot-550"><span class="linenos"> 550</span></a>        <span class="k">return</span> <span class="n">start</span>
</span><span id="Robot-551"><a href="#Robot-551"><span class="linenos"> 551</span></a>    
</span><span id="Robot-552"><a href="#Robot-552"><span class="linenos"> 552</span></a>    <span class="k">def</span> <span class="nf">_email_media</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-553"><a href="#Robot-553"><span class="linenos"> 553</span></a>    
</span><span id="Robot-554"><a href="#Robot-554"><span class="linenos"> 554</span></a>        <span class="c1"># Take a picture of gripped block to email</span>
</span><span id="Robot-555"><a href="#Robot-555"><span class="linenos"> 555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-556"><a href="#Robot-556"><span class="linenos"> 556</span></a>        <span class="c1"># Append status of servo on image</span>
</span><span id="Robot-557"><a href="#Robot-557"><span class="linenos"> 557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">servo_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span><span class="p">)</span>
</span><span id="Robot-558"><a href="#Robot-558"><span class="linenos"> 558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-559"><a href="#Robot-559"><span class="linenos"> 559</span></a>        <span class="c1"># Save to designated directory</span>
</span><span id="Robot-560"><a href="#Robot-560"><span class="linenos"> 560</span></a>        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">img_folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-561"><a href="#Robot-561"><span class="linenos"> 561</span></a>        <span class="c1">#time.sleep(1)</span>
</span><span id="Robot-562"><a href="#Robot-562"><span class="linenos"> 562</span></a>        <span class="c1"># Read saved image</span>
</span><span id="Robot-563"><a href="#Robot-563"><span class="linenos"> 563</span></a>        <span class="n">img_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">img_folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s1">.png&#39;</span>
</span><span id="Robot-564"><a href="#Robot-564"><span class="linenos"> 564</span></a>        
</span><span id="Robot-565"><a href="#Robot-565"><span class="linenos"> 565</span></a>        <span class="c1"># send email to user with images</span>
</span><span id="Robot-566"><a href="#Robot-566"><span class="linenos"> 566</span></a>        <span class="n">smtpUser</span> <span class="o">=</span> <span class="s1">&#39;ykebede2@terpmail.umd.edu&#39;</span>
</span><span id="Robot-567"><a href="#Robot-567"><span class="linenos"> 567</span></a>        <span class="n">smtpPass</span> <span class="o">=</span> <span class="s1">&#39;QwE@$d1219&#39;</span>
</span><span id="Robot-568"><a href="#Robot-568"><span class="linenos"> 568</span></a>
</span><span id="Robot-569"><a href="#Robot-569"><span class="linenos"> 569</span></a>        <span class="n">toAdd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ENPM809TS19@gmail.com&#39;</span><span class="p">,</span><span class="s1">&#39;yosephcollege@gmail.com&#39;</span><span class="p">]</span>
</span><span id="Robot-570"><a href="#Robot-570"><span class="linenos"> 570</span></a>        <span class="n">fromAdd</span> <span class="o">=</span> <span class="n">smtpUser</span>
</span><span id="Robot-571"><a href="#Robot-571"><span class="linenos"> 571</span></a>
</span><span id="Robot-572"><a href="#Robot-572"><span class="linenos"> 572</span></a>        <span class="n">f_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> %b @ %H:%M&#39;</span><span class="p">)</span>
</span><span id="Robot-573"><a href="#Robot-573"><span class="linenos"> 573</span></a>        <span class="n">subject</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ENPM701-GrandChallenge-</span><span class="si">{</span><span class="n">f_time</span><span class="si">}</span><span class="s1">-yosephK-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Robot-574"><a href="#Robot-574"><span class="linenos"> 574</span></a>
</span><span id="Robot-575"><a href="#Robot-575"><span class="linenos"> 575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-576"><a href="#Robot-576"><span class="linenos"> 576</span></a>        
</span><span id="Robot-577"><a href="#Robot-577"><span class="linenos"> 577</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
</span><span id="Robot-578"><a href="#Robot-578"><span class="linenos"> 578</span></a>        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
</span><span id="Robot-579"><a href="#Robot-579"><span class="linenos"> 579</span></a>        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromAdd</span>
</span><span id="Robot-580"><a href="#Robot-580"><span class="linenos"> 580</span></a>        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="Robot-581"><a href="#Robot-581"><span class="linenos"> 581</span></a>
</span><span id="Robot-582"><a href="#Robot-582"><span class="linenos"> 582</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="s2">&quot;Image @ &quot;</span> <span class="o">+</span> <span class="n">f_time</span>
</span><span id="Robot-583"><a href="#Robot-583"><span class="linenos"> 583</span></a>
</span><span id="Robot-584"><a href="#Robot-584"><span class="linenos"> 584</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">mime</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MIMEText</span><span class="p">(</span><span class="s2">&quot;Baron Robot image: &quot;</span> <span class="o">+</span> <span class="n">f_time</span><span class="p">)</span>
</span><span id="Robot-585"><a href="#Robot-585"><span class="linenos"> 585</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="Robot-586"><a href="#Robot-586"><span class="linenos"> 586</span></a>
</span><span id="Robot-587"><a href="#Robot-587"><span class="linenos"> 587</span></a>        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="Robot-588"><a href="#Robot-588"><span class="linenos"> 588</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="Robot-589"><a href="#Robot-589"><span class="linenos"> 589</span></a>        <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Robot-590"><a href="#Robot-590"><span class="linenos"> 590</span></a>        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="Robot-591"><a href="#Robot-591"><span class="linenos"> 591</span></a>
</span><span id="Robot-592"><a href="#Robot-592"><span class="linenos"> 592</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s1">&#39;smtp.gmail.com&#39;</span><span class="p">,</span> <span class="mi">587</span><span class="p">)</span>
</span><span id="Robot-593"><a href="#Robot-593"><span class="linenos"> 593</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
</span><span id="Robot-594"><a href="#Robot-594"><span class="linenos"> 594</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
</span><span id="Robot-595"><a href="#Robot-595"><span class="linenos"> 595</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
</span><span id="Robot-596"><a href="#Robot-596"><span class="linenos"> 596</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">smtpUser</span><span class="p">,</span> <span class="n">smtpPass</span><span class="p">)</span>
</span><span id="Robot-597"><a href="#Robot-597"><span class="linenos"> 597</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">fromAdd</span><span class="p">,</span> <span class="n">toAdd</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</span><span id="Robot-598"><a href="#Robot-598"><span class="linenos"> 598</span></a>        <span class="n">s</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span><span id="Robot-599"><a href="#Robot-599"><span class="linenos"> 599</span></a>
</span><span id="Robot-600"><a href="#Robot-600"><span class="linenos"> 600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Email delivered!&quot;</span><span class="p">)</span>
</span><span id="Robot-601"><a href="#Robot-601"><span class="linenos"> 601</span></a>    
</span><span id="Robot-602"><a href="#Robot-602"><span class="linenos"> 602</span></a>    <span class="k">def</span> <span class="nf">_meter2encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="Robot-603"><a href="#Robot-603"><span class="linenos"> 603</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-604"><a href="#Robot-604"><span class="linenos"> 604</span></a><span class="sd">        Reads in distance values in meters and converts to</span>
</span><span id="Robot-605"><a href="#Robot-605"><span class="linenos"> 605</span></a><span class="sd">        encoder counts</span>
</span><span id="Robot-606"><a href="#Robot-606"><span class="linenos"> 606</span></a><span class="sd">        </span>
</span><span id="Robot-607"><a href="#Robot-607"><span class="linenos"> 607</span></a><span class="sd">        Args:</span>
</span><span id="Robot-608"><a href="#Robot-608"><span class="linenos"> 608</span></a><span class="sd">            None</span>
</span><span id="Robot-609"><a href="#Robot-609"><span class="linenos"> 609</span></a><span class="sd">        </span>
</span><span id="Robot-610"><a href="#Robot-610"><span class="linenos"> 610</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-611"><a href="#Robot-611"><span class="linenos"> 611</span></a><span class="sd">            encod (int): converted encoder counts from distance in m </span>
</span><span id="Robot-612"><a href="#Robot-612"><span class="linenos"> 612</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-613"><a href="#Robot-613"><span class="linenos"> 613</span></a>        <span class="n">encod</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0325</span><span class="p">))</span><span class="o">*</span><span class="mi">960</span><span class="p">)</span>
</span><span id="Robot-614"><a href="#Robot-614"><span class="linenos"> 614</span></a>        
</span><span id="Robot-615"><a href="#Robot-615"><span class="linenos"> 615</span></a>        <span class="k">return</span> <span class="n">encod</span>
</span><span id="Robot-616"><a href="#Robot-616"><span class="linenos"> 616</span></a>    
</span><span id="Robot-617"><a href="#Robot-617"><span class="linenos"> 617</span></a>    <span class="k">def</span> <span class="nf">_encoder2meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encd</span><span class="p">):</span>
</span><span id="Robot-618"><a href="#Robot-618"><span class="linenos"> 618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-619"><a href="#Robot-619"><span class="linenos"> 619</span></a><span class="sd">        Reads in encoder values and converts them to meters</span>
</span><span id="Robot-620"><a href="#Robot-620"><span class="linenos"> 620</span></a><span class="sd">        </span>
</span><span id="Robot-621"><a href="#Robot-621"><span class="linenos"> 621</span></a><span class="sd">        Args:</span>
</span><span id="Robot-622"><a href="#Robot-622"><span class="linenos"> 622</span></a><span class="sd">            None</span>
</span><span id="Robot-623"><a href="#Robot-623"><span class="linenos"> 623</span></a><span class="sd">        </span>
</span><span id="Robot-624"><a href="#Robot-624"><span class="linenos"> 624</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-625"><a href="#Robot-625"><span class="linenos"> 625</span></a><span class="sd">            cms (float): converted encoder counts to distance in m </span>
</span><span id="Robot-626"><a href="#Robot-626"><span class="linenos"> 626</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-627"><a href="#Robot-627"><span class="linenos"> 627</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">((</span><span class="n">encd</span> <span class="o">/</span> <span class="mi">960</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.0325</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Robot-628"><a href="#Robot-628"><span class="linenos"> 628</span></a>
</span><span id="Robot-629"><a href="#Robot-629"><span class="linenos"> 629</span></a>        <span class="k">return</span> <span class="n">dist</span>
</span><span id="Robot-630"><a href="#Robot-630"><span class="linenos"> 630</span></a>
</span><span id="Robot-631"><a href="#Robot-631"><span class="linenos"> 631</span></a>    <span class="k">def</span> <span class="nf">_cm2encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="Robot-632"><a href="#Robot-632"><span class="linenos"> 632</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-633"><a href="#Robot-633"><span class="linenos"> 633</span></a><span class="sd">        Reads in distance values in centimeters and converts to</span>
</span><span id="Robot-634"><a href="#Robot-634"><span class="linenos"> 634</span></a><span class="sd">        encoder counts</span>
</span><span id="Robot-635"><a href="#Robot-635"><span class="linenos"> 635</span></a><span class="sd">        </span>
</span><span id="Robot-636"><a href="#Robot-636"><span class="linenos"> 636</span></a><span class="sd">        Args:</span>
</span><span id="Robot-637"><a href="#Robot-637"><span class="linenos"> 637</span></a><span class="sd">            None</span>
</span><span id="Robot-638"><a href="#Robot-638"><span class="linenos"> 638</span></a><span class="sd">        </span>
</span><span id="Robot-639"><a href="#Robot-639"><span class="linenos"> 639</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-640"><a href="#Robot-640"><span class="linenos"> 640</span></a><span class="sd">            encod (int): converted encoder counts from distance in cms </span>
</span><span id="Robot-641"><a href="#Robot-641"><span class="linenos"> 641</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-642"><a href="#Robot-642"><span class="linenos"> 642</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">x_dist</span><span class="o">/</span><span class="mi">100</span>
</span><span id="Robot-643"><a href="#Robot-643"><span class="linenos"> 643</span></a>        <span class="n">encod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter2encoder</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</span><span id="Robot-644"><a href="#Robot-644"><span class="linenos"> 644</span></a>        <span class="k">return</span> <span class="n">encod</span>
</span><span id="Robot-645"><a href="#Robot-645"><span class="linenos"> 645</span></a>
</span><span id="Robot-646"><a href="#Robot-646"><span class="linenos"> 646</span></a>    <span class="k">def</span> <span class="nf">_encoder2cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encd</span><span class="p">):</span>
</span><span id="Robot-647"><a href="#Robot-647"><span class="linenos"> 647</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-648"><a href="#Robot-648"><span class="linenos"> 648</span></a><span class="sd">        Reads in encoder values and converts them to centimeters</span>
</span><span id="Robot-649"><a href="#Robot-649"><span class="linenos"> 649</span></a><span class="sd">        </span>
</span><span id="Robot-650"><a href="#Robot-650"><span class="linenos"> 650</span></a><span class="sd">        Args:</span>
</span><span id="Robot-651"><a href="#Robot-651"><span class="linenos"> 651</span></a><span class="sd">            None</span>
</span><span id="Robot-652"><a href="#Robot-652"><span class="linenos"> 652</span></a><span class="sd">        </span>
</span><span id="Robot-653"><a href="#Robot-653"><span class="linenos"> 653</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-654"><a href="#Robot-654"><span class="linenos"> 654</span></a><span class="sd">            cms (float): converted encoder counts to distance in cms </span>
</span><span id="Robot-655"><a href="#Robot-655"><span class="linenos"> 655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-656"><a href="#Robot-656"><span class="linenos"> 656</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2meter</span><span class="p">(</span><span class="n">encd</span><span class="p">)</span>
</span><span id="Robot-657"><a href="#Robot-657"><span class="linenos"> 657</span></a>        <span class="n">cms</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">dist</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Robot-658"><a href="#Robot-658"><span class="linenos"> 658</span></a>
</span><span id="Robot-659"><a href="#Robot-659"><span class="linenos"> 659</span></a>        <span class="k">return</span> <span class="n">cms</span>
</span><span id="Robot-660"><a href="#Robot-660"><span class="linenos"> 660</span></a>
</span><span id="Robot-661"><a href="#Robot-661"><span class="linenos"> 661</span></a>    <span class="k">def</span> <span class="nf">_feet2encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="Robot-662"><a href="#Robot-662"><span class="linenos"> 662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-663"><a href="#Robot-663"><span class="linenos"> 663</span></a><span class="sd">        Reads in distance values in feet and converts to</span>
</span><span id="Robot-664"><a href="#Robot-664"><span class="linenos"> 664</span></a><span class="sd">        encoder counts</span>
</span><span id="Robot-665"><a href="#Robot-665"><span class="linenos"> 665</span></a><span class="sd">        </span>
</span><span id="Robot-666"><a href="#Robot-666"><span class="linenos"> 666</span></a><span class="sd">        Args:</span>
</span><span id="Robot-667"><a href="#Robot-667"><span class="linenos"> 667</span></a><span class="sd">            None</span>
</span><span id="Robot-668"><a href="#Robot-668"><span class="linenos"> 668</span></a><span class="sd">        </span>
</span><span id="Robot-669"><a href="#Robot-669"><span class="linenos"> 669</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-670"><a href="#Robot-670"><span class="linenos"> 670</span></a><span class="sd">            encod (int): converted encoder counts from distance in feet </span>
</span><span id="Robot-671"><a href="#Robot-671"><span class="linenos"> 671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-672"><a href="#Robot-672"><span class="linenos"> 672</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">*</span> <span class="mf">0.3048</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Robot-673"><a href="#Robot-673"><span class="linenos"> 673</span></a>        <span class="n">encod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter2encoder</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</span><span id="Robot-674"><a href="#Robot-674"><span class="linenos"> 674</span></a>        <span class="k">return</span> <span class="n">encod</span>
</span><span id="Robot-675"><a href="#Robot-675"><span class="linenos"> 675</span></a>    
</span><span id="Robot-676"><a href="#Robot-676"><span class="linenos"> 676</span></a>    <span class="k">def</span> <span class="nf">_encoder2feet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_encod</span><span class="p">):</span>
</span><span id="Robot-677"><a href="#Robot-677"><span class="linenos"> 677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-678"><a href="#Robot-678"><span class="linenos"> 678</span></a><span class="sd">        Reads in encoder values and converts to</span>
</span><span id="Robot-679"><a href="#Robot-679"><span class="linenos"> 679</span></a><span class="sd">        feet</span>
</span><span id="Robot-680"><a href="#Robot-680"><span class="linenos"> 680</span></a><span class="sd">        </span>
</span><span id="Robot-681"><a href="#Robot-681"><span class="linenos"> 681</span></a><span class="sd">        Args:</span>
</span><span id="Robot-682"><a href="#Robot-682"><span class="linenos"> 682</span></a><span class="sd">            None</span>
</span><span id="Robot-683"><a href="#Robot-683"><span class="linenos"> 683</span></a><span class="sd">        </span>
</span><span id="Robot-684"><a href="#Robot-684"><span class="linenos"> 684</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-685"><a href="#Robot-685"><span class="linenos"> 685</span></a><span class="sd">            feet (float): converted encoder counts from distance in feet </span>
</span><span id="Robot-686"><a href="#Robot-686"><span class="linenos"> 686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-687"><a href="#Robot-687"><span class="linenos"> 687</span></a>        <span class="n">meter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2meter</span><span class="p">(</span><span class="n">x_encod</span><span class="p">)</span>
</span><span id="Robot-688"><a href="#Robot-688"><span class="linenos"> 688</span></a>        <span class="n">feet</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">meter</span> <span class="o">*</span> <span class="mf">3.28084</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Robot-689"><a href="#Robot-689"><span class="linenos"> 689</span></a>        
</span><span id="Robot-690"><a href="#Robot-690"><span class="linenos"> 690</span></a>        <span class="k">return</span> <span class="n">feet</span>
</span><span id="Robot-691"><a href="#Robot-691"><span class="linenos"> 691</span></a>    
</span><span id="Robot-692"><a href="#Robot-692"><span class="linenos"> 692</span></a>    <span class="k">def</span> <span class="nf">_feet2cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="Robot-693"><a href="#Robot-693"><span class="linenos"> 693</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-694"><a href="#Robot-694"><span class="linenos"> 694</span></a><span class="sd">        Reads in distance values in feet and converts to</span>
</span><span id="Robot-695"><a href="#Robot-695"><span class="linenos"> 695</span></a><span class="sd">        encoder counts</span>
</span><span id="Robot-696"><a href="#Robot-696"><span class="linenos"> 696</span></a><span class="sd">        </span>
</span><span id="Robot-697"><a href="#Robot-697"><span class="linenos"> 697</span></a><span class="sd">        Args:</span>
</span><span id="Robot-698"><a href="#Robot-698"><span class="linenos"> 698</span></a><span class="sd">            None</span>
</span><span id="Robot-699"><a href="#Robot-699"><span class="linenos"> 699</span></a><span class="sd">        </span>
</span><span id="Robot-700"><a href="#Robot-700"><span class="linenos"> 700</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-701"><a href="#Robot-701"><span class="linenos"> 701</span></a><span class="sd">            encod (int): converted encoder counts from distance in feet </span>
</span><span id="Robot-702"><a href="#Robot-702"><span class="linenos"> 702</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-703"><a href="#Robot-703"><span class="linenos"> 703</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mf">2.54</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Robot-704"><a href="#Robot-704"><span class="linenos"> 704</span></a>        
</span><span id="Robot-705"><a href="#Robot-705"><span class="linenos"> 705</span></a>        <span class="k">return</span> <span class="n">dist</span>
</span><span id="Robot-706"><a href="#Robot-706"><span class="linenos"> 706</span></a>    
</span><span id="Robot-707"><a href="#Robot-707"><span class="linenos"> 707</span></a>    <span class="k">def</span> <span class="nf">_cm2feet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_dist</span><span class="p">):</span>
</span><span id="Robot-708"><a href="#Robot-708"><span class="linenos"> 708</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-709"><a href="#Robot-709"><span class="linenos"> 709</span></a><span class="sd">        Reads in distance values in feet and converts to</span>
</span><span id="Robot-710"><a href="#Robot-710"><span class="linenos"> 710</span></a><span class="sd">        encoder counts</span>
</span><span id="Robot-711"><a href="#Robot-711"><span class="linenos"> 711</span></a><span class="sd">        </span>
</span><span id="Robot-712"><a href="#Robot-712"><span class="linenos"> 712</span></a><span class="sd">        Args:</span>
</span><span id="Robot-713"><a href="#Robot-713"><span class="linenos"> 713</span></a><span class="sd">            None</span>
</span><span id="Robot-714"><a href="#Robot-714"><span class="linenos"> 714</span></a><span class="sd">        </span>
</span><span id="Robot-715"><a href="#Robot-715"><span class="linenos"> 715</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-716"><a href="#Robot-716"><span class="linenos"> 716</span></a><span class="sd">            encod (int): converted encoder counts from distance in feet </span>
</span><span id="Robot-717"><a href="#Robot-717"><span class="linenos"> 717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-718"><a href="#Robot-718"><span class="linenos"> 718</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x_dist</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="mf">2.54</span><span class="p">)),</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-719"><a href="#Robot-719"><span class="linenos"> 719</span></a>        
</span><span id="Robot-720"><a href="#Robot-720"><span class="linenos"> 720</span></a>        <span class="k">return</span> <span class="n">dist</span>
</span><span id="Robot-721"><a href="#Robot-721"><span class="linenos"> 721</span></a>
</span><span id="Robot-722"><a href="#Robot-722"><span class="linenos"> 722</span></a>    <span class="k">def</span> <span class="nf">_imu_serial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-723"><a href="#Robot-723"><span class="linenos"> 723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-724"><a href="#Robot-724"><span class="linenos"> 724</span></a><span class="sd">        Reads in serial robot&#39;s yaw angle value from imu sensor, cleans buffer,</span>
</span><span id="Robot-725"><a href="#Robot-725"><span class="linenos"> 725</span></a><span class="sd">        and converts it into a float data type. Convers reading from 0-360 to</span>
</span><span id="Robot-726"><a href="#Robot-726"><span class="linenos"> 726</span></a><span class="sd">        -180 &lt; yaw &lt; 180.</span>
</span><span id="Robot-727"><a href="#Robot-727"><span class="linenos"> 727</span></a><span class="sd">        </span>
</span><span id="Robot-728"><a href="#Robot-728"><span class="linenos"> 728</span></a><span class="sd">        Args:</span>
</span><span id="Robot-729"><a href="#Robot-729"><span class="linenos"> 729</span></a><span class="sd">            None</span>
</span><span id="Robot-730"><a href="#Robot-730"><span class="linenos"> 730</span></a><span class="sd">        </span>
</span><span id="Robot-731"><a href="#Robot-731"><span class="linenos"> 731</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-732"><a href="#Robot-732"><span class="linenos"> 732</span></a><span class="sd">            self._yaw (float): robots yaw in degrees</span>
</span><span id="Robot-733"><a href="#Robot-733"><span class="linenos"> 733</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-734"><a href="#Robot-734"><span class="linenos"> 734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">reset_input_buffer</span><span class="p">()</span>
</span><span id="Robot-735"><a href="#Robot-735"><span class="linenos"> 735</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Robot-736"><a href="#Robot-736"><span class="linenos"> 736</span></a>        
</span><span id="Robot-737"><a href="#Robot-737"><span class="linenos"> 737</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot-738"><a href="#Robot-738"><span class="linenos"> 738</span></a>            
</span><span id="Robot-739"><a href="#Robot-739"><span class="linenos"> 739</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Robot-740"><a href="#Robot-740"><span class="linenos"> 740</span></a>                <span class="c1"># Read for imu from serial</span>
</span><span id="Robot-741"><a href="#Robot-741"><span class="linenos"> 741</span></a>                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Robot-742"><a href="#Robot-742"><span class="linenos"> 742</span></a>        <span class="c1">#                 if cnt &gt;5:</span>
</span><span id="Robot-743"><a href="#Robot-743"><span class="linenos"> 743</span></a>                    <span class="c1"># Strip serial stream of extra characters</span>
</span><span id="Robot-744"><a href="#Robot-744"><span class="linenos"> 744</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="Robot-745"><a href="#Robot-745"><span class="linenos"> 745</span></a>
</span><span id="Robot-746"><a href="#Robot-746"><span class="linenos"> 746</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="Robot-747"><a href="#Robot-747"><span class="linenos"> 747</span></a>
</span><span id="Robot-748"><a href="#Robot-748"><span class="linenos"> 748</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Robot-749"><a href="#Robot-749"><span class="linenos"> 749</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="Robot-750"><a href="#Robot-750"><span class="linenos"> 750</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;b&#39;&quot;</span><span class="p">)</span>
</span><span id="Robot-751"><a href="#Robot-751"><span class="linenos"> 751</span></a>
</span><span id="Robot-752"><a href="#Robot-752"><span class="linenos"> 752</span></a>                    <span class="c1"># Return float</span>
</span><span id="Robot-753"><a href="#Robot-753"><span class="linenos"> 753</span></a>                    <span class="n">line</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Robot-754"><a href="#Robot-754"><span class="linenos"> 754</span></a>                    
</span><span id="Robot-755"><a href="#Robot-755"><span class="linenos"> 755</span></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">line</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-756"><a href="#Robot-756"><span class="linenos"> 756</span></a>                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="Robot-757"><a href="#Robot-757"><span class="linenos"> 757</span></a>                        
</span><span id="Robot-758"><a href="#Robot-758"><span class="linenos"> 758</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="n">line</span>
</span><span id="Robot-759"><a href="#Robot-759"><span class="linenos"> 759</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-760"><a href="#Robot-760"><span class="linenos"> 760</span></a>                
</span><span id="Robot-761"><a href="#Robot-761"><span class="linenos"> 761</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot-762"><a href="#Robot-762"><span class="linenos"> 762</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imu Error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-763"><a href="#Robot-763"><span class="linenos"> 763</span></a>                
</span><span id="Robot-764"><a href="#Robot-764"><span class="linenos"> 764</span></a>    <span class="k">def</span> <span class="nf">_imu_serial_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">queue</span><span class="p">):</span>
</span><span id="Robot-765"><a href="#Robot-765"><span class="linenos"> 765</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-766"><a href="#Robot-766"><span class="linenos"> 766</span></a><span class="sd">        Reads in serial robot&#39;s yaw angle value from imu sensor, cleans buffer,</span>
</span><span id="Robot-767"><a href="#Robot-767"><span class="linenos"> 767</span></a><span class="sd">        and converts it into a float data type. Convers reading from 0-360 to</span>
</span><span id="Robot-768"><a href="#Robot-768"><span class="linenos"> 768</span></a><span class="sd">        -180 &lt; yaw &lt; 180.</span>
</span><span id="Robot-769"><a href="#Robot-769"><span class="linenos"> 769</span></a><span class="sd">        </span>
</span><span id="Robot-770"><a href="#Robot-770"><span class="linenos"> 770</span></a><span class="sd">        Only difference from self._imu_serial() is that this is run in a separate</span>
</span><span id="Robot-771"><a href="#Robot-771"><span class="linenos"> 771</span></a><span class="sd">        thread which is controlled by events to start, pause, and stop function call </span>
</span><span id="Robot-772"><a href="#Robot-772"><span class="linenos"> 772</span></a><span class="sd">        </span>
</span><span id="Robot-773"><a href="#Robot-773"><span class="linenos"> 773</span></a><span class="sd">        Args:</span>
</span><span id="Robot-774"><a href="#Robot-774"><span class="linenos"> 774</span></a><span class="sd">            None</span>
</span><span id="Robot-775"><a href="#Robot-775"><span class="linenos"> 775</span></a><span class="sd">        </span>
</span><span id="Robot-776"><a href="#Robot-776"><span class="linenos"> 776</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-777"><a href="#Robot-777"><span class="linenos"> 777</span></a><span class="sd">            self._yaw (float): robots yaw in degrees</span>
</span><span id="Robot-778"><a href="#Robot-778"><span class="linenos"> 778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-779"><a href="#Robot-779"><span class="linenos"> 779</span></a>        
</span><span id="Robot-780"><a href="#Robot-780"><span class="linenos"> 780</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="Robot-781"><a href="#Robot-781"><span class="linenos"> 781</span></a>            
</span><span id="Robot-782"><a href="#Robot-782"><span class="linenos"> 782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">reset_input_buffer</span><span class="p">()</span>
</span><span id="Robot-783"><a href="#Robot-783"><span class="linenos"> 783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Robot-784"><a href="#Robot-784"><span class="linenos"> 784</span></a>            
</span><span id="Robot-785"><a href="#Robot-785"><span class="linenos"> 785</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Robot-786"><a href="#Robot-786"><span class="linenos"> 786</span></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="Robot-787"><a href="#Robot-787"><span class="linenos"> 787</span></a>                    <span class="c1"># Read for imu from serial</span>
</span><span id="Robot-788"><a href="#Robot-788"><span class="linenos"> 788</span></a>                    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Robot-789"><a href="#Robot-789"><span class="linenos"> 789</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="Robot-790"><a href="#Robot-790"><span class="linenos"> 790</span></a>
</span><span id="Robot-791"><a href="#Robot-791"><span class="linenos"> 791</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</span><span id="Robot-792"><a href="#Robot-792"><span class="linenos"> 792</span></a>
</span><span id="Robot-793"><a href="#Robot-793"><span class="linenos"> 793</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Robot-794"><a href="#Robot-794"><span class="linenos"> 794</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span id="Robot-795"><a href="#Robot-795"><span class="linenos"> 795</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;b&#39;&quot;</span><span class="p">)</span>
</span><span id="Robot-796"><a href="#Robot-796"><span class="linenos"> 796</span></a>
</span><span id="Robot-797"><a href="#Robot-797"><span class="linenos"> 797</span></a>                            <span class="c1"># Return float</span>
</span><span id="Robot-798"><a href="#Robot-798"><span class="linenos"> 798</span></a>                            <span class="n">line</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Robot-799"><a href="#Robot-799"><span class="linenos"> 799</span></a>                            
</span><span id="Robot-800"><a href="#Robot-800"><span class="linenos"> 800</span></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">line</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-801"><a href="#Robot-801"><span class="linenos"> 801</span></a>                                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="Robot-802"><a href="#Robot-802"><span class="linenos"> 802</span></a>                                
</span><span id="Robot-803"><a href="#Robot-803"><span class="linenos"> 803</span></a>                            <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Robot-804"><a href="#Robot-804"><span class="linenos"> 804</span></a>
</span><span id="Robot-805"><a href="#Robot-805"><span class="linenos"> 805</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot-806"><a href="#Robot-806"><span class="linenos"> 806</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imu Error inside thread: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-807"><a href="#Robot-807"><span class="linenos"> 807</span></a>    
</span><span id="Robot-808"><a href="#Robot-808"><span class="linenos"> 808</span></a>    <span class="k">def</span> <span class="nf">_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-809"><a href="#Robot-809"><span class="linenos"> 809</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-810"><a href="#Robot-810"><span class="linenos"> 810</span></a><span class="sd">        Reads in serial robot&#39;s distance from an obstacle using ultrasonic sensor by</span>
</span><span id="Robot-811"><a href="#Robot-811"><span class="linenos"> 811</span></a><span class="sd">        sending a trigger pulse and listening the returning echo to compuse the separation</span>
</span><span id="Robot-812"><a href="#Robot-812"><span class="linenos"> 812</span></a><span class="sd">        distance from nearby object using triangulation technique. Then it saves computed</span>
</span><span id="Robot-813"><a href="#Robot-813"><span class="linenos"> 813</span></a><span class="sd">        distance in self._depth</span>
</span><span id="Robot-814"><a href="#Robot-814"><span class="linenos"> 814</span></a><span class="sd">        </span>
</span><span id="Robot-815"><a href="#Robot-815"><span class="linenos"> 815</span></a><span class="sd">        Args:</span>
</span><span id="Robot-816"><a href="#Robot-816"><span class="linenos"> 816</span></a><span class="sd">            None</span>
</span><span id="Robot-817"><a href="#Robot-817"><span class="linenos"> 817</span></a><span class="sd">        </span>
</span><span id="Robot-818"><a href="#Robot-818"><span class="linenos"> 818</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-819"><a href="#Robot-819"><span class="linenos"> 819</span></a><span class="sd">            None</span>
</span><span id="Robot-820"><a href="#Robot-820"><span class="linenos"> 820</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-821"><a href="#Robot-821"><span class="linenos"> 821</span></a>        <span class="n">pulse_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-822"><a href="#Robot-822"><span class="linenos"> 822</span></a>        <span class="n">pulse_end</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-823"><a href="#Robot-823"><span class="linenos"> 823</span></a>        
</span><span id="Robot-824"><a href="#Robot-824"><span class="linenos"> 824</span></a>        <span class="c1"># Define pin allocations</span>
</span><span id="Robot-825"><a href="#Robot-825"><span class="linenos"> 825</span></a>        <span class="n">trig</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="Robot-826"><a href="#Robot-826"><span class="linenos"> 826</span></a>        <span class="n">echo</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="Robot-827"><a href="#Robot-827"><span class="linenos"> 827</span></a>        <span class="c1"># Setup GPIO board &amp; pins</span>
</span><span id="Robot-828"><a href="#Robot-828"><span class="linenos"> 828</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
</span><span id="Robot-829"><a href="#Robot-829"><span class="linenos"> 829</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">echo</span><span class="p">,</span> <span class="n">gpio</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>
</span><span id="Robot-830"><a href="#Robot-830"><span class="linenos"> 830</span></a>        
</span><span id="Robot-831"><a href="#Robot-831"><span class="linenos"> 831</span></a>        <span class="c1"># Ensure output has no value</span>
</span><span id="Robot-832"><a href="#Robot-832"><span class="linenos"> 832</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="Robot-833"><a href="#Robot-833"><span class="linenos"> 833</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="Robot-834"><a href="#Robot-834"><span class="linenos"> 834</span></a>        
</span><span id="Robot-835"><a href="#Robot-835"><span class="linenos"> 835</span></a>        <span class="c1"># Generate trigger pulse</span>
</span><span id="Robot-836"><a href="#Robot-836"><span class="linenos"> 836</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-837"><a href="#Robot-837"><span class="linenos"> 837</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.00001</span><span class="p">)</span>
</span><span id="Robot-838"><a href="#Robot-838"><span class="linenos"> 838</span></a>        <span class="n">gpio</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">trig</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="Robot-839"><a href="#Robot-839"><span class="linenos"> 839</span></a>        
</span><span id="Robot-840"><a href="#Robot-840"><span class="linenos"> 840</span></a>        <span class="c1"># Generate echo time signal</span>
</span><span id="Robot-841"><a href="#Robot-841"><span class="linenos"> 841</span></a>        <span class="k">while</span> <span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Robot-842"><a href="#Robot-842"><span class="linenos"> 842</span></a>            <span class="n">pulse_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Robot-843"><a href="#Robot-843"><span class="linenos"> 843</span></a>            
</span><span id="Robot-844"><a href="#Robot-844"><span class="linenos"> 844</span></a>        <span class="k">while</span> <span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">echo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Robot-845"><a href="#Robot-845"><span class="linenos"> 845</span></a>            <span class="n">pulse_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Robot-846"><a href="#Robot-846"><span class="linenos"> 846</span></a>            
</span><span id="Robot-847"><a href="#Robot-847"><span class="linenos"> 847</span></a>        <span class="n">pulse_duration</span> <span class="o">=</span> <span class="n">pulse_end</span> <span class="o">-</span> <span class="n">pulse_start</span>
</span><span id="Robot-848"><a href="#Robot-848"><span class="linenos"> 848</span></a>        
</span><span id="Robot-849"><a href="#Robot-849"><span class="linenos"> 849</span></a>        <span class="c1"># Convert time to distance</span>
</span><span id="Robot-850"><a href="#Robot-850"><span class="linenos"> 850</span></a>        <span class="n">distance</span> <span class="o">=</span> <span class="n">pulse_duration</span> <span class="o">*</span> <span class="mi">17150</span>
</span><span id="Robot-851"><a href="#Robot-851"><span class="linenos"> 851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-852"><a href="#Robot-852"><span class="linenos"> 852</span></a>        
</span><span id="Robot-853"><a href="#Robot-853"><span class="linenos"> 853</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span>
</span><span id="Robot-854"><a href="#Robot-854"><span class="linenos"> 854</span></a>    
</span><span id="Robot-855"><a href="#Robot-855"><span class="linenos"> 855</span></a>    <span class="k">def</span> <span class="nf">_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-856"><a href="#Robot-856"><span class="linenos"> 856</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-857"><a href="#Robot-857"><span class="linenos"> 857</span></a><span class="sd">        Reads in direction of rotation requested, and starts</span>
</span><span id="Robot-858"><a href="#Robot-858"><span class="linenos"> 858</span></a><span class="sd">        rotating the motors accordingly to achieve desired orientation.</span>
</span><span id="Robot-859"><a href="#Robot-859"><span class="linenos"> 859</span></a><span class="sd">        </span>
</span><span id="Robot-860"><a href="#Robot-860"><span class="linenos"> 860</span></a><span class="sd">        </span>
</span><span id="Robot-861"><a href="#Robot-861"><span class="linenos"> 861</span></a><span class="sd">        Args:</span>
</span><span id="Robot-862"><a href="#Robot-862"><span class="linenos"> 862</span></a><span class="sd">            None</span>
</span><span id="Robot-863"><a href="#Robot-863"><span class="linenos"> 863</span></a><span class="sd">        </span>
</span><span id="Robot-864"><a href="#Robot-864"><span class="linenos"> 864</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-865"><a href="#Robot-865"><span class="linenos"> 865</span></a><span class="sd">            None</span>
</span><span id="Robot-866"><a href="#Robot-866"><span class="linenos"> 866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-867"><a href="#Robot-867"><span class="linenos"> 867</span></a>        
</span><span id="Robot-868"><a href="#Robot-868"><span class="linenos"> 868</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="Robot-869"><a href="#Robot-869"><span class="linenos"> 869</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pivotright</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> 
</span><span id="Robot-870"><a href="#Robot-870"><span class="linenos"> 870</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
</span><span id="Robot-871"><a href="#Robot-871"><span class="linenos"> 871</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pivotleft</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</span><span id="Robot-872"><a href="#Robot-872"><span class="linenos"> 872</span></a>            
</span><span id="Robot-873"><a href="#Robot-873"><span class="linenos"> 873</span></a>    <span class="k">def</span> <span class="nf">_dist_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-874"><a href="#Robot-874"><span class="linenos"> 874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-875"><a href="#Robot-875"><span class="linenos"> 875</span></a><span class="sd">        Reads in radius of bounding box from bbox detector function, and </span>
</span><span id="Robot-876"><a href="#Robot-876"><span class="linenos"> 876</span></a><span class="sd">        plugs radius into precomputed correlation function to estimate the</span>
</span><span id="Robot-877"><a href="#Robot-877"><span class="linenos"> 877</span></a><span class="sd">        depth of toy block from robot.</span>
</span><span id="Robot-878"><a href="#Robot-878"><span class="linenos"> 878</span></a><span class="sd">        </span>
</span><span id="Robot-879"><a href="#Robot-879"><span class="linenos"> 879</span></a><span class="sd">        Assigns results to self._travel and saves image showing value of distance</span>
</span><span id="Robot-880"><a href="#Robot-880"><span class="linenos"> 880</span></a><span class="sd">        appended to it in self._img_frame and writes frame to video object self._out</span>
</span><span id="Robot-881"><a href="#Robot-881"><span class="linenos"> 881</span></a><span class="sd">        </span>
</span><span id="Robot-882"><a href="#Robot-882"><span class="linenos"> 882</span></a><span class="sd">        Args:</span>
</span><span id="Robot-883"><a href="#Robot-883"><span class="linenos"> 883</span></a><span class="sd">            None</span>
</span><span id="Robot-884"><a href="#Robot-884"><span class="linenos"> 884</span></a><span class="sd">        </span>
</span><span id="Robot-885"><a href="#Robot-885"><span class="linenos"> 885</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-886"><a href="#Robot-886"><span class="linenos"> 886</span></a><span class="sd">            None</span>
</span><span id="Robot-887"><a href="#Robot-887"><span class="linenos"> 887</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-888"><a href="#Robot-888"><span class="linenos"> 888</span></a>        <span class="c1"># Take image with picamera</span>
</span><span id="Robot-889"><a href="#Robot-889"><span class="linenos"> 889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-890"><a href="#Robot-890"><span class="linenos"> 890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="Robot-891"><a href="#Robot-891"><span class="linenos"> 891</span></a>
</span><span id="Robot-892"><a href="#Robot-892"><span class="linenos"> 892</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
</span><span id="Robot-893"><a href="#Robot-893"><span class="linenos"> 893</span></a>            <span class="c1"># Plug in pixel size into depth equation</span>
</span><span id="Robot-894"><a href="#Robot-894"><span class="linenos"> 894</span></a>            <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0099</span> <span class="o">*</span> <span class="n">bbox_radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.8846</span><span class="o">*</span><span class="n">bbox_radius</span><span class="p">)</span> <span class="o">+</span> <span class="mf">103.47</span>
</span><span id="Robot-895"><a href="#Robot-895"><span class="linenos"> 895</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_travel</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-896"><a href="#Robot-896"><span class="linenos"> 896</span></a>            <span class="c1"># Append image of estimated distance on image frame</span>
</span><span id="Robot-897"><a href="#Robot-897"><span class="linenos"> 897</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="p">)</span>
</span><span id="Robot-898"><a href="#Robot-898"><span class="linenos"> 898</span></a>            <span class="c1"># save image into video object</span>
</span><span id="Robot-899"><a href="#Robot-899"><span class="linenos"> 899</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-900"><a href="#Robot-900"><span class="linenos"> 900</span></a>    <span class="k">def</span> <span class="nf">_corner_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">origImg</span><span class="p">):</span>
</span><span id="Robot-901"><a href="#Robot-901"><span class="linenos"> 901</span></a>
</span><span id="Robot-902"><a href="#Robot-902"><span class="linenos"> 902</span></a>        <span class="c1"># Create a list to store the x,y location of points</span>
</span><span id="Robot-903"><a href="#Robot-903"><span class="linenos"> 903</span></a>        <span class="n">pts_loc</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot-904"><a href="#Robot-904"><span class="linenos"> 904</span></a>        
</span><span id="Robot-905"><a href="#Robot-905"><span class="linenos"> 905</span></a>        <span class="c1"># Detect corners from image</span>
</span><span id="Robot-906"><a href="#Robot-906"><span class="linenos"> 906</span></a>        <span class="n">corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Robot-907"><a href="#Robot-907"><span class="linenos"> 907</span></a>        
</span><span id="Robot-908"><a href="#Robot-908"><span class="linenos"> 908</span></a>        <span class="k">if</span> <span class="n">corners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Robot-909"><a href="#Robot-909"><span class="linenos"> 909</span></a>        
</span><span id="Robot-910"><a href="#Robot-910"><span class="linenos"> 910</span></a>            <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int0</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</span><span id="Robot-911"><a href="#Robot-911"><span class="linenos"> 911</span></a>            
</span><span id="Robot-912"><a href="#Robot-912"><span class="linenos"> 912</span></a>            <span class="c1"># identify location of corners in image</span>
</span><span id="Robot-913"><a href="#Robot-913"><span class="linenos"> 913</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
</span><span id="Robot-914"><a href="#Robot-914"><span class="linenos"> 914</span></a>                <span class="c1"># Extract x,y coordinate of points</span>
</span><span id="Robot-915"><a href="#Robot-915"><span class="linenos"> 915</span></a>                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Robot-916"><a href="#Robot-916"><span class="linenos"> 916</span></a>
</span><span id="Robot-917"><a href="#Robot-917"><span class="linenos"> 917</span></a>                <span class="n">pts_loc</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
</span><span id="Robot-918"><a href="#Robot-918"><span class="linenos"> 918</span></a>                
</span><span id="Robot-919"><a href="#Robot-919"><span class="linenos"> 919</span></a>                <span class="c1"># Draw circle ontop of original image</span>
</span><span id="Robot-920"><a href="#Robot-920"><span class="linenos"> 920</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">origImg</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-921"><a href="#Robot-921"><span class="linenos"> 921</span></a>
</span><span id="Robot-922"><a href="#Robot-922"><span class="linenos"> 922</span></a>            <span class="c1"># Create a column vector from pts list</span>
</span><span id="Robot-923"><a href="#Robot-923"><span class="linenos"> 923</span></a>            <span class="n">pts_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts_loc</span><span class="p">)</span>
</span><span id="Robot-924"><a href="#Robot-924"><span class="linenos"> 924</span></a>            
</span><span id="Robot-925"><a href="#Robot-925"><span class="linenos"> 925</span></a>            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">pts_loc</span><span class="p">,</span> <span class="n">origImg</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="Robot-926"><a href="#Robot-926"><span class="linenos"> 926</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-927"><a href="#Robot-927"><span class="linenos"> 927</span></a>            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">pts_loc</span><span class="p">,</span> <span class="n">origImg</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Robot-928"><a href="#Robot-928"><span class="linenos"> 928</span></a>    
</span><span id="Robot-929"><a href="#Robot-929"><span class="linenos"> 929</span></a>    <span class="k">def</span> <span class="nf">_center_det</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pt_list</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
</span><span id="Robot-930"><a href="#Robot-930"><span class="linenos"> 930</span></a>        
</span><span id="Robot-931"><a href="#Robot-931"><span class="linenos"> 931</span></a>        <span class="c1"># Extract x,y points from pt_list</span>
</span><span id="Robot-932"><a href="#Robot-932"><span class="linenos"> 932</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">pt_list</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-933"><a href="#Robot-933"><span class="linenos"> 933</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">pt_list</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-934"><a href="#Robot-934"><span class="linenos"> 934</span></a>        
</span><span id="Robot-935"><a href="#Robot-935"><span class="linenos"> 935</span></a>        <span class="c1"># Determine the min and max width &amp; height values</span>
</span><span id="Robot-936"><a href="#Robot-936"><span class="linenos"> 936</span></a>        <span class="c1"># of the points, as if to drow rectangle around arrow</span>
</span><span id="Robot-937"><a href="#Robot-937"><span class="linenos"> 937</span></a>        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Robot-938"><a href="#Robot-938"><span class="linenos"> 938</span></a>        <span class="n">y_min</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Robot-939"><a href="#Robot-939"><span class="linenos"> 939</span></a>        
</span><span id="Robot-940"><a href="#Robot-940"><span class="linenos"> 940</span></a>        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Robot-941"><a href="#Robot-941"><span class="linenos"> 941</span></a>        <span class="n">y_max</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Robot-942"><a href="#Robot-942"><span class="linenos"> 942</span></a>        
</span><span id="Robot-943"><a href="#Robot-943"><span class="linenos"> 943</span></a>        <span class="c1"># Store height of bounding box</span>
</span><span id="Robot-944"><a href="#Robot-944"><span class="linenos"> 944</span></a>        <span class="n">vert_dst</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>
</span><span id="Robot-945"><a href="#Robot-945"><span class="linenos"> 945</span></a>        
</span><span id="Robot-946"><a href="#Robot-946"><span class="linenos"> 946</span></a>        <span class="c1"># Store width of bounding box</span>
</span><span id="Robot-947"><a href="#Robot-947"><span class="linenos"> 947</span></a>        <span class="n">horz_dst</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
</span><span id="Robot-948"><a href="#Robot-948"><span class="linenos"> 948</span></a>        
</span><span id="Robot-949"><a href="#Robot-949"><span class="linenos"> 949</span></a>        <span class="c1"># Compute and store half dimensions of</span>
</span><span id="Robot-950"><a href="#Robot-950"><span class="linenos"> 950</span></a>        <span class="c1"># box, will come later when determining</span>
</span><span id="Robot-951"><a href="#Robot-951"><span class="linenos"> 951</span></a>        <span class="c1"># arrow direction</span>
</span><span id="Robot-952"><a href="#Robot-952"><span class="linenos"> 952</span></a>        <span class="n">y_half</span> <span class="o">=</span> <span class="n">vert_dst</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y_min</span>
</span><span id="Robot-953"><a href="#Robot-953"><span class="linenos"> 953</span></a>        <span class="n">x_half</span> <span class="o">=</span> <span class="n">horz_dst</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_min</span>
</span><span id="Robot-954"><a href="#Robot-954"><span class="linenos"> 954</span></a>        
</span><span id="Robot-955"><a href="#Robot-955"><span class="linenos"> 955</span></a>        <span class="c1"># Store center of the block</span>
</span><span id="Robot-956"><a href="#Robot-956"><span class="linenos"> 956</span></a>        <span class="c1">#center = [int(round(x_half)), int(round(y_half))]</span>
</span><span id="Robot-957"><a href="#Robot-957"><span class="linenos"> 957</span></a>        <span class="n">center</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x_half</span><span class="p">)))</span>
</span><span id="Robot-958"><a href="#Robot-958"><span class="linenos"> 958</span></a>        <span class="n">center</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">y_half</span><span class="p">)))</span>
</span><span id="Robot-959"><a href="#Robot-959"><span class="linenos"> 959</span></a>        <span class="c1"># Estimate radius</span>
</span><span id="Robot-960"><a href="#Robot-960"><span class="linenos"> 960</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_half</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_half</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-961"><a href="#Robot-961"><span class="linenos"> 961</span></a>            
</span><span id="Robot-962"><a href="#Robot-962"><span class="linenos"> 962</span></a>        <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_radius</span>
</span><span id="Robot-963"><a href="#Robot-963"><span class="linenos"> 963</span></a>    
</span><span id="Robot-964"><a href="#Robot-964"><span class="linenos"> 964</span></a>    <span class="k">def</span> <span class="nf">_bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-965"><a href="#Robot-965"><span class="linenos"> 965</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-966"><a href="#Robot-966"><span class="linenos"> 966</span></a><span class="sd">        Reads in an image, and then applies preprocessing functions that mask and</span>
</span><span id="Robot-967"><a href="#Robot-967"><span class="linenos"> 967</span></a><span class="sd">        blur image. Then, attempts to detect corners of an object in frame, and if </span>
</span><span id="Robot-968"><a href="#Robot-968"><span class="linenos"> 968</span></a><span class="sd">        successful it will run further computation to determine the center and radius</span>
</span><span id="Robot-969"><a href="#Robot-969"><span class="linenos"> 969</span></a><span class="sd">        of detected object. Finally adds the draws the bounding circle and center point</span>
</span><span id="Robot-970"><a href="#Robot-970"><span class="linenos"> 970</span></a><span class="sd">        as well as write computed values on original image</span>
</span><span id="Robot-971"><a href="#Robot-971"><span class="linenos"> 971</span></a><span class="sd">        </span>
</span><span id="Robot-972"><a href="#Robot-972"><span class="linenos"> 972</span></a><span class="sd">        Assigns results to self._travel and saves image showing value of distance</span>
</span><span id="Robot-973"><a href="#Robot-973"><span class="linenos"> 973</span></a><span class="sd">        appended to it in self._img_frame and writes frame to video object self._out</span>
</span><span id="Robot-974"><a href="#Robot-974"><span class="linenos"> 974</span></a><span class="sd">        </span>
</span><span id="Robot-975"><a href="#Robot-975"><span class="linenos"> 975</span></a><span class="sd">        Args:</span>
</span><span id="Robot-976"><a href="#Robot-976"><span class="linenos"> 976</span></a><span class="sd">            image (image): Original colored image taken in from camera</span>
</span><span id="Robot-977"><a href="#Robot-977"><span class="linenos"> 977</span></a><span class="sd">        </span>
</span><span id="Robot-978"><a href="#Robot-978"><span class="linenos"> 978</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-979"><a href="#Robot-979"><span class="linenos"> 979</span></a><span class="sd">            bbox_radius (float): Radius of bounding circle detecting object</span>
</span><span id="Robot-980"><a href="#Robot-980"><span class="linenos"> 980</span></a><span class="sd">            len(pts_loc) (int): The number of corner points identified on object from frame</span>
</span><span id="Robot-981"><a href="#Robot-981"><span class="linenos"> 981</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-982"><a href="#Robot-982"><span class="linenos"> 982</span></a>        <span class="c1"># Initialize list to save corner points and bbox radius</span>
</span><span id="Robot-983"><a href="#Robot-983"><span class="linenos"> 983</span></a>        <span class="n">bbox_radius</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-984"><a href="#Robot-984"><span class="linenos"> 984</span></a>        <span class="n">pts_loc</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot-985"><a href="#Robot-985"><span class="linenos"> 985</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot-986"><a href="#Robot-986"><span class="linenos"> 986</span></a>        
</span><span id="Robot-987"><a href="#Robot-987"><span class="linenos"> 987</span></a>        <span class="c1"># Take image using camera frame</span>
</span><span id="Robot-988"><a href="#Robot-988"><span class="linenos"> 988</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-989"><a href="#Robot-989"><span class="linenos"> 989</span></a>        
</span><span id="Robot-990"><a href="#Robot-990"><span class="linenos"> 990</span></a>        <span class="c1"># Prepare image by masking and blurring</span>
</span><span id="Robot-991"><a href="#Robot-991"><span class="linenos"> 991</span></a>        <span class="n">image_blurred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">()</span>
</span><span id="Robot-992"><a href="#Robot-992"><span class="linenos"> 992</span></a>
</span><span id="Robot-993"><a href="#Robot-993"><span class="linenos"> 993</span></a>        <span class="c1"># Extract bbox radius from image</span>
</span><span id="Robot-994"><a href="#Robot-994"><span class="linenos"> 994</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="n">image_blurred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-995"><a href="#Robot-995"><span class="linenos"> 995</span></a>        
</span><span id="Robot-996"><a href="#Robot-996"><span class="linenos"> 996</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span>
</span><span id="Robot-997"><a href="#Robot-997"><span class="linenos"> 997</span></a>        
</span><span id="Robot-998"><a href="#Robot-998"><span class="linenos"> 998</span></a><span class="c1">#         # Detect corners from image</span>
</span><span id="Robot-999"><a href="#Robot-999"><span class="linenos"> 999</span></a><span class="c1">#         img_crnr, pts_loc, image, var = self._corner_detect(image_blurred, self._img_frame)</span>
</span><span id="Robot-1000"><a href="#Robot-1000"><span class="linenos">1000</span></a><span class="c1">#         </span>
</span><span id="Robot-1001"><a href="#Robot-1001"><span class="linenos">1001</span></a><span class="c1">#         if var is not None:</span>
</span><span id="Robot-1002"><a href="#Robot-1002"><span class="linenos">1002</span></a><span class="c1"># </span>
</span><span id="Robot-1003"><a href="#Robot-1003"><span class="linenos">1003</span></a><span class="c1">#             # Check if corners are detected</span>
</span><span id="Robot-1004"><a href="#Robot-1004"><span class="linenos">1004</span></a><span class="c1">#             if len(pts_loc) &gt; 3:</span>
</span><span id="Robot-1005"><a href="#Robot-1005"><span class="linenos">1005</span></a><span class="c1">#                 ## Draw contours over an image, if available</span>
</span><span id="Robot-1006"><a href="#Robot-1006"><span class="linenos">1006</span></a><span class="c1">#                 center, bbox_radius = self._center_det(pts_loc, center)</span>
</span><span id="Robot-1007"><a href="#Robot-1007"><span class="linenos">1007</span></a><span class="c1"># </span>
</span><span id="Robot-1008"><a href="#Robot-1008"><span class="linenos">1008</span></a><span class="c1">#                 block_coordinate = &quot;(&quot; + str(center[0]) + &quot;,&quot; + str(center[1]) + &quot;)&quot;</span>
</span><span id="Robot-1009"><a href="#Robot-1009"><span class="linenos">1009</span></a><span class="c1">#                 </span>
</span><span id="Robot-1010"><a href="#Robot-1010"><span class="linenos">1010</span></a><span class="c1">#                 # Draw circle ontop of original image</span>
</span><span id="Robot-1011"><a href="#Robot-1011"><span class="linenos">1011</span></a><span class="c1">#                 cv2.circle(image, tuple(center), bbox_radius, (0,255,255),2)</span>
</span><span id="Robot-1012"><a href="#Robot-1012"><span class="linenos">1012</span></a><span class="c1">#                 cv2.circle(image, tuple(center), 0,(0,0,255),5)</span>
</span><span id="Robot-1013"><a href="#Robot-1013"><span class="linenos">1013</span></a><span class="c1">#                 cv2.putText(image,block_coordinate,(0,int(self.cy)),self.font,2,(0,0,0),2)</span>
</span><span id="Robot-1014"><a href="#Robot-1014"><span class="linenos">1014</span></a><span class="c1">#                 </span>
</span><span id="Robot-1015"><a href="#Robot-1015"><span class="linenos">1015</span></a><span class="c1">#                 # Draw a cross at center of frame</span>
</span><span id="Robot-1016"><a href="#Robot-1016"><span class="linenos">1016</span></a><span class="c1">#                 cv2.line(image,(self.frame_center[0]-100, self.frame_center[1]),(self.frame_center[0]+100, self.frame_center[1]), (0,0,0))</span>
</span><span id="Robot-1017"><a href="#Robot-1017"><span class="linenos">1017</span></a><span class="c1">#                 cv2.line(image,(self.frame_center[0], self.frame_center[1]-100),(self.frame_center[0], self.frame_center[1]+100), (0,0,0))</span>
</span><span id="Robot-1018"><a href="#Robot-1018"><span class="linenos">1018</span></a><span class="c1">#                 </span>
</span><span id="Robot-1019"><a href="#Robot-1019"><span class="linenos">1019</span></a><span class="c1">#                 success = True</span>
</span><span id="Robot-1020"><a href="#Robot-1020"><span class="linenos">1020</span></a><span class="c1">#                 </span>
</span><span id="Robot-1021"><a href="#Robot-1021"><span class="linenos">1021</span></a><span class="c1">#                 self._logger.info(f&quot;{self._block_now} block is detected&quot;)</span>
</span><span id="Robot-1022"><a href="#Robot-1022"><span class="linenos">1022</span></a><span class="c1">#                 time.sleep(1)</span>
</span><span id="Robot-1023"><a href="#Robot-1023"><span class="linenos">1023</span></a><span class="c1">#                             </span>
</span><span id="Robot-1024"><a href="#Robot-1024"><span class="linenos">1024</span></a><span class="c1">#                 return image, center, bbox_radius, success</span>
</span><span id="Robot-1025"><a href="#Robot-1025"><span class="linenos">1025</span></a><span class="c1">#             </span>
</span><span id="Robot-1026"><a href="#Robot-1026"><span class="linenos">1026</span></a><span class="c1">#             else:</span>
</span><span id="Robot-1027"><a href="#Robot-1027"><span class="linenos">1027</span></a><span class="c1">#                 self._logger.info(&quot;Not clearly detected&quot;)</span>
</span><span id="Robot-1028"><a href="#Robot-1028"><span class="linenos">1028</span></a><span class="c1">#                 success = False</span>
</span><span id="Robot-1029"><a href="#Robot-1029"><span class="linenos">1029</span></a><span class="c1">#                 </span>
</span><span id="Robot-1030"><a href="#Robot-1030"><span class="linenos">1030</span></a><span class="c1">#                 return image, center, bbox_radius, success</span>
</span><span id="Robot-1031"><a href="#Robot-1031"><span class="linenos">1031</span></a><span class="c1">#     </span>
</span><span id="Robot-1032"><a href="#Robot-1032"><span class="linenos">1032</span></a><span class="c1">#         else:</span>
</span><span id="Robot-1033"><a href="#Robot-1033"><span class="linenos">1033</span></a><span class="c1">#             print(&quot;No object of interest in scene&quot;)</span>
</span><span id="Robot-1034"><a href="#Robot-1034"><span class="linenos">1034</span></a><span class="c1">#             return image, 0, 0, success</span>
</span><span id="Robot-1035"><a href="#Robot-1035"><span class="linenos">1035</span></a>        
</span><span id="Robot-1036"><a href="#Robot-1036"><span class="linenos">1036</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Radius </span><span class="si">{</span><span class="n">bbox_radius</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1037"><a href="#Robot-1037"><span class="linenos">1037</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of corners/edges detected are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pts_loc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1038"><a href="#Robot-1038"><span class="linenos">1038</span></a>        
</span><span id="Robot-1039"><a href="#Robot-1039"><span class="linenos">1039</span></a>        <span class="c1">#return bbox_radius, center #, len(pts_loc),</span>
</span><span id="Robot-1040"><a href="#Robot-1040"><span class="linenos">1040</span></a>    
</span><span id="Robot-1041"><a href="#Robot-1041"><span class="linenos">1041</span></a>    <span class="k">def</span> <span class="nf">_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">deg_diff</span><span class="p">,</span><span class="n">just_turn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">steady</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Robot-1042"><a href="#Robot-1042"><span class="linenos">1042</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1043"><a href="#Robot-1043"><span class="linenos">1043</span></a><span class="sd">        This function pivots robot to deseired angle</span>
</span><span id="Robot-1044"><a href="#Robot-1044"><span class="linenos">1044</span></a>
</span><span id="Robot-1045"><a href="#Robot-1045"><span class="linenos">1045</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1046"><a href="#Robot-1046"><span class="linenos">1046</span></a><span class="sd">            deg_diff (float): Amount of angular rotation to turn.</span>
</span><span id="Robot-1047"><a href="#Robot-1047"><span class="linenos">1047</span></a><span class="sd">                      Default value is self._turn parameter</span>
</span><span id="Robot-1048"><a href="#Robot-1048"><span class="linenos">1048</span></a><span class="sd">            </span>
</span><span id="Robot-1049"><a href="#Robot-1049"><span class="linenos">1049</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1050"><a href="#Robot-1050"><span class="linenos">1050</span></a><span class="sd">            None</span>
</span><span id="Robot-1051"><a href="#Robot-1051"><span class="linenos">1051</span></a><span class="sd">            </span>
</span><span id="Robot-1052"><a href="#Robot-1052"><span class="linenos">1052</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1053"><a href="#Robot-1053"><span class="linenos">1053</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inside pivot function&quot;</span><span class="p">)</span>
</span><span id="Robot-1054"><a href="#Robot-1054"><span class="linenos">1054</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;rotating&#39;</span>
</span><span id="Robot-1055"><a href="#Robot-1055"><span class="linenos">1055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1056"><a href="#Robot-1056"><span class="linenos">1056</span></a>        
</span><span id="Robot-1057"><a href="#Robot-1057"><span class="linenos">1057</span></a>        <span class="c1"># To know the direction of turn. Notation based on camera object detection</span>
</span><span id="Robot-1058"><a href="#Robot-1058"><span class="linenos">1058</span></a>        <span class="c1"># notation</span>
</span><span id="Robot-1059"><a href="#Robot-1059"><span class="linenos">1059</span></a><span class="c1">#         thresh = 0.8</span>
</span><span id="Robot-1060"><a href="#Robot-1060"><span class="linenos">1060</span></a>        <span class="k">if</span> <span class="n">deg_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Robot-1061"><a href="#Robot-1061"><span class="linenos">1061</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
</span><span id="Robot-1062"><a href="#Robot-1062"><span class="linenos">1062</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-1063"><a href="#Robot-1063"><span class="linenos">1063</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span>
</span><span id="Robot-1064"><a href="#Robot-1064"><span class="linenos">1064</span></a><span class="c1">#             thresh = -0.8</span>
</span><span id="Robot-1065"><a href="#Robot-1065"><span class="linenos">1065</span></a>        
</span><span id="Robot-1066"><a href="#Robot-1066"><span class="linenos">1066</span></a>        <span class="c1"># Initialize change in time for derivative control</span>
</span><span id="Robot-1067"><a href="#Robot-1067"><span class="linenos">1067</span></a>        <span class="n">zones</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-1068"><a href="#Robot-1068"><span class="linenos">1068</span></a>        
</span><span id="Robot-1069"><a href="#Robot-1069"><span class="linenos">1069</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1070"><a href="#Robot-1070"><span class="linenos">1070</span></a>        <span class="n">yaw_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1071"><a href="#Robot-1071"><span class="linenos">1071</span></a>        
</span><span id="Robot-1072"><a href="#Robot-1072"><span class="linenos">1072</span></a>        <span class="c1"># Angle diff initialized</span>
</span><span id="Robot-1073"><a href="#Robot-1073"><span class="linenos">1073</span></a>        <span class="n">yaw_diff0</span> <span class="o">=</span> <span class="n">deg_diff</span> <span class="o">+</span> <span class="mf">0.001</span>
</span><span id="Robot-1074"><a href="#Robot-1074"><span class="linenos">1074</span></a>
</span><span id="Robot-1075"><a href="#Robot-1075"><span class="linenos">1075</span></a>        <span class="n">yaw_final</span> <span class="o">=</span> <span class="n">yaw_start</span> <span class="o">+</span> <span class="n">deg_diff</span>
</span><span id="Robot-1076"><a href="#Robot-1076"><span class="linenos">1076</span></a>        <span class="n">yaw_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="n">yaw_start</span>
</span><span id="Robot-1077"><a href="#Robot-1077"><span class="linenos">1077</span></a>        <span class="n">yaw_diff_old</span> <span class="o">=</span> <span class="n">yaw_diff</span>
</span><span id="Robot-1078"><a href="#Robot-1078"><span class="linenos">1078</span></a>        
</span><span id="Robot-1079"><a href="#Robot-1079"><span class="linenos">1079</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Needed final yaw is </span><span class="si">{</span><span class="n">yaw_final</span><span class="si">}</span><span class="s2"> degrees&quot;</span><span class="p">)</span>
</span><span id="Robot-1080"><a href="#Robot-1080"><span class="linenos">1080</span></a>        <span class="n">yaw_current</span> <span class="o">=</span> <span class="n">yaw_start</span>
</span><span id="Robot-1081"><a href="#Robot-1081"><span class="linenos">1081</span></a>        <span class="c1"># Lower and upper bounds of dutycycle initialized</span>
</span><span id="Robot-1082"><a href="#Robot-1082"><span class="linenos">1082</span></a>        <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="Robot-1083"><a href="#Robot-1083"><span class="linenos">1083</span></a>        <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">90</span>
</span><span id="Robot-1084"><a href="#Robot-1084"><span class="linenos">1084</span></a>        <span class="c1"># Divide the distance traveled into three zones</span>
</span><span id="Robot-1085"><a href="#Robot-1085"><span class="linenos">1085</span></a>        <span class="n">trip</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">yaw_diff</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">]</span>
</span><span id="Robot-1086"><a href="#Robot-1086"><span class="linenos">1086</span></a>        <span class="c1"># Variables for PID control</span>
</span><span id="Robot-1087"><a href="#Robot-1087"><span class="linenos">1087</span></a>        <span class="n">derivative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1088"><a href="#Robot-1088"><span class="linenos">1088</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1089"><a href="#Robot-1089"><span class="linenos">1089</span></a>
</span><span id="Robot-1090"><a href="#Robot-1090"><span class="linenos">1090</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Robot-1091"><a href="#Robot-1091"><span class="linenos">1091</span></a>        <span class="n">yaw_diff_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-1092"><a href="#Robot-1092"><span class="linenos">1092</span></a>        <span class="n">yaw_diff_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span>
</span><span id="Robot-1093"><a href="#Robot-1093"><span class="linenos">1093</span></a>        <span class="n">window_size</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Robot-1094"><a href="#Robot-1094"><span class="linenos">1094</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot-1095"><a href="#Robot-1095"><span class="linenos">1095</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Robot-1096"><a href="#Robot-1096"><span class="linenos">1096</span></a>                
</span><span id="Robot-1097"><a href="#Robot-1097"><span class="linenos">1097</span></a>                <span class="c1">#prcnt = abs(self._imu_serial() - yaw_start)/deg_diff</span>
</span><span id="Robot-1098"><a href="#Robot-1098"><span class="linenos">1098</span></a>                <span class="n">prcnt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">yaw_diff</span><span class="o">/</span><span class="n">yaw_diff0</span>
</span><span id="Robot-1099"><a href="#Robot-1099"><span class="linenos">1099</span></a>                
</span><span id="Robot-1100"><a href="#Robot-1100"><span class="linenos">1100</span></a>                <span class="c1"># Adopting moving average</span>
</span><span id="Robot-1101"><a href="#Robot-1101"><span class="linenos">1101</span></a><span class="c1">#                 cumsum = np.cumsum(yaw_diff_list)</span>
</span><span id="Robot-1102"><a href="#Robot-1102"><span class="linenos">1102</span></a><span class="c1">#                 cumsum[window_size:] = cumsum[window_size:] - cumsum[:-window_size]</span>
</span><span id="Robot-1103"><a href="#Robot-1103"><span class="linenos">1103</span></a><span class="c1">#                 moving_avg = cumsum[window_size - 1:] / window_size</span>
</span><span id="Robot-1104"><a href="#Robot-1104"><span class="linenos">1104</span></a>                
</span><span id="Robot-1105"><a href="#Robot-1105"><span class="linenos">1105</span></a>                <span class="k">if</span> <span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prcnt</span> <span class="o">&lt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Robot-1106"><a href="#Robot-1106"><span class="linenos">1106</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1107"><a href="#Robot-1107"><span class="linenos">1107</span></a>                <span class="k">elif</span> <span class="n">prcnt</span> <span class="o">&gt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Robot-1108"><a href="#Robot-1108"><span class="linenos">1108</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="Robot-1109"><a href="#Robot-1109"><span class="linenos">1109</span></a>                    
</span><span id="Robot-1110"><a href="#Robot-1110"><span class="linenos">1110</span></a>                <span class="c1"># Save robots pose by saving its x, yaw position            </span>
</span><span id="Robot-1111"><a href="#Robot-1111"><span class="linenos">1111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-1112"><a href="#Robot-1112"><span class="linenos">1112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">],</span> <span class="n">lower_dc</span><span class="p">,</span> <span class="n">upper_dc</span><span class="p">)</span>
</span><span id="Robot-1113"><a href="#Robot-1113"><span class="linenos">1113</span></a>                
</span><span id="Robot-1114"><a href="#Robot-1114"><span class="linenos">1114</span></a>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Robot-1115"><a href="#Robot-1115"><span class="linenos">1115</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65</span>
</span><span id="Robot-1116"><a href="#Robot-1116"><span class="linenos">1116</span></a>                    
</span><span id="Robot-1117"><a href="#Robot-1117"><span class="linenos">1117</span></a>                <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="Robot-1118"><a href="#Robot-1118"><span class="linenos">1118</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Robot-1119"><a href="#Robot-1119"><span class="linenos">1119</span></a>                
</span><span id="Robot-1120"><a href="#Robot-1120"><span class="linenos">1120</span></a>                    
</span><span id="Robot-1121"><a href="#Robot-1121"><span class="linenos">1121</span></a>                
</span><span id="Robot-1122"><a href="#Robot-1122"><span class="linenos">1122</span></a>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">:</span>
</span><span id="Robot-1123"><a href="#Robot-1123"><span class="linenos">1123</span></a>                    
</span><span id="Robot-1124"><a href="#Robot-1124"><span class="linenos">1124</span></a>                    <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">yaw_diff_old</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">yaw_diff</span><span class="o">-</span><span class="n">yaw_diff_old</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)):</span>
</span><span id="Robot-1125"><a href="#Robot-1125"><span class="linenos">1125</span></a><span class="c1">#                     if (abs(yaw_diff - np.mean(yaw_diff_list[-3:-1])) &lt; 5):</span>
</span><span id="Robot-1126"><a href="#Robot-1126"><span class="linenos">1126</span></a><span class="c1">#                     if abs(yaw_diff) &gt;= 0.5:</span>
</span><span id="Robot-1127"><a href="#Robot-1127"><span class="linenos">1127</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current yaw </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span><span class="si">}</span><span class="s2">; Angle turning towards </span><span class="si">{</span><span class="n">yaw_final</span><span class="si">}</span><span class="s2">; Error yaw </span><span class="si">{</span><span class="n">yaw_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1128"><a href="#Robot-1128"><span class="linenos">1128</span></a>
</span><span id="Robot-1129"><a href="#Robot-1129"><span class="linenos">1129</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1130"><a href="#Robot-1130"><span class="linenos">1130</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="Robot-1131"><a href="#Robot-1131"><span class="linenos">1131</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotright</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">])</span> 
</span><span id="Robot-1132"><a href="#Robot-1132"><span class="linenos">1132</span></a>                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
</span><span id="Robot-1133"><a href="#Robot-1133"><span class="linenos">1133</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotleft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">])</span>
</span><span id="Robot-1134"><a href="#Robot-1134"><span class="linenos">1134</span></a>                        <span class="k">else</span><span class="p">:</span>                        
</span><span id="Robot-1135"><a href="#Robot-1135"><span class="linenos">1135</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="Robot-1136"><a href="#Robot-1136"><span class="linenos">1136</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotright</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span> 
</span><span id="Robot-1137"><a href="#Robot-1137"><span class="linenos">1137</span></a>                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
</span><span id="Robot-1138"><a href="#Robot-1138"><span class="linenos">1138</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_pivotleft</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
</span><span id="Robot-1139"><a href="#Robot-1139"><span class="linenos">1139</span></a>                        
</span><span id="Robot-1140"><a href="#Robot-1140"><span class="linenos">1140</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-1141"><a href="#Robot-1141"><span class="linenos">1141</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="Robot-1142"><a href="#Robot-1142"><span class="linenos">1142</span></a>                    <span class="n">total_turn</span> <span class="o">=</span> <span class="n">yaw_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span><span class="c1">#self.queue.get() </span>
</span><span id="Robot-1143"><a href="#Robot-1143"><span class="linenos">1143</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current yaw </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span><span class="si">}</span><span class="s2">, Total turn </span><span class="si">{</span><span class="n">total_turn</span><span class="si">}</span><span class="s2">, Final Angle diff </span><span class="si">{</span><span class="n">yaw_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1144"><a href="#Robot-1144"><span class="linenos">1144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Robot turn done&quot;</span><span class="p">)</span>
</span><span id="Robot-1145"><a href="#Robot-1145"><span class="linenos">1145</span></a>                    
</span><span id="Robot-1146"><a href="#Robot-1146"><span class="linenos">1146</span></a>                    <span class="n">yaw_diff</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-1147"><a href="#Robot-1147"><span class="linenos">1147</span></a>                    
</span><span id="Robot-1148"><a href="#Robot-1148"><span class="linenos">1148</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">just_turn</span><span class="p">:</span>
</span><span id="Robot-1149"><a href="#Robot-1149"><span class="linenos">1149</span></a>                        <span class="k">if</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1150"><a href="#Robot-1150"><span class="linenos">1150</span></a>                        <span class="c1">#if (abs(yaw_diff) &gt;= 0.):</span>
</span><span id="Robot-1151"><a href="#Robot-1151"><span class="linenos">1151</span></a>                        <span class="c1"># Check for overshooting</span>
</span><span id="Robot-1152"><a href="#Robot-1152"><span class="linenos">1152</span></a>                        
</span><span id="Robot-1153"><a href="#Robot-1153"><span class="linenos">1153</span></a>                            <span class="n">deg_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="Robot-1154"><a href="#Robot-1154"><span class="linenos">1154</span></a>                            
</span><span id="Robot-1155"><a href="#Robot-1155"><span class="linenos">1155</span></a>                            <span class="k">if</span> <span class="n">deg_diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Robot-1156"><a href="#Robot-1156"><span class="linenos">1156</span></a>                            
</span><span id="Robot-1157"><a href="#Robot-1157"><span class="linenos">1157</span></a>                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="Robot-1158"><a href="#Robot-1158"><span class="linenos">1158</span></a>                                    
</span><span id="Robot-1159"><a href="#Robot-1159"><span class="linenos">1159</span></a>        <span class="c1">#                             time.sleep(1)</span>
</span><span id="Robot-1160"><a href="#Robot-1160"><span class="linenos">1160</span></a>                                    <span class="c1"># Return pwm dutcycle back to base</span>
</span><span id="Robot-1161"><a href="#Robot-1161"><span class="linenos">1161</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="Robot-1162"><a href="#Robot-1162"><span class="linenos">1162</span></a>                                    
</span><span id="Robot-1163"><a href="#Robot-1163"><span class="linenos">1163</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1164"><a href="#Robot-1164"><span class="linenos">1164</span></a>                                    
</span><span id="Robot-1165"><a href="#Robot-1165"><span class="linenos">1165</span></a><span class="c1">#                         if abs(yaw_diff) &gt;= 0.6:</span>
</span><span id="Robot-1166"><a href="#Robot-1166"><span class="linenos">1166</span></a><span class="c1">#                             self._dutycycle[self._direction] = 70</span>
</span><span id="Robot-1167"><a href="#Robot-1167"><span class="linenos">1167</span></a><span class="c1">#                                 </span>
</span><span id="Robot-1168"><a href="#Robot-1168"><span class="linenos">1168</span></a><span class="c1">#                             self._pivot(yaw_diff,steady=True)</span>
</span><span id="Robot-1169"><a href="#Robot-1169"><span class="linenos">1169</span></a>
</span><span id="Robot-1170"><a href="#Robot-1170"><span class="linenos">1170</span></a>                    
</span><span id="Robot-1171"><a href="#Robot-1171"><span class="linenos">1171</span></a><span class="c1">#                     elif abs(yaw_diff) &gt; 0.6:</span>
</span><span id="Robot-1172"><a href="#Robot-1172"><span class="linenos">1172</span></a><span class="c1">#                         </span>
</span><span id="Robot-1173"><a href="#Robot-1173"><span class="linenos">1173</span></a><span class="c1">#                         # Return pwm dutcycle back to base</span>
</span><span id="Robot-1174"><a href="#Robot-1174"><span class="linenos">1174</span></a><span class="c1">#                         self._dutycycle[self._direction] = 70</span>
</span><span id="Robot-1175"><a href="#Robot-1175"><span class="linenos">1175</span></a><span class="c1">#                         </span>
</span><span id="Robot-1176"><a href="#Robot-1176"><span class="linenos">1176</span></a><span class="c1">#                         self._pivot(yaw_diff)            </span>
</span><span id="Robot-1177"><a href="#Robot-1177"><span class="linenos">1177</span></a>
</span><span id="Robot-1178"><a href="#Robot-1178"><span class="linenos">1178</span></a>                    <span class="c1"># Return pwm dutcycle back to base</span>
</span><span id="Robot-1179"><a href="#Robot-1179"><span class="linenos">1179</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1180"><a href="#Robot-1180"><span class="linenos">1180</span></a>                    
</span><span id="Robot-1181"><a href="#Robot-1181"><span class="linenos">1181</span></a>                    <span class="c1"># Save robots pose by saving its x, yaw position            </span>
</span><span id="Robot-1182"><a href="#Robot-1182"><span class="linenos">1182</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">(),</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-1183"><a href="#Robot-1183"><span class="linenos">1183</span></a>
</span><span id="Robot-1184"><a href="#Robot-1184"><span class="linenos">1184</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Final orientation reached&quot;</span><span class="p">)</span>
</span><span id="Robot-1185"><a href="#Robot-1185"><span class="linenos">1185</span></a>                    <span class="k">break</span>
</span><span id="Robot-1186"><a href="#Robot-1186"><span class="linenos">1186</span></a>            
</span><span id="Robot-1187"><a href="#Robot-1187"><span class="linenos">1187</span></a>                <span class="n">yaw_diff_old</span> <span class="o">=</span> <span class="n">yaw_diff</span>
</span><span id="Robot-1188"><a href="#Robot-1188"><span class="linenos">1188</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1189"><a href="#Robot-1189"><span class="linenos">1189</span></a>                <span class="n">yaw_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1190"><a href="#Robot-1190"><span class="linenos">1190</span></a>                <span class="n">yaw_diff_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yaw_diff</span><span class="p">)</span>
</span><span id="Robot-1191"><a href="#Robot-1191"><span class="linenos">1191</span></a>                
</span><span id="Robot-1192"><a href="#Robot-1192"><span class="linenos">1192</span></a><span class="c1">#                 if ((np.sign(yaw_diff) != np.sign(yaw_diff_old)) and (abs(yaw_diff-yaw_diff_old) &lt; 3)):</span>
</span><span id="Robot-1193"><a href="#Robot-1193"><span class="linenos">1193</span></a><span class="c1">#                     yaw_diff_list.pop()</span>
</span><span id="Robot-1194"><a href="#Robot-1194"><span class="linenos">1194</span></a><span class="c1">#                     yaw_diff = yaw_diff_old</span>
</span><span id="Robot-1195"><a href="#Robot-1195"><span class="linenos">1195</span></a>                <span class="c1"># Filtering data via median thresholding</span>
</span><span id="Robot-1196"><a href="#Robot-1196"><span class="linenos">1196</span></a><span class="c1">#                 if len(yaw_diff_list) &gt; 6:</span>
</span><span id="Robot-1197"><a href="#Robot-1197"><span class="linenos">1197</span></a><span class="c1">#                     median = np.median(yaw_diff_list[-5:-1])    </span>
</span><span id="Robot-1198"><a href="#Robot-1198"><span class="linenos">1198</span></a><span class="c1">#                 else:</span>
</span><span id="Robot-1199"><a href="#Robot-1199"><span class="linenos">1199</span></a><span class="c1">#                     median = np.median(yaw_diff_list[-3:-1])</span>
</span><span id="Robot-1200"><a href="#Robot-1200"><span class="linenos">1200</span></a>                
</span><span id="Robot-1201"><a href="#Robot-1201"><span class="linenos">1201</span></a><span class="c1">#                 if (abs(yaw_diff - median) &lt; 5):</span>
</span><span id="Robot-1202"><a href="#Robot-1202"><span class="linenos">1202</span></a><span class="c1">#                     yaw_diff_list.append(yaw_diff)</span>
</span><span id="Robot-1203"><a href="#Robot-1203"><span class="linenos">1203</span></a><span class="c1">#                 else:</span>
</span><span id="Robot-1204"><a href="#Robot-1204"><span class="linenos">1204</span></a><span class="c1">#                     yaw_diff_list.pop()</span>
</span><span id="Robot-1205"><a href="#Robot-1205"><span class="linenos">1205</span></a><span class="c1">#                     yaw_diff = yaw_diff_old</span>
</span><span id="Robot-1206"><a href="#Robot-1206"><span class="linenos">1206</span></a><span class="c1">#                     yaw_diff_list.append(yaw_diff_old)</span>
</span><span id="Robot-1207"><a href="#Robot-1207"><span class="linenos">1207</span></a>                
</span><span id="Robot-1208"><a href="#Robot-1208"><span class="linenos">1208</span></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="Robot-1209"><a href="#Robot-1209"><span class="linenos">1209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pivot Interrupted&quot;</span><span class="p">)</span>
</span><span id="Robot-1210"><a href="#Robot-1210"><span class="linenos">1210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="Robot-1211"><a href="#Robot-1211"><span class="linenos">1211</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot-1212"><a href="#Robot-1212"><span class="linenos">1212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1213"><a href="#Robot-1213"><span class="linenos">1213</span></a>
</span><span id="Robot-1214"><a href="#Robot-1214"><span class="linenos">1214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="Robot-1215"><a href="#Robot-1215"><span class="linenos">1215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1216"><a href="#Robot-1216"><span class="linenos">1216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pivot Finished&quot;</span><span class="p">)</span>
</span><span id="Robot-1217"><a href="#Robot-1217"><span class="linenos">1217</span></a>      
</span><span id="Robot-1218"><a href="#Robot-1218"><span class="linenos">1218</span></a>    <span class="k">def</span> <span class="nf">_go2block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">eucl_disp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">just_drive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">steady</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Robot-1219"><a href="#Robot-1219"><span class="linenos">1219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1220"><a href="#Robot-1220"><span class="linenos">1220</span></a><span class="sd">        This function drives the robot in a straight path, either forward</span>
</span><span id="Robot-1221"><a href="#Robot-1221"><span class="linenos">1221</span></a><span class="sd">        or reverse</span>
</span><span id="Robot-1222"><a href="#Robot-1222"><span class="linenos">1222</span></a>
</span><span id="Robot-1223"><a href="#Robot-1223"><span class="linenos">1223</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1224"><a href="#Robot-1224"><span class="linenos">1224</span></a><span class="sd">            direction: Direction of drive, forward or reverse</span>
</span><span id="Robot-1225"><a href="#Robot-1225"><span class="linenos">1225</span></a><span class="sd">            </span>
</span><span id="Robot-1226"><a href="#Robot-1226"><span class="linenos">1226</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1227"><a href="#Robot-1227"><span class="linenos">1227</span></a><span class="sd">            None</span>
</span><span id="Robot-1228"><a href="#Robot-1228"><span class="linenos">1228</span></a><span class="sd">            </span>
</span><span id="Robot-1229"><a href="#Robot-1229"><span class="linenos">1229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1230"><a href="#Robot-1230"><span class="linenos">1230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;driving&#39;</span>
</span><span id="Robot-1231"><a href="#Robot-1231"><span class="linenos">1231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1232"><a href="#Robot-1232"><span class="linenos">1232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Going toward block (go2block)&quot;</span><span class="p">)</span>
</span><span id="Robot-1233"><a href="#Robot-1233"><span class="linenos">1233</span></a>        
</span><span id="Robot-1234"><a href="#Robot-1234"><span class="linenos">1234</span></a>        <span class="c1"># Divide the separation distance into three zones</span>
</span><span id="Robot-1235"><a href="#Robot-1235"><span class="linenos">1235</span></a>        <span class="c1"># First zone is 70% into drive</span>
</span><span id="Robot-1236"><a href="#Robot-1236"><span class="linenos">1236</span></a>        <span class="c1"># Second zone is 20%</span>
</span><span id="Robot-1237"><a href="#Robot-1237"><span class="linenos">1237</span></a>        <span class="c1"># Third zone is the last 10%</span>
</span><span id="Robot-1238"><a href="#Robot-1238"><span class="linenos">1238</span></a>        <span class="c1"># Each of the zones have their own dutycycle. Robot will</span>
</span><span id="Robot-1239"><a href="#Robot-1239"><span class="linenos">1239</span></a>        <span class="c1"># drive and stop at each zone, scan, align, and resume drive</span>
</span><span id="Robot-1240"><a href="#Robot-1240"><span class="linenos">1240</span></a>        <span class="n">zones</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="Robot-1241"><a href="#Robot-1241"><span class="linenos">1241</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="Robot-1242"><a href="#Robot-1242"><span class="linenos">1242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1243"><a href="#Robot-1243"><span class="linenos">1243</span></a>        <span class="c1"># Check if straight drive mode is requested andd steady drive mode</span>
</span><span id="Robot-1244"><a href="#Robot-1244"><span class="linenos">1244</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">just_drive</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1245"><a href="#Robot-1245"><span class="linenos">1245</span></a>            <span class="c1"># Use image from camera to estimate distance</span>
</span><span id="Robot-1246"><a href="#Robot-1246"><span class="linenos">1246</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dist_estimate</span><span class="p">()</span>
</span><span id="Robot-1247"><a href="#Robot-1247"><span class="linenos">1247</span></a>            <span class="c1"># convert depth to encoder count</span>
</span><span id="Robot-1248"><a href="#Robot-1248"><span class="linenos">1248</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2encoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="o">-</span><span class="mi">35</span><span class="p">)</span>
</span><span id="Robot-1249"><a href="#Robot-1249"><span class="linenos">1249</span></a>            
</span><span id="Robot-1250"><a href="#Robot-1250"><span class="linenos">1250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance estimated </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1251"><a href="#Robot-1251"><span class="linenos">1251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance to drive </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">35</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1252"><a href="#Robot-1252"><span class="linenos">1252</span></a>        <span class="k">elif</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1253"><a href="#Robot-1253"><span class="linenos">1253</span></a>            <span class="c1"># Use image from camera to estimate distance</span>
</span><span id="Robot-1254"><a href="#Robot-1254"><span class="linenos">1254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dist_estimate</span><span class="p">()</span>
</span><span id="Robot-1255"><a href="#Robot-1255"><span class="linenos">1255</span></a>            <span class="c1"># convert depth to encoder count</span>
</span><span id="Robot-1256"><a href="#Robot-1256"><span class="linenos">1256</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2encoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Robot-1257"><a href="#Robot-1257"><span class="linenos">1257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance estimated </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1258"><a href="#Robot-1258"><span class="linenos">1258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Driving slowly </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_travel</span><span class="o">-</span><span class="mi">5</span><span class="si">}</span><span class="s2"> cms&quot;</span><span class="p">)</span>
</span><span id="Robot-1259"><a href="#Robot-1259"><span class="linenos">1259</span></a>        <span class="k">elif</span> <span class="n">just_drive</span><span class="p">:</span>
</span><span id="Robot-1260"><a href="#Robot-1260"><span class="linenos">1260</span></a>            <span class="c1"># Drive straight command</span>
</span><span id="Robot-1261"><a href="#Robot-1261"><span class="linenos">1261</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feet2encoder</span><span class="p">(</span><span class="n">eucl_disp</span><span class="p">)</span>
</span><span id="Robot-1262"><a href="#Robot-1262"><span class="linenos">1262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Just Driving Distance estimated </span><span class="si">{</span><span class="n">orig_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1263"><a href="#Robot-1263"><span class="linenos">1263</span></a>        <span class="k">elif</span> <span class="n">just_drive</span> <span class="ow">and</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1264"><a href="#Robot-1264"><span class="linenos">1264</span></a>            <span class="c1"># Drive straight command</span>
</span><span id="Robot-1265"><a href="#Robot-1265"><span class="linenos">1265</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2encoder</span><span class="p">(</span><span class="n">eucl_disp</span><span class="p">)</span>
</span><span id="Robot-1266"><a href="#Robot-1266"><span class="linenos">1266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Just Driving Distance estimated </span><span class="si">{</span><span class="n">orig_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1267"><a href="#Robot-1267"><span class="linenos">1267</span></a>            
</span><span id="Robot-1268"><a href="#Robot-1268"><span class="linenos">1268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance to drive </span><span class="si">{</span><span class="n">orig_dist</span><span class="si">}</span><span class="s2"> encoder&quot;</span><span class="p">)</span>
</span><span id="Robot-1269"><a href="#Robot-1269"><span class="linenos">1269</span></a>        <span class="n">pos_encoder_orig</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1270"><a href="#Robot-1270"><span class="linenos">1270</span></a>        <span class="n">pos_encoder</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1271"><a href="#Robot-1271"><span class="linenos">1271</span></a>        <span class="n">orig_error</span> <span class="o">=</span> <span class="n">orig_dist</span>
</span><span id="Robot-1272"><a href="#Robot-1272"><span class="linenos">1272</span></a>        
</span><span id="Robot-1273"><a href="#Robot-1273"><span class="linenos">1273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1274"><a href="#Robot-1274"><span class="linenos">1274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1275"><a href="#Robot-1275"><span class="linenos">1275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1276"><a href="#Robot-1276"><span class="linenos">1276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1277"><a href="#Robot-1277"><span class="linenos">1277</span></a>        
</span><span id="Robot-1278"><a href="#Robot-1278"><span class="linenos">1278</span></a>        <span class="c1"># Defining the limit of dutycycle</span>
</span><span id="Robot-1279"><a href="#Robot-1279"><span class="linenos">1279</span></a>        <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="Robot-1280"><a href="#Robot-1280"><span class="linenos">1280</span></a>        <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Robot-1281"><a href="#Robot-1281"><span class="linenos">1281</span></a>        
</span><span id="Robot-1282"><a href="#Robot-1282"><span class="linenos">1282</span></a>        <span class="n">z1</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="Robot-1283"><a href="#Robot-1283"><span class="linenos">1283</span></a>        <span class="n">z2</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">-</span> <span class="mi">20</span>
</span><span id="Robot-1284"><a href="#Robot-1284"><span class="linenos">1284</span></a>        <span class="n">z3</span> <span class="o">=</span> <span class="n">z2</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="Robot-1285"><a href="#Robot-1285"><span class="linenos">1285</span></a>        
</span><span id="Robot-1286"><a href="#Robot-1286"><span class="linenos">1286</span></a>        <span class="c1"># Divide up the path in different zones</span>
</span><span id="Robot-1287"><a href="#Robot-1287"><span class="linenos">1287</span></a>        <span class="n">trip</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">orig_dist</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">]</span>
</span><span id="Robot-1288"><a href="#Robot-1288"><span class="linenos">1288</span></a>        
</span><span id="Robot-1289"><a href="#Robot-1289"><span class="linenos">1289</span></a>        <span class="c1"># Determine if function completed successfully</span>
</span><span id="Robot-1290"><a href="#Robot-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1291"><a href="#Robot-1291"><span class="linenos">1291</span></a>
</span><span id="Robot-1292"><a href="#Robot-1292"><span class="linenos">1292</span></a>        <span class="c1">#time.sleep(1)</span>
</span><span id="Robot-1293"><a href="#Robot-1293"><span class="linenos">1293</span></a>        <span class="n">yaw0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1294"><a href="#Robot-1294"><span class="linenos">1294</span></a>                
</span><span id="Robot-1295"><a href="#Robot-1295"><span class="linenos">1295</span></a>        <span class="c1"># For encoder level control</span>
</span><span id="Robot-1296"><a href="#Robot-1296"><span class="linenos">1296</span></a>        <span class="n">integral_error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1297"><a href="#Robot-1297"><span class="linenos">1297</span></a>        <span class="n">derivative_error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1298"><a href="#Robot-1298"><span class="linenos">1298</span></a>        <span class="n">error_encoder0</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1299"><a href="#Robot-1299"><span class="linenos">1299</span></a>        <span class="n">error_encoder</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1300"><a href="#Robot-1300"><span class="linenos">1300</span></a>        
</span><span id="Robot-1301"><a href="#Robot-1301"><span class="linenos">1301</span></a>        <span class="c1"># For achieving overall distance</span>
</span><span id="Robot-1302"><a href="#Robot-1302"><span class="linenos">1302</span></a>        <span class="n">integral</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1303"><a href="#Robot-1303"><span class="linenos">1303</span></a>        <span class="n">derivative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1304"><a href="#Robot-1304"><span class="linenos">1304</span></a>        <span class="n">error0</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1305"><a href="#Robot-1305"><span class="linenos">1305</span></a>        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1306"><a href="#Robot-1306"><span class="linenos">1306</span></a>        <span class="n">startD</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1307"><a href="#Robot-1307"><span class="linenos">1307</span></a>        
</span><span id="Robot-1308"><a href="#Robot-1308"><span class="linenos">1308</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1309"><a href="#Robot-1309"><span class="linenos">1309</span></a>        <span class="c1"># Assign direciton of drive from argument</span>
</span><span id="Robot-1310"><a href="#Robot-1310"><span class="linenos">1310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="n">direction</span>
</span><span id="Robot-1311"><a href="#Robot-1311"><span class="linenos">1311</span></a>        <span class="c1"># Compute the difference in distance between start state  and goal state        </span>
</span><span id="Robot-1312"><a href="#Robot-1312"><span class="linenos">1312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Sending command toward thrusters&quot;</span><span class="p">)</span>
</span><span id="Robot-1313"><a href="#Robot-1313"><span class="linenos">1313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking encoder to cm </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">orig_dist</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1314"><a href="#Robot-1314"><span class="linenos">1314</span></a>        
</span><span id="Robot-1315"><a href="#Robot-1315"><span class="linenos">1315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1316"><a href="#Robot-1316"><span class="linenos">1316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">orig_dist</span><span class="p">))</span>
</span><span id="Robot-1317"><a href="#Robot-1317"><span class="linenos">1317</span></a>        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-1318"><a href="#Robot-1318"><span class="linenos">1318</span></a>        
</span><span id="Robot-1319"><a href="#Robot-1319"><span class="linenos">1319</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Robot-1320"><a href="#Robot-1320"><span class="linenos">1320</span></a>        
</span><span id="Robot-1321"><a href="#Robot-1321"><span class="linenos">1321</span></a>        <span class="c1">#To avoid division by zero</span>
</span><span id="Robot-1322"><a href="#Robot-1322"><span class="linenos">1322</span></a>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">orig_dist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
</span><span id="Robot-1323"><a href="#Robot-1323"><span class="linenos">1323</span></a>            <span class="n">orig_dist</span> <span class="o">=</span> <span class="mf">0.001</span>
</span><span id="Robot-1324"><a href="#Robot-1324"><span class="linenos">1324</span></a>            
</span><span id="Robot-1325"><a href="#Robot-1325"><span class="linenos">1325</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1326"><a href="#Robot-1326"><span class="linenos">1326</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1327"><a href="#Robot-1327"><span class="linenos">1327</span></a>        
</span><span id="Robot-1328"><a href="#Robot-1328"><span class="linenos">1328</span></a>        <span class="c1"># Save robots pose by saving its x, yaw position</span>
</span><span id="Robot-1329"><a href="#Robot-1329"><span class="linenos">1329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1330"><a href="#Robot-1330"><span class="linenos">1330</span></a>        <span class="c1"># Convert imu notation to general +ccw from positive x</span>
</span><span id="Robot-1331"><a href="#Robot-1331"><span class="linenos">1331</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1332"><a href="#Robot-1332"><span class="linenos">1332</span></a>        
</span><span id="Robot-1333"><a href="#Robot-1333"><span class="linenos">1333</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>                            
</span><span id="Robot-1334"><a href="#Robot-1334"><span class="linenos">1334</span></a>                                
</span><span id="Robot-1335"><a href="#Robot-1335"><span class="linenos">1335</span></a>            <span class="c1"># by considering the minimum of the two encoders</span>
</span><span id="Robot-1336"><a href="#Robot-1336"><span class="linenos">1336</span></a>            <span class="n">pos_encoder</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span><span class="p">))</span>
</span><span id="Robot-1337"><a href="#Robot-1337"><span class="linenos">1337</span></a>            
</span><span id="Robot-1338"><a href="#Robot-1338"><span class="linenos">1338</span></a>            <span class="c1"># Global error between start and goal state will be</span>
</span><span id="Robot-1339"><a href="#Robot-1339"><span class="linenos">1339</span></a>            <span class="n">error</span> <span class="o">=</span> <span class="n">orig_dist</span> <span class="o">-</span> <span class="n">pos_encoder</span>  
</span><span id="Robot-1340"><a href="#Robot-1340"><span class="linenos">1340</span></a>            <span class="n">prcnt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">error</span><span class="o">/</span><span class="n">orig_dist</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Robot-1341"><a href="#Robot-1341"><span class="linenos">1341</span></a>            
</span><span id="Robot-1342"><a href="#Robot-1342"><span class="linenos">1342</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">pos_encoder</span> <span class="o">%</span> <span class="mi">150</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
</span><span id="Robot-1343"><a href="#Robot-1343"><span class="linenos">1343</span></a>                
</span><span id="Robot-1344"><a href="#Robot-1344"><span class="linenos">1344</span></a>                <span class="c1"># Save robots pose by saving its x, yaw position</span>
</span><span id="Robot-1345"><a href="#Robot-1345"><span class="linenos">1345</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1346"><a href="#Robot-1346"><span class="linenos">1346</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1347"><a href="#Robot-1347"><span class="linenos">1347</span></a>                
</span><span id="Robot-1348"><a href="#Robot-1348"><span class="linenos">1348</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-1349"><a href="#Robot-1349"><span class="linenos">1349</span></a>                
</span><span id="Robot-1350"><a href="#Robot-1350"><span class="linenos">1350</span></a><span class="c1">#                 if (self._distance() &lt; 30):</span>
</span><span id="Robot-1351"><a href="#Robot-1351"><span class="linenos">1351</span></a>                <span class="k">if</span> <span class="p">((</span><span class="mi">10</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="mi">10</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">)):</span>
</span><span id="Robot-1352"><a href="#Robot-1352"><span class="linenos">1352</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Too close to border. Stop and Exit straight drive&quot;</span><span class="p">)</span>
</span><span id="Robot-1353"><a href="#Robot-1353"><span class="linenos">1353</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>    
</span><span id="Robot-1354"><a href="#Robot-1354"><span class="linenos">1354</span></a>                    <span class="k">break</span>
</span><span id="Robot-1355"><a href="#Robot-1355"><span class="linenos">1355</span></a>                
</span><span id="Robot-1356"><a href="#Robot-1356"><span class="linenos">1356</span></a>                <span class="c1">#Record encoder states to txt file</span>
</span><span id="Robot-1357"><a href="#Robot-1357"><span class="linenos">1357</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Robot-1358"><a href="#Robot-1358"><span class="linenos">1358</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="Robot-1359"><a href="#Robot-1359"><span class="linenos">1359</span></a>                
</span><span id="Robot-1360"><a href="#Robot-1360"><span class="linenos">1360</span></a>             
</span><span id="Robot-1361"><a href="#Robot-1361"><span class="linenos">1361</span></a>            <span class="k">if</span> <span class="n">prcnt</span> <span class="o">&lt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1362"><a href="#Robot-1362"><span class="linenos">1362</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Robot-1363"><a href="#Robot-1363"><span class="linenos">1363</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="Robot-1364"><a href="#Robot-1364"><span class="linenos">1364</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="Robot-1365"><a href="#Robot-1365"><span class="linenos">1365</span></a>                    
</span><span id="Robot-1366"><a href="#Robot-1366"><span class="linenos">1366</span></a>                    <span class="n">error</span> <span class="o">=</span> <span class="n">orig_dist</span> <span class="o">-</span> <span class="n">pos_encoder</span>
</span><span id="Robot-1367"><a href="#Robot-1367"><span class="linenos">1367</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">=</span> <span class="n">pos_encoder</span>
</span><span id="Robot-1368"><a href="#Robot-1368"><span class="linenos">1368</span></a>                    
</span><span id="Robot-1369"><a href="#Robot-1369"><span class="linenos">1369</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="mi">55</span><span class="p">]</span>
</span><span id="Robot-1370"><a href="#Robot-1370"><span class="linenos">1370</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1371"><a href="#Robot-1371"><span class="linenos">1371</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-1372"><a href="#Robot-1372"><span class="linenos">1372</span></a>                    
</span><span id="Robot-1373"><a href="#Robot-1373"><span class="linenos">1373</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1374"><a href="#Robot-1374"><span class="linenos">1374</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="Robot-1375"><a href="#Robot-1375"><span class="linenos">1375</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1376"><a href="#Robot-1376"><span class="linenos">1376</span></a>
</span><span id="Robot-1377"><a href="#Robot-1377"><span class="linenos">1377</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prcnt</span> <span class="o">&lt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1378"><a href="#Robot-1378"><span class="linenos">1378</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Robot-1379"><a href="#Robot-1379"><span class="linenos">1379</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">35</span>
</span><span id="Robot-1380"><a href="#Robot-1380"><span class="linenos">1380</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="Robot-1381"><a href="#Robot-1381"><span class="linenos">1381</span></a>                    
</span><span id="Robot-1382"><a href="#Robot-1382"><span class="linenos">1382</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">+=</span> <span class="n">pos_encoder</span>
</span><span id="Robot-1383"><a href="#Robot-1383"><span class="linenos">1383</span></a>                    
</span><span id="Robot-1384"><a href="#Robot-1384"><span class="linenos">1384</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">]</span>
</span><span id="Robot-1385"><a href="#Robot-1385"><span class="linenos">1385</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1386"><a href="#Robot-1386"><span class="linenos">1386</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-1387"><a href="#Robot-1387"><span class="linenos">1387</span></a>                    
</span><span id="Robot-1388"><a href="#Robot-1388"><span class="linenos">1388</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1389"><a href="#Robot-1389"><span class="linenos">1389</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="Robot-1390"><a href="#Robot-1390"><span class="linenos">1390</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1391"><a href="#Robot-1391"><span class="linenos">1391</span></a>                
</span><span id="Robot-1392"><a href="#Robot-1392"><span class="linenos">1392</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prcnt</span> <span class="o">&lt;</span> <span class="n">zones</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1393"><a href="#Robot-1393"><span class="linenos">1393</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Robot-1394"><a href="#Robot-1394"><span class="linenos">1394</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">28</span>
</span><span id="Robot-1395"><a href="#Robot-1395"><span class="linenos">1395</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="Robot-1396"><a href="#Robot-1396"><span class="linenos">1396</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="Robot-1397"><a href="#Robot-1397"><span class="linenos">1397</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">+=</span> <span class="n">pos_encoder</span>
</span><span id="Robot-1398"><a href="#Robot-1398"><span class="linenos">1398</span></a>                    
</span><span id="Robot-1399"><a href="#Robot-1399"><span class="linenos">1399</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>
</span><span id="Robot-1400"><a href="#Robot-1400"><span class="linenos">1400</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1401"><a href="#Robot-1401"><span class="linenos">1401</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-1402"><a href="#Robot-1402"><span class="linenos">1402</span></a>                    
</span><span id="Robot-1403"><a href="#Robot-1403"><span class="linenos">1403</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1404"><a href="#Robot-1404"><span class="linenos">1404</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="Robot-1405"><a href="#Robot-1405"><span class="linenos">1405</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1406"><a href="#Robot-1406"><span class="linenos">1406</span></a>            <span class="k">elif</span> <span class="n">prcnt</span> <span class="o">&gt;=</span> <span class="n">zones</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="Robot-1407"><a href="#Robot-1407"><span class="linenos">1407</span></a>                <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Robot-1408"><a href="#Robot-1408"><span class="linenos">1408</span></a>                    <span class="n">lower_dc</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="Robot-1409"><a href="#Robot-1409"><span class="linenos">1409</span></a>                    <span class="n">upper_dc</span> <span class="o">=</span> <span class="mi">28</span>
</span><span id="Robot-1410"><a href="#Robot-1410"><span class="linenos">1410</span></a>                    
</span><span id="Robot-1411"><a href="#Robot-1411"><span class="linenos">1411</span></a>                    <span class="n">pos_encoder_orig</span> <span class="o">+=</span> <span class="n">pos_encoder</span>
</span><span id="Robot-1412"><a href="#Robot-1412"><span class="linenos">1412</span></a>                    
</span><span id="Robot-1413"><a href="#Robot-1413"><span class="linenos">1413</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">22</span><span class="p">]</span> 
</span><span id="Robot-1414"><a href="#Robot-1414"><span class="linenos">1414</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1415"><a href="#Robot-1415"><span class="linenos">1415</span></a>                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-1416"><a href="#Robot-1416"><span class="linenos">1416</span></a>                    
</span><span id="Robot-1417"><a href="#Robot-1417"><span class="linenos">1417</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1418"><a href="#Robot-1418"><span class="linenos">1418</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="Robot-1419"><a href="#Robot-1419"><span class="linenos">1419</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1420"><a href="#Robot-1420"><span class="linenos">1420</span></a>            
</span><span id="Robot-1421"><a href="#Robot-1421"><span class="linenos">1421</span></a>            
</span><span id="Robot-1422"><a href="#Robot-1422"><span class="linenos">1422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">lower_dc</span><span class="p">,</span> <span class="n">upper_dc</span><span class="p">),</span>
</span><span id="Robot-1423"><a href="#Robot-1423"><span class="linenos">1423</span></a>                                                <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">lower_dc</span><span class="p">,</span> <span class="n">upper_dc</span><span class="p">)]</span>
</span><span id="Robot-1424"><a href="#Robot-1424"><span class="linenos">1424</span></a>            
</span><span id="Robot-1425"><a href="#Robot-1425"><span class="linenos">1425</span></a>            <span class="k">if</span> <span class="n">steady</span><span class="p">:</span>
</span><span id="Robot-1426"><a href="#Robot-1426"><span class="linenos">1426</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>               
</span><span id="Robot-1427"><a href="#Robot-1427"><span class="linenos">1427</span></a>
</span><span id="Robot-1428"><a href="#Robot-1428"><span class="linenos">1428</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
</span><span id="Robot-1429"><a href="#Robot-1429"><span class="linenos">1429</span></a>                <span class="c1"># Drive robot towards direction</span>
</span><span id="Robot-1430"><a href="#Robot-1430"><span class="linenos">1430</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]))</span>
</span><span id="Robot-1431"><a href="#Robot-1431"><span class="linenos">1431</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">==</span> <span class="s1">&#39;rev&#39;</span><span class="p">:</span>
</span><span id="Robot-1432"><a href="#Robot-1432"><span class="linenos">1432</span></a>                <span class="c1"># Drive robot towards direction</span>
</span><span id="Robot-1433"><a href="#Robot-1433"><span class="linenos">1433</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_reverse</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]))</span>
</span><span id="Robot-1434"><a href="#Robot-1434"><span class="linenos">1434</span></a>                
</span><span id="Robot-1435"><a href="#Robot-1435"><span class="linenos">1435</span></a>            <span class="c1"># Count encoders for left and right motors</span>
</span><span id="Robot-1436"><a href="#Robot-1436"><span class="linenos">1436</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span><span class="p">):</span>
</span><span id="Robot-1437"><a href="#Robot-1437"><span class="linenos">1437</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
</span><span id="Robot-1438"><a href="#Robot-1438"><span class="linenos">1438</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-1439"><a href="#Robot-1439"><span class="linenos">1439</span></a>
</span><span id="Robot-1440"><a href="#Robot-1440"><span class="linenos">1440</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span><span class="p">):</span>
</span><span id="Robot-1441"><a href="#Robot-1441"><span class="linenos">1441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
</span><span id="Robot-1442"><a href="#Robot-1442"><span class="linenos">1442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-1443"><a href="#Robot-1443"><span class="linenos">1443</span></a>                
</span><span id="Robot-1444"><a href="#Robot-1444"><span class="linenos">1444</span></a>            <span class="c1"># PD Controller for encoder balance</span>
</span><span id="Robot-1445"><a href="#Robot-1445"><span class="linenos">1445</span></a>            <span class="n">error_encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span>
</span><span id="Robot-1446"><a href="#Robot-1446"><span class="linenos">1446</span></a>                
</span><span id="Robot-1447"><a href="#Robot-1447"><span class="linenos">1447</span></a>            <span class="k">if</span> <span class="n">error_encoder</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="Robot-1448"><a href="#Robot-1448"><span class="linenos">1448</span></a>                <span class="c1"># Give power to corresponding motors</span>
</span><span id="Robot-1449"><a href="#Robot-1449"><span class="linenos">1449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span>  <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-1450"><a href="#Robot-1450"><span class="linenos">1450</span></a><span class="c1">#                 self._dutycycle[self._direction][1] += 0.1 * self.duty[self._direction][1]</span>
</span><span id="Robot-1451"><a href="#Robot-1451"><span class="linenos">1451</span></a>            <span class="k">elif</span> <span class="n">error_encoder</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">25</span><span class="p">:</span>
</span><span id="Robot-1452"><a href="#Robot-1452"><span class="linenos">1452</span></a>                <span class="c1"># Give power to corresponding motors</span>
</span><span id="Robot-1453"><a href="#Robot-1453"><span class="linenos">1453</span></a><span class="c1">#                 self._dutycycle[self._direction][0] += 0.1 * self.duty[self._direction][0]</span>
</span><span id="Robot-1454"><a href="#Robot-1454"><span class="linenos">1454</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span>  <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-1455"><a href="#Robot-1455"><span class="linenos">1455</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-1456"><a href="#Robot-1456"><span class="linenos">1456</span></a>                <span class="c1"># Give power to corresponding motors</span>
</span><span id="Robot-1457"><a href="#Robot-1457"><span class="linenos">1457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-1458"><a href="#Robot-1458"><span class="linenos">1458</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-1459"><a href="#Robot-1459"><span class="linenos">1459</span></a>            
</span><span id="Robot-1460"><a href="#Robot-1460"><span class="linenos">1460</span></a>            
</span><span id="Robot-1461"><a href="#Robot-1461"><span class="linenos">1461</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;rev&#39;</span><span class="p">]):</span>
</span><span id="Robot-1462"><a href="#Robot-1462"><span class="linenos">1462</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1463"><a href="#Robot-1463"><span class="linenos">1463</span></a>                <span class="n">angle_diff</span> <span class="o">=</span> <span class="n">yaw0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1464"><a href="#Robot-1464"><span class="linenos">1464</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;counterBR: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span><span class="si">}</span><span class="s2"> counterFL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1465"><a href="#Robot-1465"><span class="linenos">1465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angle shifted: </span><span class="si">{</span><span class="n">angle_diff</span><span class="si">}</span><span class="s2"> deg &quot;</span><span class="p">)</span>
</span><span id="Robot-1466"><a href="#Robot-1466"><span class="linenos">1466</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated distance traveled: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span><span class="si">}</span><span class="s2"> cms&quot;</span><span class="p">)</span>
</span><span id="Robot-1467"><a href="#Robot-1467"><span class="linenos">1467</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterFL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1468"><a href="#Robot-1468"><span class="linenos">1468</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">counterBR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1469"><a href="#Robot-1469"><span class="linenos">1469</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1470"><a href="#Robot-1470"><span class="linenos">1470</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">buttonFL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-1471"><a href="#Robot-1471"><span class="linenos">1471</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Arrived in front of block&quot;</span><span class="p">)</span>
</span><span id="Robot-1472"><a href="#Robot-1472"><span class="linenos">1472</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pwmZero</span><span class="p">()</span>
</span><span id="Robot-1473"><a href="#Robot-1473"><span class="linenos">1473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1474"><a href="#Robot-1474"><span class="linenos">1474</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1475"><a href="#Robot-1475"><span class="linenos">1475</span></a>                
</span><span id="Robot-1476"><a href="#Robot-1476"><span class="linenos">1476</span></a>                <span class="c1"># Convert imu notation to general +ccw from positive x</span>
</span><span id="Robot-1477"><a href="#Robot-1477"><span class="linenos">1477</span></a>                <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1478"><a href="#Robot-1478"><span class="linenos">1478</span></a>                
</span><span id="Robot-1479"><a href="#Robot-1479"><span class="linenos">1479</span></a>                <span class="c1"># Save robots pose by saving its x, yaw position</span>
</span><span id="Robot-1480"><a href="#Robot-1480"><span class="linenos">1480</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1481"><a href="#Robot-1481"><span class="linenos">1481</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2feet</span><span class="p">(</span><span class="n">pos_encoder</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1482"><a href="#Robot-1482"><span class="linenos">1482</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">+=</span> <span class="n">x</span>
</span><span id="Robot-1483"><a href="#Robot-1483"><span class="linenos">1483</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">+=</span> <span class="n">y</span>
</span><span id="Robot-1484"><a href="#Robot-1484"><span class="linenos">1484</span></a>                <span class="c1">#self.global_yaw += self._yaw</span>
</span><span id="Robot-1485"><a href="#Robot-1485"><span class="linenos">1485</span></a>                
</span><span id="Robot-1486"><a href="#Robot-1486"><span class="linenos">1486</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-1487"><a href="#Robot-1487"><span class="linenos">1487</span></a>                
</span><span id="Robot-1488"><a href="#Robot-1488"><span class="linenos">1488</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x value </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> and y value </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1489"><a href="#Robot-1489"><span class="linenos">1489</span></a>                                
</span><span id="Robot-1490"><a href="#Robot-1490"><span class="linenos">1490</span></a>                <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-1491"><a href="#Robot-1491"><span class="linenos">1491</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1492"><a href="#Robot-1492"><span class="linenos">1492</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">dist_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoder2cm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</span><span id="Robot-1493"><a href="#Robot-1493"><span class="linenos">1493</span></a>                <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-1494"><a href="#Robot-1494"><span class="linenos">1494</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1495"><a href="#Robot-1495"><span class="linenos">1495</span></a>                                                
</span><span id="Robot-1496"><a href="#Robot-1496"><span class="linenos">1496</span></a>                <span class="c1">#Record encoder states to txt file</span>
</span><span id="Robot-1497"><a href="#Robot-1497"><span class="linenos">1497</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Robot-1498"><a href="#Robot-1498"><span class="linenos">1498</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="Robot-1499"><a href="#Robot-1499"><span class="linenos">1499</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="s1">&#39;End of Driving </span><span class="si">{self._direction}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Robot-1500"><a href="#Robot-1500"><span class="linenos">1500</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="Robot-1501"><a href="#Robot-1501"><span class="linenos">1501</span></a>                <span class="n">outstring</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Robot-1502"><a href="#Robot-1502"><span class="linenos">1502</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outstring</span><span class="p">)</span>
</span><span id="Robot-1503"><a href="#Robot-1503"><span class="linenos">1503</span></a>                <span class="k">break</span>
</span><span id="Robot-1504"><a href="#Robot-1504"><span class="linenos">1504</span></a>        
</span><span id="Robot-1505"><a href="#Robot-1505"><span class="linenos">1505</span></a>        <span class="c1"># Return pwm dutcycle back to base</span>
</span><span id="Robot-1506"><a href="#Robot-1506"><span class="linenos">1506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">]</span>
</span><span id="Robot-1507"><a href="#Robot-1507"><span class="linenos">1507</span></a>
</span><span id="Robot-1508"><a href="#Robot-1508"><span class="linenos">1508</span></a>    <span class="k">def</span> <span class="nf">_scan4object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1509"><a href="#Robot-1509"><span class="linenos">1509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1510"><a href="#Robot-1510"><span class="linenos">1510</span></a><span class="sd">        This function scans for block in environment by turning in place</span>
</span><span id="Robot-1511"><a href="#Robot-1511"><span class="linenos">1511</span></a><span class="sd">        until it finds the block. If it doesn&#39;t find the block after full 360</span>
</span><span id="Robot-1512"><a href="#Robot-1512"><span class="linenos">1512</span></a><span class="sd">        degree turn, it returns false to say not found</span>
</span><span id="Robot-1513"><a href="#Robot-1513"><span class="linenos">1513</span></a><span class="sd">        </span>
</span><span id="Robot-1514"><a href="#Robot-1514"><span class="linenos">1514</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1515"><a href="#Robot-1515"><span class="linenos">1515</span></a><span class="sd">            None</span>
</span><span id="Robot-1516"><a href="#Robot-1516"><span class="linenos">1516</span></a><span class="sd">            </span>
</span><span id="Robot-1517"><a href="#Robot-1517"><span class="linenos">1517</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1518"><a href="#Robot-1518"><span class="linenos">1518</span></a><span class="sd">            None</span>
</span><span id="Robot-1519"><a href="#Robot-1519"><span class="linenos">1519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1520"><a href="#Robot-1520"><span class="linenos">1520</span></a>        
</span><span id="Robot-1521"><a href="#Robot-1521"><span class="linenos">1521</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;scanning&#39;</span>
</span><span id="Robot-1522"><a href="#Robot-1522"><span class="linenos">1522</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1523"><a href="#Robot-1523"><span class="linenos">1523</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scanning for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block started&quot;</span><span class="p">)</span>
</span><span id="Robot-1524"><a href="#Robot-1524"><span class="linenos">1524</span></a>
</span><span id="Robot-1525"><a href="#Robot-1525"><span class="linenos">1525</span></a>        <span class="n">scan_turn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-1526"><a href="#Robot-1526"><span class="linenos">1526</span></a>
</span><span id="Robot-1527"><a href="#Robot-1527"><span class="linenos">1527</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot-1528"><a href="#Robot-1528"><span class="linenos">1528</span></a>            <span class="c1"># Detect object in frame</span>
</span><span id="Robot-1529"><a href="#Robot-1529"><span class="linenos">1529</span></a>
</span><span id="Robot-1530"><a href="#Robot-1530"><span class="linenos">1530</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1531"><a href="#Robot-1531"><span class="linenos">1531</span></a>            <span class="c1">#self._img_frame, ave_center, bbox_radius, success = self._bbox_detect()</span>
</span><span id="Robot-1532"><a href="#Robot-1532"><span class="linenos">1532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="n">ave_center</span><span class="p">,</span> <span class="n">bbox_radius</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="Robot-1533"><a href="#Robot-1533"><span class="linenos">1533</span></a>            
</span><span id="Robot-1534"><a href="#Robot-1534"><span class="linenos">1534</span></a>            <span class="k">if</span> <span class="n">success</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">False</span><span class="p">]:</span>
</span><span id="Robot-1535"><a href="#Robot-1535"><span class="linenos">1535</span></a>                <span class="c1"># Object found</span>
</span><span id="Robot-1536"><a href="#Robot-1536"><span class="linenos">1536</span></a>                <span class="n">diff</span> <span class="o">=</span> <span class="n">ave_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">frame_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-1537"><a href="#Robot-1537"><span class="linenos">1537</span></a>                <span class="c1"># Convert the pixel difference to degrees</span>
</span><span id="Robot-1538"><a href="#Robot-1538"><span class="linenos">1538</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">pixel2deg</span>
</span><span id="Robot-1539"><a href="#Robot-1539"><span class="linenos">1539</span></a>                
</span><span id="Robot-1540"><a href="#Robot-1540"><span class="linenos">1540</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-1541"><a href="#Robot-1541"><span class="linenos">1541</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="Robot-1542"><a href="#Robot-1542"><span class="linenos">1542</span></a>                
</span><span id="Robot-1543"><a href="#Robot-1543"><span class="linenos">1543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn</span>
</span><span id="Robot-1544"><a href="#Robot-1544"><span class="linenos">1544</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-1545"><a href="#Robot-1545"><span class="linenos">1545</span></a>                
</span><span id="Robot-1546"><a href="#Robot-1546"><span class="linenos">1546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1547"><a href="#Robot-1547"><span class="linenos">1547</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1548"><a href="#Robot-1548"><span class="linenos">1548</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;scanning&#39;</span>
</span><span id="Robot-1549"><a href="#Robot-1549"><span class="linenos">1549</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1550"><a href="#Robot-1550"><span class="linenos">1550</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span>
</span><span id="Robot-1551"><a href="#Robot-1551"><span class="linenos">1551</span></a>                
</span><span id="Robot-1552"><a href="#Robot-1552"><span class="linenos">1552</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-1553"><a href="#Robot-1553"><span class="linenos">1553</span></a>                <span class="c1"># Pivot the robot to a predefined turn angle</span>
</span><span id="Robot-1554"><a href="#Robot-1554"><span class="linenos">1554</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turn</span><span class="p">)</span>
</span><span id="Robot-1555"><a href="#Robot-1555"><span class="linenos">1555</span></a>                <span class="c1"># Read the distance from obstacle for reference</span>
</span><span id="Robot-1556"><a href="#Robot-1556"><span class="linenos">1556</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">()</span>
</span><span id="Robot-1557"><a href="#Robot-1557"><span class="linenos">1557</span></a>                <span class="c1"># Keep track of turn</span>
</span><span id="Robot-1558"><a href="#Robot-1558"><span class="linenos">1558</span></a>                <span class="c1">#self._yaw += self.turn</span>
</span><span id="Robot-1559"><a href="#Robot-1559"><span class="linenos">1559</span></a>                <span class="n">scan_turn</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn</span>
</span><span id="Robot-1560"><a href="#Robot-1560"><span class="linenos">1560</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">+=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_turn</span>
</span><span id="Robot-1561"><a href="#Robot-1561"><span class="linenos">1561</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="Robot-1562"><a href="#Robot-1562"><span class="linenos">1562</span></a>            
</span><span id="Robot-1563"><a href="#Robot-1563"><span class="linenos">1563</span></a><span class="c1">#             if scan_turn &gt;= 90:</span>
</span><span id="Robot-1564"><a href="#Robot-1564"><span class="linenos">1564</span></a><span class="c1">#                 # Scan the other side</span>
</span><span id="Robot-1565"><a href="#Robot-1565"><span class="linenos">1565</span></a><span class="c1">#                 self._pivot(-self.turn)</span>
</span><span id="Robot-1566"><a href="#Robot-1566"><span class="linenos">1566</span></a><span class="c1">#                 # Add scan angle</span>
</span><span id="Robot-1567"><a href="#Robot-1567"><span class="linenos">1567</span></a><span class="c1">#                 scan_turn += -self.turn</span>
</span><span id="Robot-1568"><a href="#Robot-1568"><span class="linenos">1568</span></a><span class="c1">#                 self._yaw += self._turn</span>
</span><span id="Robot-1569"><a href="#Robot-1569"><span class="linenos">1569</span></a><span class="c1">#                 self._path.append((round(self.global_x,2),round(self.global_y,2),round(self._yaw,2)))</span>
</span><span id="Robot-1570"><a href="#Robot-1570"><span class="linenos">1570</span></a><span class="c1">#                 </span>
</span><span id="Robot-1571"><a href="#Robot-1571"><span class="linenos">1571</span></a><span class="c1">#             if scan_turn &lt;= -90:</span>
</span><span id="Robot-1572"><a href="#Robot-1572"><span class="linenos">1572</span></a><span class="c1">#                 self._status[&#39;found&#39;] = False</span>
</span><span id="Robot-1573"><a href="#Robot-1573"><span class="linenos">1573</span></a><span class="c1">#                 self._success = False</span>
</span><span id="Robot-1574"><a href="#Robot-1574"><span class="linenos">1574</span></a><span class="c1">#                 self._task_now = &#39;scanning&#39;</span>
</span><span id="Robot-1575"><a href="#Robot-1575"><span class="linenos">1575</span></a><span class="c1">#                 self._actions[self._task_now] = False</span>
</span><span id="Robot-1576"><a href="#Robot-1576"><span class="linenos">1576</span></a><span class="c1">#                 self._logger.warning(&quot;No objects in nearby vicinity&quot;)</span>
</span><span id="Robot-1577"><a href="#Robot-1577"><span class="linenos">1577</span></a><span class="c1">#                 return None</span>
</span><span id="Robot-1578"><a href="#Robot-1578"><span class="linenos">1578</span></a>                
</span><span id="Robot-1579"><a href="#Robot-1579"><span class="linenos">1579</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scan_turn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
</span><span id="Robot-1580"><a href="#Robot-1580"><span class="linenos">1580</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1581"><a href="#Robot-1581"><span class="linenos">1581</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1582"><a href="#Robot-1582"><span class="linenos">1582</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;scanning&#39;</span>
</span><span id="Robot-1583"><a href="#Robot-1583"><span class="linenos">1583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1584"><a href="#Robot-1584"><span class="linenos">1584</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No objects in nearby vicinity&quot;</span><span class="p">)</span>
</span><span id="Robot-1585"><a href="#Robot-1585"><span class="linenos">1585</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Robot-1586"><a href="#Robot-1586"><span class="linenos">1586</span></a>    
</span><span id="Robot-1587"><a href="#Robot-1587"><span class="linenos">1587</span></a>    <span class="k">def</span> <span class="nf">_pick_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1588"><a href="#Robot-1588"><span class="linenos">1588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1589"><a href="#Robot-1589"><span class="linenos">1589</span></a><span class="sd">        This function drives the robot to steadily approach and picks up toy block</span>
</span><span id="Robot-1590"><a href="#Robot-1590"><span class="linenos">1590</span></a><span class="sd">        </span>
</span><span id="Robot-1591"><a href="#Robot-1591"><span class="linenos">1591</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1592"><a href="#Robot-1592"><span class="linenos">1592</span></a><span class="sd">            None</span>
</span><span id="Robot-1593"><a href="#Robot-1593"><span class="linenos">1593</span></a><span class="sd">            </span>
</span><span id="Robot-1594"><a href="#Robot-1594"><span class="linenos">1594</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1595"><a href="#Robot-1595"><span class="linenos">1595</span></a><span class="sd">            None</span>
</span><span id="Robot-1596"><a href="#Robot-1596"><span class="linenos">1596</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1597"><a href="#Robot-1597"><span class="linenos">1597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1598"><a href="#Robot-1598"><span class="linenos">1598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;picking&#39;</span>
</span><span id="Robot-1599"><a href="#Robot-1599"><span class="linenos">1599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1600"><a href="#Robot-1600"><span class="linenos">1600</span></a>        
</span><span id="Robot-1601"><a href="#Robot-1601"><span class="linenos">1601</span></a>        <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-1602"><a href="#Robot-1602"><span class="linenos">1602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1603"><a href="#Robot-1603"><span class="linenos">1603</span></a>        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-1604"><a href="#Robot-1604"><span class="linenos">1604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1605"><a href="#Robot-1605"><span class="linenos">1605</span></a>        
</span><span id="Robot-1606"><a href="#Robot-1606"><span class="linenos">1606</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>
</span><span id="Robot-1607"><a href="#Robot-1607"><span class="linenos">1607</span></a>            <span class="c1"># Open gripper</span>
</span><span id="Robot-1608"><a href="#Robot-1608"><span class="linenos">1608</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">])</span>
</span><span id="Robot-1609"><a href="#Robot-1609"><span class="linenos">1609</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">]</span> 
</span><span id="Robot-1610"><a href="#Robot-1610"><span class="linenos">1610</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Servo Opened&quot;</span><span class="p">)</span>
</span><span id="Robot-1611"><a href="#Robot-1611"><span class="linenos">1611</span></a>            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-1612"><a href="#Robot-1612"><span class="linenos">1612</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1613"><a href="#Robot-1613"><span class="linenos">1613</span></a>            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-1614"><a href="#Robot-1614"><span class="linenos">1614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1615"><a href="#Robot-1615"><span class="linenos">1615</span></a>            <span class="c1"># Align robot fine turne rotation</span>
</span><span id="Robot-1616"><a href="#Robot-1616"><span class="linenos">1616</span></a>            <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="Robot-1617"><a href="#Robot-1617"><span class="linenos">1617</span></a>            
</span><span id="Robot-1618"><a href="#Robot-1618"><span class="linenos">1618</span></a><span class="c1">#             while True:</span>
</span><span id="Robot-1619"><a href="#Robot-1619"><span class="linenos">1619</span></a><span class="c1">#                 if degree is not None:</span>
</span><span id="Robot-1620"><a href="#Robot-1620"><span class="linenos">1620</span></a><span class="c1">#                     if abs(degree) &gt; 0.6:</span>
</span><span id="Robot-1621"><a href="#Robot-1621"><span class="linenos">1621</span></a><span class="c1">#                         self._pivot(degree, steady=True)</span>
</span><span id="Robot-1622"><a href="#Robot-1622"><span class="linenos">1622</span></a><span class="c1">#                     else:</span>
</span><span id="Robot-1623"><a href="#Robot-1623"><span class="linenos">1623</span></a><span class="c1">#                         break</span>
</span><span id="Robot-1624"><a href="#Robot-1624"><span class="linenos">1624</span></a><span class="c1">#                 else:</span>
</span><span id="Robot-1625"><a href="#Robot-1625"><span class="linenos">1625</span></a><span class="c1">#                     break</span>
</span><span id="Robot-1626"><a href="#Robot-1626"><span class="linenos">1626</span></a>            <span class="c1"># Scan block and drive slowly towards it</span>
</span><span id="Robot-1627"><a href="#Robot-1627"><span class="linenos">1627</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Driving slowly toward block&quot;</span><span class="p">)</span>
</span><span id="Robot-1628"><a href="#Robot-1628"><span class="linenos">1628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1629"><a href="#Robot-1629"><span class="linenos">1629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Slow drive completed&quot;</span><span class="p">)</span>
</span><span id="Robot-1630"><a href="#Robot-1630"><span class="linenos">1630</span></a>            
</span><span id="Robot-1631"><a href="#Robot-1631"><span class="linenos">1631</span></a>            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-1632"><a href="#Robot-1632"><span class="linenos">1632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1633"><a href="#Robot-1633"><span class="linenos">1633</span></a>            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-1634"><a href="#Robot-1634"><span class="linenos">1634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1635"><a href="#Robot-1635"><span class="linenos">1635</span></a>            
</span><span id="Robot-1636"><a href="#Robot-1636"><span class="linenos">1636</span></a>            <span class="c1"># Close gripper</span>
</span><span id="Robot-1637"><a href="#Robot-1637"><span class="linenos">1637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span>
</span><span id="Robot-1638"><a href="#Robot-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span>
</span><span id="Robot-1639"><a href="#Robot-1639"><span class="linenos">1639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Servo Closed&quot;</span><span class="p">)</span>
</span><span id="Robot-1640"><a href="#Robot-1640"><span class="linenos">1640</span></a>            
</span><span id="Robot-1641"><a href="#Robot-1641"><span class="linenos">1641</span></a>            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-1642"><a href="#Robot-1642"><span class="linenos">1642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-1643"><a href="#Robot-1643"><span class="linenos">1643</span></a>            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-1644"><a href="#Robot-1644"><span class="linenos">1644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-1645"><a href="#Robot-1645"><span class="linenos">1645</span></a>            
</span><span id="Robot-1646"><a href="#Robot-1646"><span class="linenos">1646</span></a>            <span class="c1">#if (abs(radius2 - radius1) &lt; 5) or (abs(center2[0] - center1[0]) &lt; 3):</span>
</span><span id="Robot-1647"><a href="#Robot-1647"><span class="linenos">1647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block has been gripped successfully&quot;</span><span class="p">)</span>
</span><span id="Robot-1648"><a href="#Robot-1648"><span class="linenos">1648</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1649"><a href="#Robot-1649"><span class="linenos">1649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;picked_up&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1650"><a href="#Robot-1650"><span class="linenos">1650</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1651"><a href="#Robot-1651"><span class="linenos">1651</span></a>            
</span><span id="Robot-1652"><a href="#Robot-1652"><span class="linenos">1652</span></a>        <span class="c1"># Read saved image and send via email</span>
</span><span id="Robot-1653"><a href="#Robot-1653"><span class="linenos">1653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_email_media</span><span class="p">()</span>
</span><span id="Robot-1654"><a href="#Robot-1654"><span class="linenos">1654</span></a>
</span><span id="Robot-1655"><a href="#Robot-1655"><span class="linenos">1655</span></a>    <span class="k">def</span> <span class="nf">_go2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">destination</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="Robot-1656"><a href="#Robot-1656"><span class="linenos">1656</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1657"><a href="#Robot-1657"><span class="linenos">1657</span></a><span class="sd">        This function computes the difference in pose between the robot and the desired destination,</span>
</span><span id="Robot-1658"><a href="#Robot-1658"><span class="linenos">1658</span></a><span class="sd">        then estimates the displacement vector along with the angle of rotation needed</span>
</span><span id="Robot-1659"><a href="#Robot-1659"><span class="linenos">1659</span></a><span class="sd">        to align the robot head  on. It then calls the pivot and go2block functions respectively</span>
</span><span id="Robot-1660"><a href="#Robot-1660"><span class="linenos">1660</span></a><span class="sd">        and command the robot to enter the construction zone.</span>
</span><span id="Robot-1661"><a href="#Robot-1661"><span class="linenos">1661</span></a><span class="sd">        </span>
</span><span id="Robot-1662"><a href="#Robot-1662"><span class="linenos">1662</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1663"><a href="#Robot-1663"><span class="linenos">1663</span></a><span class="sd">            destination (tuple): contans x,y location of destination</span>
</span><span id="Robot-1664"><a href="#Robot-1664"><span class="linenos">1664</span></a><span class="sd">            area (str): Describes where that destination is</span>
</span><span id="Robot-1665"><a href="#Robot-1665"><span class="linenos">1665</span></a><span class="sd">            </span>
</span><span id="Robot-1666"><a href="#Robot-1666"><span class="linenos">1666</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1667"><a href="#Robot-1667"><span class="linenos">1667</span></a><span class="sd">            None</span>
</span><span id="Robot-1668"><a href="#Robot-1668"><span class="linenos">1668</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1669"><a href="#Robot-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initiating travel to </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1670"><a href="#Robot-1670"><span class="linenos">1670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1671"><a href="#Robot-1671"><span class="linenos">1671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;returning&#39;</span>
</span><span id="Robot-1672"><a href="#Robot-1672"><span class="linenos">1672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1673"><a href="#Robot-1673"><span class="linenos">1673</span></a>        
</span><span id="Robot-1674"><a href="#Robot-1674"><span class="linenos">1674</span></a>        <span class="c1"># Read last position from the appended path</span>
</span><span id="Robot-1675"><a href="#Robot-1675"><span class="linenos">1675</span></a>        <span class="c1"># self.global_x = self._path[-1][0]</span>
</span><span id="Robot-1676"><a href="#Robot-1676"><span class="linenos">1676</span></a>        <span class="c1"># self.global_y = self._path[-1][1]</span>
</span><span id="Robot-1677"><a href="#Robot-1677"><span class="linenos">1677</span></a>        <span class="c1">#self.global_yaw = self._path[-1][2]</span>
</span><span id="Robot-1678"><a href="#Robot-1678"><span class="linenos">1678</span></a>        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">destination</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span>
</span><span id="Robot-1679"><a href="#Robot-1679"><span class="linenos">1679</span></a>        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">destination</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span>
</span><span id="Robot-1680"><a href="#Robot-1680"><span class="linenos">1680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1681"><a href="#Robot-1681"><span class="linenos">1681</span></a>        
</span><span id="Robot-1682"><a href="#Robot-1682"><span class="linenos">1682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pose Now: X- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="si">}</span><span class="s2"> and Y- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="si">}</span><span class="s2"> and Yaw- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1683"><a href="#Robot-1683"><span class="linenos">1683</span></a>        <span class="c1"># Compute the euclidean distance between current robot location and construction zone</span>
</span><span id="Robot-1684"><a href="#Robot-1684"><span class="linenos">1684</span></a>        <span class="n">disp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">delta_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-1685"><a href="#Robot-1685"><span class="linenos">1685</span></a>        <span class="c1"># Calculate the yaw angle difference between these two points using slope equation</span>
</span><span id="Robot-1686"><a href="#Robot-1686"><span class="linenos">1686</span></a>        <span class="n">rad_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">delta_y</span><span class="p">,</span><span class="n">delta_x</span><span class="p">)</span>                
</span><span id="Robot-1687"><a href="#Robot-1687"><span class="linenos">1687</span></a>        <span class="c1"># Convert from radians to angle</span>
</span><span id="Robot-1688"><a href="#Robot-1688"><span class="linenos">1688</span></a>        <span class="n">target_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rad_diff</span><span class="p">)</span>
</span><span id="Robot-1689"><a href="#Robot-1689"><span class="linenos">1689</span></a>        <span class="c1"># Ensure angle is between [0, 360]</span>
</span><span id="Robot-1690"><a href="#Robot-1690"><span class="linenos">1690</span></a>        <span class="n">target_angle</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="Robot-1691"><a href="#Robot-1691"><span class="linenos">1691</span></a>        
</span><span id="Robot-1692"><a href="#Robot-1692"><span class="linenos">1692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computed target angle is </span><span class="si">{</span><span class="n">target_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1693"><a href="#Robot-1693"><span class="linenos">1693</span></a>        
</span><span id="Robot-1694"><a href="#Robot-1694"><span class="linenos">1694</span></a>        <span class="c1"># # Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="Robot-1695"><a href="#Robot-1695"><span class="linenos">1695</span></a>        <span class="k">if</span> <span class="n">target_angle</span> <span class="o">&gt;=-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">target_angle</span> <span class="o">&lt;=</span><span class="mi">180</span><span class="p">:</span>
</span><span id="Robot-1696"><a href="#Robot-1696"><span class="linenos">1696</span></a>            <span class="n">target_angle</span> <span class="o">=</span> <span class="o">-</span><span class="n">target_angle</span>
</span><span id="Robot-1697"><a href="#Robot-1697"><span class="linenos">1697</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">target_angle</span> <span class="o">&gt;=</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">target_angle</span> <span class="o">&lt;</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-1698"><a href="#Robot-1698"><span class="linenos">1698</span></a>            <span class="n">target_angle</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">target_angle</span>
</span><span id="Robot-1699"><a href="#Robot-1699"><span class="linenos">1699</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">target_angle</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">360</span> <span class="ow">and</span> <span class="n">target_angle</span> <span class="o">&lt;=-</span><span class="mi">180</span><span class="p">):</span>
</span><span id="Robot-1700"><a href="#Robot-1700"><span class="linenos">1700</span></a>            <span class="n">target_angle</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">target_angle</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="Robot-1701"><a href="#Robot-1701"><span class="linenos">1701</span></a>            
</span><span id="Robot-1702"><a href="#Robot-1702"><span class="linenos">1702</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normalized target angle is </span><span class="si">{</span><span class="n">target_angle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1703"><a href="#Robot-1703"><span class="linenos">1703</span></a><span class="c1">#         # Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="Robot-1704"><a href="#Robot-1704"><span class="linenos">1704</span></a><span class="c1">#         target_angle = (target_angle + 180) % 360 - 180</span>
</span><span id="Robot-1705"><a href="#Robot-1705"><span class="linenos">1705</span></a>        <span class="c1"># # Angle difference from current and target</span>
</span><span id="Robot-1706"><a href="#Robot-1706"><span class="linenos">1706</span></a>        <span class="c1"># deg_diff = self._yaw - target_angle </span>
</span><span id="Robot-1707"><a href="#Robot-1707"><span class="linenos">1707</span></a>        <span class="c1"># deg_diff %= 360</span>
</span><span id="Robot-1708"><a href="#Robot-1708"><span class="linenos">1708</span></a>        
</span><span id="Robot-1709"><a href="#Robot-1709"><span class="linenos">1709</span></a>        <span class="c1"># Based on the quadrant of the point heading towards normalize</span>
</span><span id="Robot-1710"><a href="#Robot-1710"><span class="linenos">1710</span></a>        <span class="c1"># the target angle</span>
</span><span id="Robot-1711"><a href="#Robot-1711"><span class="linenos">1711</span></a><span class="c1">#         if delta_x &lt; 0:</span>
</span><span id="Robot-1712"><a href="#Robot-1712"><span class="linenos">1712</span></a><span class="c1">#             if delta_y &gt; 0:</span>
</span><span id="Robot-1713"><a href="#Robot-1713"><span class="linenos">1713</span></a><span class="c1">#                 #target_angle = 180 - target_angle</span>
</span><span id="Robot-1714"><a href="#Robot-1714"><span class="linenos">1714</span></a><span class="c1">#                 pass</span>
</span><span id="Robot-1715"><a href="#Robot-1715"><span class="linenos">1715</span></a><span class="c1">#             else:</span>
</span><span id="Robot-1716"><a href="#Robot-1716"><span class="linenos">1716</span></a><span class="c1"># #                 target_angle = target_angle - 180</span>
</span><span id="Robot-1717"><a href="#Robot-1717"><span class="linenos">1717</span></a><span class="c1">#                 pass</span>
</span><span id="Robot-1718"><a href="#Robot-1718"><span class="linenos">1718</span></a><span class="c1">#         else:</span>
</span><span id="Robot-1719"><a href="#Robot-1719"><span class="linenos">1719</span></a><span class="c1">#             if delta_y &lt; 0:</span>
</span><span id="Robot-1720"><a href="#Robot-1720"><span class="linenos">1720</span></a><span class="c1"># #                 target_angle = -target_angle</span>
</span><span id="Robot-1721"><a href="#Robot-1721"><span class="linenos">1721</span></a><span class="c1">#                 pass</span>
</span><span id="Robot-1722"><a href="#Robot-1722"><span class="linenos">1722</span></a>        
</span><span id="Robot-1723"><a href="#Robot-1723"><span class="linenos">1723</span></a>        <span class="c1"># convert target angle with respect to imu configuration</span>
</span><span id="Robot-1724"><a href="#Robot-1724"><span class="linenos">1724</span></a>        <span class="c1"># target_angle = -target_angle</span>
</span><span id="Robot-1725"><a href="#Robot-1725"><span class="linenos">1725</span></a>        
</span><span id="Robot-1726"><a href="#Robot-1726"><span class="linenos">1726</span></a>        <span class="c1"># Angle difference from current and target</span>
</span><span id="Robot-1727"><a href="#Robot-1727"><span class="linenos">1727</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">target_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>  
</span><span id="Robot-1728"><a href="#Robot-1728"><span class="linenos">1728</span></a>        <span class="c1">#deg_diff %= 360</span>
</span><span id="Robot-1729"><a href="#Robot-1729"><span class="linenos">1729</span></a>        
</span><span id="Robot-1730"><a href="#Robot-1730"><span class="linenos">1730</span></a><span class="c1">#         if (deg_diff &gt; 180 and deg_diff &lt;360):</span>
</span><span id="Robot-1731"><a href="#Robot-1731"><span class="linenos">1731</span></a><span class="c1">#             deg_diff = (deg_diff - 360) # Turning to the right</span>
</span><span id="Robot-1732"><a href="#Robot-1732"><span class="linenos">1732</span></a><span class="c1">#         elif (deg_diff &gt; -360 and deg_diff &lt;=-180):</span>
</span><span id="Robot-1733"><a href="#Robot-1733"><span class="linenos">1733</span></a><span class="c1">#             deg_diff = (deg_diff + 360) # Turning to the left</span>
</span><span id="Robot-1734"><a href="#Robot-1734"><span class="linenos">1734</span></a>            
</span><span id="Robot-1735"><a href="#Robot-1735"><span class="linenos">1735</span></a><span class="c1">#         # Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="Robot-1736"><a href="#Robot-1736"><span class="linenos">1736</span></a><span class="c1">#         if (deg_diff &gt; 180 and deg_diff &lt;=360):</span>
</span><span id="Robot-1737"><a href="#Robot-1737"><span class="linenos">1737</span></a><span class="c1">#             deg_diff = deg_diff - 360</span>
</span><span id="Robot-1738"><a href="#Robot-1738"><span class="linenos">1738</span></a><span class="c1">#         # Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="Robot-1739"><a href="#Robot-1739"><span class="linenos">1739</span></a><span class="c1">#         deg_diff = (deg_diff + 180) % 360 - 180</span>
</span><span id="Robot-1740"><a href="#Robot-1740"><span class="linenos">1740</span></a>        
</span><span id="Robot-1741"><a href="#Robot-1741"><span class="linenos">1741</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Yaw that vehicle will pivot to </span><span class="si">{</span><span class="n">deg_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1742"><a href="#Robot-1742"><span class="linenos">1742</span></a>        <span class="c1"># Pivot robot to face construction zone</span>
</span><span id="Robot-1743"><a href="#Robot-1743"><span class="linenos">1743</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span> <span class="n">just_turn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1744"><a href="#Robot-1744"><span class="linenos">1744</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started driving straight to </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1745"><a href="#Robot-1745"><span class="linenos">1745</span></a>        <span class="c1"># Drive robot foward to construction zone</span>
</span><span id="Robot-1746"><a href="#Robot-1746"><span class="linenos">1746</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">eucl_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span><span class="n">just_drive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1747"><a href="#Robot-1747"><span class="linenos">1747</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arrived at </span><span class="si">{</span><span class="n">area</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Robot-1748"><a href="#Robot-1748"><span class="linenos">1748</span></a>        
</span><span id="Robot-1749"><a href="#Robot-1749"><span class="linenos">1749</span></a>        <span class="c1"># New global yaw</span>
</span><span id="Robot-1750"><a href="#Robot-1750"><span class="linenos">1750</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">global_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1751"><a href="#Robot-1751"><span class="linenos">1751</span></a>        
</span><span id="Robot-1752"><a href="#Robot-1752"><span class="linenos">1752</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1753"><a href="#Robot-1753"><span class="linenos">1753</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;arrived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1754"><a href="#Robot-1754"><span class="linenos">1754</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1755"><a href="#Robot-1755"><span class="linenos">1755</span></a>        
</span><span id="Robot-1756"><a href="#Robot-1756"><span class="linenos">1756</span></a>    <span class="k">def</span> <span class="nf">_place</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1757"><a href="#Robot-1757"><span class="linenos">1757</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1758"><a href="#Robot-1758"><span class="linenos">1758</span></a><span class="sd">        This function places toy block</span>
</span><span id="Robot-1759"><a href="#Robot-1759"><span class="linenos">1759</span></a><span class="sd">        </span>
</span><span id="Robot-1760"><a href="#Robot-1760"><span class="linenos">1760</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1761"><a href="#Robot-1761"><span class="linenos">1761</span></a><span class="sd">            None</span>
</span><span id="Robot-1762"><a href="#Robot-1762"><span class="linenos">1762</span></a><span class="sd">            </span>
</span><span id="Robot-1763"><a href="#Robot-1763"><span class="linenos">1763</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1764"><a href="#Robot-1764"><span class="linenos">1764</span></a><span class="sd">            None</span>
</span><span id="Robot-1765"><a href="#Robot-1765"><span class="linenos">1765</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1766"><a href="#Robot-1766"><span class="linenos">1766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1767"><a href="#Robot-1767"><span class="linenos">1767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;placing&#39;</span>
</span><span id="Robot-1768"><a href="#Robot-1768"><span class="linenos">1768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1769"><a href="#Robot-1769"><span class="linenos">1769</span></a>        
</span><span id="Robot-1770"><a href="#Robot-1770"><span class="linenos">1770</span></a>        <span class="c1"># Open gripper</span>
</span><span id="Robot-1771"><a href="#Robot-1771"><span class="linenos">1771</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">])</span>
</span><span id="Robot-1772"><a href="#Robot-1772"><span class="linenos">1772</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;opened&#39;</span><span class="p">]</span> 
</span><span id="Robot-1773"><a href="#Robot-1773"><span class="linenos">1773</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gripper Opened to place </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="Robot-1774"><a href="#Robot-1774"><span class="linenos">1774</span></a>        
</span><span id="Robot-1775"><a href="#Robot-1775"><span class="linenos">1775</span></a>        <span class="c1"># Drive in reverse</span>
</span><span id="Robot-1776"><a href="#Robot-1776"><span class="linenos">1776</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;rev&#39;</span><span class="p">,</span><span class="n">eucl_disp</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">just_drive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1777"><a href="#Robot-1777"><span class="linenos">1777</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-1778"><a href="#Robot-1778"><span class="linenos">1778</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Backed away from toy block&quot;</span><span class="p">)</span>
</span><span id="Robot-1779"><a href="#Robot-1779"><span class="linenos">1779</span></a>        
</span><span id="Robot-1780"><a href="#Robot-1780"><span class="linenos">1780</span></a>        <span class="c1"># Close gripper</span>
</span><span id="Robot-1781"><a href="#Robot-1781"><span class="linenos">1781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_servo_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span>
</span><span id="Robot-1782"><a href="#Robot-1782"><span class="linenos">1782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span> 
</span><span id="Robot-1783"><a href="#Robot-1783"><span class="linenos">1783</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Gripper Closed to prepare for next order&quot;</span><span class="p">)</span>
</span><span id="Robot-1784"><a href="#Robot-1784"><span class="linenos">1784</span></a>        
</span><span id="Robot-1785"><a href="#Robot-1785"><span class="linenos">1785</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1786"><a href="#Robot-1786"><span class="linenos">1786</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">[</span><span class="s1">&#39;placed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1787"><a href="#Robot-1787"><span class="linenos">1787</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1788"><a href="#Robot-1788"><span class="linenos">1788</span></a>        
</span><span id="Robot-1789"><a href="#Robot-1789"><span class="linenos">1789</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block is now placed inside construction zone&quot;</span><span class="p">)</span>
</span><span id="Robot-1790"><a href="#Robot-1790"><span class="linenos">1790</span></a>        
</span><span id="Robot-1791"><a href="#Robot-1791"><span class="linenos">1791</span></a>        <span class="c1"># Read saved image and send via email</span>
</span><span id="Robot-1792"><a href="#Robot-1792"><span class="linenos">1792</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_email_media</span><span class="p">()</span>
</span><span id="Robot-1793"><a href="#Robot-1793"><span class="linenos">1793</span></a>        
</span><span id="Robot-1794"><a href="#Robot-1794"><span class="linenos">1794</span></a>    <span class="k">def</span> <span class="nf">_localize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1795"><a href="#Robot-1795"><span class="linenos">1795</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1796"><a href="#Robot-1796"><span class="linenos">1796</span></a><span class="sd">        This function uses distance sensor to read from borderwall</span>
</span><span id="Robot-1797"><a href="#Robot-1797"><span class="linenos">1797</span></a><span class="sd">        so that the robot&#39;s exact position in arena can easily be</span>
</span><span id="Robot-1798"><a href="#Robot-1798"><span class="linenos">1798</span></a><span class="sd">        identified</span>
</span><span id="Robot-1799"><a href="#Robot-1799"><span class="linenos">1799</span></a><span class="sd">        </span>
</span><span id="Robot-1800"><a href="#Robot-1800"><span class="linenos">1800</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1801"><a href="#Robot-1801"><span class="linenos">1801</span></a><span class="sd">            None</span>
</span><span id="Robot-1802"><a href="#Robot-1802"><span class="linenos">1802</span></a><span class="sd">            </span>
</span><span id="Robot-1803"><a href="#Robot-1803"><span class="linenos">1803</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1804"><a href="#Robot-1804"><span class="linenos">1804</span></a><span class="sd">            None</span>
</span><span id="Robot-1805"><a href="#Robot-1805"><span class="linenos">1805</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1806"><a href="#Robot-1806"><span class="linenos">1806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1807"><a href="#Robot-1807"><span class="linenos">1807</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;localizing&#39;</span>
</span><span id="Robot-1808"><a href="#Robot-1808"><span class="linenos">1808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1809"><a href="#Robot-1809"><span class="linenos">1809</span></a>        
</span><span id="Robot-1810"><a href="#Robot-1810"><span class="linenos">1810</span></a>        <span class="c1"># pivot the robot to positive y first and read from distance sensor</span>
</span><span id="Robot-1811"><a href="#Robot-1811"><span class="linenos">1811</span></a>        <span class="n">yaw_final</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
</span><span id="Robot-1812"><a href="#Robot-1812"><span class="linenos">1812</span></a>        <span class="n">yaw_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1813"><a href="#Robot-1813"><span class="linenos">1813</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="n">yaw_current</span>
</span><span id="Robot-1814"><a href="#Robot-1814"><span class="linenos">1814</span></a>        
</span><span id="Robot-1815"><a href="#Robot-1815"><span class="linenos">1815</span></a>        <span class="c1">#deg_diff %= 360</span>
</span><span id="Robot-1816"><a href="#Robot-1816"><span class="linenos">1816</span></a>        <span class="c1"># Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="Robot-1817"><a href="#Robot-1817"><span class="linenos">1817</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-1818"><a href="#Robot-1818"><span class="linenos">1818</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">deg_diff</span>   
</span><span id="Robot-1819"><a href="#Robot-1819"><span class="linenos">1819</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">360</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">180</span><span class="p">):</span>
</span><span id="Robot-1820"><a href="#Robot-1820"><span class="linenos">1820</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">deg_diff</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>    
</span><span id="Robot-1821"><a href="#Robot-1821"><span class="linenos">1821</span></a>        
</span><span id="Robot-1822"><a href="#Robot-1822"><span class="linenos">1822</span></a>        <span class="c1"># Turn towards borderwall</span>
</span><span id="Robot-1823"><a href="#Robot-1823"><span class="linenos">1823</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span> <span class="n">just_turn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1824"><a href="#Robot-1824"><span class="linenos">1824</span></a>        
</span><span id="Robot-1825"><a href="#Robot-1825"><span class="linenos">1825</span></a>        <span class="c1"># Now read distance sensor value</span>
</span><span id="Robot-1826"><a href="#Robot-1826"><span class="linenos">1826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">()</span>
</span><span id="Robot-1827"><a href="#Robot-1827"><span class="linenos">1827</span></a>        <span class="n">delta_ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2feet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_depth</span><span class="p">)</span>
</span><span id="Robot-1828"><a href="#Robot-1828"><span class="linenos">1828</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1829"><a href="#Robot-1829"><span class="linenos">1829</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1830"><a href="#Robot-1830"><span class="linenos">1830</span></a>        <span class="n">x1</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1831"><a href="#Robot-1831"><span class="linenos">1831</span></a>        <span class="n">y1</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1832"><a href="#Robot-1832"><span class="linenos">1832</span></a>        
</span><span id="Robot-1833"><a href="#Robot-1833"><span class="linenos">1833</span></a>        <span class="c1"># Extract y pose by normalizing from border wall</span>
</span><span id="Robot-1834"><a href="#Robot-1834"><span class="linenos">1834</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="Robot-1835"><a href="#Robot-1835"><span class="linenos">1835</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">-</span> <span class="n">y1</span>
</span><span id="Robot-1836"><a href="#Robot-1836"><span class="linenos">1836</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-1837"><a href="#Robot-1837"><span class="linenos">1837</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_y</span> <span class="o">=</span> <span class="n">y1</span>
</span><span id="Robot-1838"><a href="#Robot-1838"><span class="linenos">1838</span></a>        
</span><span id="Robot-1839"><a href="#Robot-1839"><span class="linenos">1839</span></a>        <span class="c1"># pivot the robot to negative x first and read from distance sensor</span>
</span><span id="Robot-1840"><a href="#Robot-1840"><span class="linenos">1840</span></a>        <span class="n">yaw_final</span> <span class="o">=</span> <span class="o">-</span><span class="mi">179</span>
</span><span id="Robot-1841"><a href="#Robot-1841"><span class="linenos">1841</span></a>        <span class="n">yaw_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1842"><a href="#Robot-1842"><span class="linenos">1842</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">yaw_final</span> <span class="o">-</span> <span class="n">yaw_current</span>
</span><span id="Robot-1843"><a href="#Robot-1843"><span class="linenos">1843</span></a>        <span class="c1">#deg_diff %= 360</span>
</span><span id="Robot-1844"><a href="#Robot-1844"><span class="linenos">1844</span></a>        
</span><span id="Robot-1845"><a href="#Robot-1845"><span class="linenos">1845</span></a>        <span class="c1"># Normalize angle difference to range [-180, 180) degrees</span>
</span><span id="Robot-1846"><a href="#Robot-1846"><span class="linenos">1846</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-1847"><a href="#Robot-1847"><span class="linenos">1847</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">deg_diff</span>   
</span><span id="Robot-1848"><a href="#Robot-1848"><span class="linenos">1848</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">360</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">180</span><span class="p">):</span>
</span><span id="Robot-1849"><a href="#Robot-1849"><span class="linenos">1849</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">deg_diff</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>
</span><span id="Robot-1850"><a href="#Robot-1850"><span class="linenos">1850</span></a>        
</span><span id="Robot-1851"><a href="#Robot-1851"><span class="linenos">1851</span></a>        <span class="c1"># Turn towards borderwall</span>
</span><span id="Robot-1852"><a href="#Robot-1852"><span class="linenos">1852</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">,</span> <span class="n">just_turn</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1853"><a href="#Robot-1853"><span class="linenos">1853</span></a>        
</span><span id="Robot-1854"><a href="#Robot-1854"><span class="linenos">1854</span></a>        <span class="c1"># Now read distance sensor value</span>
</span><span id="Robot-1855"><a href="#Robot-1855"><span class="linenos">1855</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_distance</span><span class="p">()</span>
</span><span id="Robot-1856"><a href="#Robot-1856"><span class="linenos">1856</span></a>        <span class="n">delta_ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cm2feet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_depth</span><span class="p">)</span>
</span><span id="Robot-1857"><a href="#Robot-1857"><span class="linenos">1857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial</span><span class="p">()</span>
</span><span id="Robot-1858"><a href="#Robot-1858"><span class="linenos">1858</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span>
</span><span id="Robot-1859"><a href="#Robot-1859"><span class="linenos">1859</span></a>        <span class="n">x2</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1860"><a href="#Robot-1860"><span class="linenos">1860</span></a>        <span class="n">y2</span> <span class="o">=</span> <span class="n">delta_ft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</span><span id="Robot-1861"><a href="#Robot-1861"><span class="linenos">1861</span></a>        
</span><span id="Robot-1862"><a href="#Robot-1862"><span class="linenos">1862</span></a>        <span class="c1"># Extract x pose by normalizing from border wall</span>
</span><span id="Robot-1863"><a href="#Robot-1863"><span class="linenos">1863</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="Robot-1864"><a href="#Robot-1864"><span class="linenos">1864</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">-</span> <span class="n">x2</span>
</span><span id="Robot-1865"><a href="#Robot-1865"><span class="linenos">1865</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-1866"><a href="#Robot-1866"><span class="linenos">1866</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">global_x</span> <span class="o">=</span> <span class="n">x2</span>
</span><span id="Robot-1867"><a href="#Robot-1867"><span class="linenos">1867</span></a>        
</span><span id="Robot-1868"><a href="#Robot-1868"><span class="linenos">1868</span></a>        <span class="c1"># Add detected pose of robot into path list    </span>
</span><span id="Robot-1869"><a href="#Robot-1869"><span class="linenos">1869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_x</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_y</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>    
</span><span id="Robot-1870"><a href="#Robot-1870"><span class="linenos">1870</span></a>            
</span><span id="Robot-1871"><a href="#Robot-1871"><span class="linenos">1871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1872"><a href="#Robot-1872"><span class="linenos">1872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot-1873"><a href="#Robot-1873"><span class="linenos">1873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Localization complete&quot;</span><span class="p">)</span>
</span><span id="Robot-1874"><a href="#Robot-1874"><span class="linenos">1874</span></a>            
</span><span id="Robot-1875"><a href="#Robot-1875"><span class="linenos">1875</span></a>    <span class="k">def</span> <span class="nf">_go2site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1876"><a href="#Robot-1876"><span class="linenos">1876</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1877"><a href="#Robot-1877"><span class="linenos">1877</span></a><span class="sd">        This function commands the robot to drive back to the center</span>
</span><span id="Robot-1878"><a href="#Robot-1878"><span class="linenos">1878</span></a><span class="sd">        of the arena or near the cluttered enviorment to resume delivering</span>
</span><span id="Robot-1879"><a href="#Robot-1879"><span class="linenos">1879</span></a><span class="sd">        order</span>
</span><span id="Robot-1880"><a href="#Robot-1880"><span class="linenos">1880</span></a><span class="sd">        </span>
</span><span id="Robot-1881"><a href="#Robot-1881"><span class="linenos">1881</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1882"><a href="#Robot-1882"><span class="linenos">1882</span></a><span class="sd">            None</span>
</span><span id="Robot-1883"><a href="#Robot-1883"><span class="linenos">1883</span></a><span class="sd">            </span>
</span><span id="Robot-1884"><a href="#Robot-1884"><span class="linenos">1884</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1885"><a href="#Robot-1885"><span class="linenos">1885</span></a><span class="sd">            None</span>
</span><span id="Robot-1886"><a href="#Robot-1886"><span class="linenos">1886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1887"><a href="#Robot-1887"><span class="linenos">1887</span></a>        
</span><span id="Robot-1888"><a href="#Robot-1888"><span class="linenos">1888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initiating travel to cluttered environment&quot;</span><span class="p">)</span>
</span><span id="Robot-1889"><a href="#Robot-1889"><span class="linenos">1889</span></a>        <span class="c1"># Compute the euclidean distance between current robot location and construction zone</span>
</span><span id="Robot-1890"><a href="#Robot-1890"><span class="linenos">1890</span></a>        <span class="n">disp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-1891"><a href="#Robot-1891"><span class="linenos">1891</span></a>        <span class="c1"># Calculate the yaw angle difference between these two points using slope equation</span>
</span><span id="Robot-1892"><a href="#Robot-1892"><span class="linenos">1892</span></a>        <span class="n">rad_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="Robot-1893"><a href="#Robot-1893"><span class="linenos">1893</span></a>        <span class="c1"># Convert from radians to angle</span>
</span><span id="Robot-1894"><a href="#Robot-1894"><span class="linenos">1894</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rad_diff</span><span class="p">)</span>
</span><span id="Robot-1895"><a href="#Robot-1895"><span class="linenos">1895</span></a>        <span class="c1"># Ensure angle is between [0, 360]</span>
</span><span id="Robot-1896"><a href="#Robot-1896"><span class="linenos">1896</span></a>        <span class="n">deg_diff</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="Robot-1897"><a href="#Robot-1897"><span class="linenos">1897</span></a>        <span class="c1"># Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="Robot-1898"><a href="#Robot-1898"><span class="linenos">1898</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-1899"><a href="#Robot-1899"><span class="linenos">1899</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">deg_diff</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="Robot-1900"><a href="#Robot-1900"><span class="linenos">1900</span></a>            
</span><span id="Robot-1901"><a href="#Robot-1901"><span class="linenos">1901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orienting to cluttered environment&quot;</span><span class="p">)</span>
</span><span id="Robot-1902"><a href="#Robot-1902"><span class="linenos">1902</span></a>        <span class="c1"># Pivot robot to face construction zone</span>
</span><span id="Robot-1903"><a href="#Robot-1903"><span class="linenos">1903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">)</span>
</span><span id="Robot-1904"><a href="#Robot-1904"><span class="linenos">1904</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started driving straight to cluttered environment&quot;</span><span class="p">)</span>
</span><span id="Robot-1905"><a href="#Robot-1905"><span class="linenos">1905</span></a>        <span class="c1"># Drive robot foward to construction zone</span>
</span><span id="Robot-1906"><a href="#Robot-1906"><span class="linenos">1906</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">eucl_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span><span class="n">just_drive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1907"><a href="#Robot-1907"><span class="linenos">1907</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Arrived at cluttered environment&quot;</span><span class="p">)</span>
</span><span id="Robot-1908"><a href="#Robot-1908"><span class="linenos">1908</span></a>        
</span><span id="Robot-1909"><a href="#Robot-1909"><span class="linenos">1909</span></a>    <span class="k">def</span> <span class="nf">_go_home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1910"><a href="#Robot-1910"><span class="linenos">1910</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1911"><a href="#Robot-1911"><span class="linenos">1911</span></a><span class="sd">        This function commands the robot to drive back to its home location</span>
</span><span id="Robot-1912"><a href="#Robot-1912"><span class="linenos">1912</span></a><span class="sd">        marking the end of the challenge.</span>
</span><span id="Robot-1913"><a href="#Robot-1913"><span class="linenos">1913</span></a><span class="sd">        </span>
</span><span id="Robot-1914"><a href="#Robot-1914"><span class="linenos">1914</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1915"><a href="#Robot-1915"><span class="linenos">1915</span></a><span class="sd">            None</span>
</span><span id="Robot-1916"><a href="#Robot-1916"><span class="linenos">1916</span></a><span class="sd">            </span>
</span><span id="Robot-1917"><a href="#Robot-1917"><span class="linenos">1917</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1918"><a href="#Robot-1918"><span class="linenos">1918</span></a><span class="sd">            None</span>
</span><span id="Robot-1919"><a href="#Robot-1919"><span class="linenos">1919</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1920"><a href="#Robot-1920"><span class="linenos">1920</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initiating travel to home base&quot;</span><span class="p">)</span>
</span><span id="Robot-1921"><a href="#Robot-1921"><span class="linenos">1921</span></a>        <span class="c1"># Compute the euclidean distance between current robot location and construction zone</span>
</span><span id="Robot-1922"><a href="#Robot-1922"><span class="linenos">1922</span></a>        <span class="n">disp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Robot-1923"><a href="#Robot-1923"><span class="linenos">1923</span></a>        <span class="c1"># Calculate the yaw angle difference between these two points using slope equation</span>
</span><span id="Robot-1924"><a href="#Robot-1924"><span class="linenos">1924</span></a>        <span class="n">rad_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
</span><span id="Robot-1925"><a href="#Robot-1925"><span class="linenos">1925</span></a>        <span class="c1"># Convert from radians to angle</span>
</span><span id="Robot-1926"><a href="#Robot-1926"><span class="linenos">1926</span></a>        <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">rad_diff</span><span class="p">)</span>
</span><span id="Robot-1927"><a href="#Robot-1927"><span class="linenos">1927</span></a>        <span class="c1"># Ensure angle is between [0, 360]</span>
</span><span id="Robot-1928"><a href="#Robot-1928"><span class="linenos">1928</span></a>        <span class="n">deg_diff</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="Robot-1929"><a href="#Robot-1929"><span class="linenos">1929</span></a>        <span class="c1"># Place angle from [0,360] to [-180,0) U [0,180] </span>
</span><span id="Robot-1930"><a href="#Robot-1930"><span class="linenos">1930</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">deg_diff</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">deg_diff</span> <span class="o">&lt;=</span><span class="mi">360</span><span class="p">):</span>
</span><span id="Robot-1931"><a href="#Robot-1931"><span class="linenos">1931</span></a>            <span class="n">deg_diff</span> <span class="o">=</span> <span class="n">deg_diff</span> <span class="o">-</span> <span class="mi">360</span>
</span><span id="Robot-1932"><a href="#Robot-1932"><span class="linenos">1932</span></a>            
</span><span id="Robot-1933"><a href="#Robot-1933"><span class="linenos">1933</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orienting to home base&quot;</span><span class="p">)</span>
</span><span id="Robot-1934"><a href="#Robot-1934"><span class="linenos">1934</span></a>        <span class="c1"># Pivot robot to face construction zone</span>
</span><span id="Robot-1935"><a href="#Robot-1935"><span class="linenos">1935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">deg_diff</span><span class="p">)</span>
</span><span id="Robot-1936"><a href="#Robot-1936"><span class="linenos">1936</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started driving straight to home base&quot;</span><span class="p">)</span>
</span><span id="Robot-1937"><a href="#Robot-1937"><span class="linenos">1937</span></a>        <span class="c1"># Drive robot foward to construction zone</span>
</span><span id="Robot-1938"><a href="#Robot-1938"><span class="linenos">1938</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">(</span><span class="n">eucl_disp</span> <span class="o">=</span> <span class="n">disp</span><span class="p">,</span><span class="n">just_drive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-1939"><a href="#Robot-1939"><span class="linenos">1939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Arrived at home&quot;</span><span class="p">)</span>
</span><span id="Robot-1940"><a href="#Robot-1940"><span class="linenos">1940</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Thank you for playing game.&quot;</span><span class="p">)</span>
</span><span id="Robot-1941"><a href="#Robot-1941"><span class="linenos">1941</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Powering off.&quot;</span><span class="p">)</span>
</span><span id="Robot-1942"><a href="#Robot-1942"><span class="linenos">1942</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-1943"><a href="#Robot-1943"><span class="linenos">1943</span></a>        
</span><span id="Robot-1944"><a href="#Robot-1944"><span class="linenos">1944</span></a>    <span class="k">def</span> <span class="nf">plot_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot-1945"><a href="#Robot-1945"><span class="linenos">1945</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1946"><a href="#Robot-1946"><span class="linenos">1946</span></a><span class="sd">        Plot the path of the robot during the grand challenge. </span>
</span><span id="Robot-1947"><a href="#Robot-1947"><span class="linenos">1947</span></a><span class="sd">        </span>
</span><span id="Robot-1948"><a href="#Robot-1948"><span class="linenos">1948</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1949"><a href="#Robot-1949"><span class="linenos">1949</span></a><span class="sd">            None</span>
</span><span id="Robot-1950"><a href="#Robot-1950"><span class="linenos">1950</span></a><span class="sd">        Return:</span>
</span><span id="Robot-1951"><a href="#Robot-1951"><span class="linenos">1951</span></a><span class="sd">            None</span>
</span><span id="Robot-1952"><a href="#Robot-1952"><span class="linenos">1952</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1953"><a href="#Robot-1953"><span class="linenos">1953</span></a>        <span class="c1"># Take in the path list as an array 2D NumPy array</span>
</span><span id="Robot-1954"><a href="#Robot-1954"><span class="linenos">1954</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</span><span id="Robot-1955"><a href="#Robot-1955"><span class="linenos">1955</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot-1956"><a href="#Robot-1956"><span class="linenos">1956</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot-1957"><a href="#Robot-1957"><span class="linenos">1957</span></a>        
</span><span id="Robot-1958"><a href="#Robot-1958"><span class="linenos">1958</span></a>        <span class="c1"># Create figure and plot</span>
</span><span id="Robot-1959"><a href="#Robot-1959"><span class="linenos">1959</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-1960"><a href="#Robot-1960"><span class="linenos">1960</span></a>        
</span><span id="Robot-1961"><a href="#Robot-1961"><span class="linenos">1961</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Motor Encoder Analysis&#39;</span><span class="p">)</span>
</span><span id="Robot-1962"><a href="#Robot-1962"><span class="linenos">1962</span></a>
</span><span id="Robot-1963"><a href="#Robot-1963"><span class="linenos">1963</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s1"> Path&#39;</span><span class="p">)</span>
</span><span id="Robot-1964"><a href="#Robot-1964"><span class="linenos">1964</span></a>
</span><span id="Robot-1965"><a href="#Robot-1965"><span class="linenos">1965</span></a>        <span class="c1"># 3) Label the axes, title, legend</span>
</span><span id="Robot-1966"><a href="#Robot-1966"><span class="linenos">1966</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
</span><span id="Robot-1967"><a href="#Robot-1967"><span class="linenos">1967</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
</span><span id="Robot-1968"><a href="#Robot-1968"><span class="linenos">1968</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Robot-1969"><a href="#Robot-1969"><span class="linenos">1969</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Robot-1970"><a href="#Robot-1970"><span class="linenos">1970</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;grandChallenge-robotPath.png&#39;</span><span class="p">)</span>
</span><span id="Robot-1971"><a href="#Robot-1971"><span class="linenos">1971</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Robot-1972"><a href="#Robot-1972"><span class="linenos">1972</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Robot-1973"><a href="#Robot-1973"><span class="linenos">1973</span></a>
</span><span id="Robot-1974"><a href="#Robot-1974"><span class="linenos">1974</span></a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
</span><span id="Robot-1975"><a href="#Robot-1975"><span class="linenos">1975</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot-1976"><a href="#Robot-1976"><span class="linenos">1976</span></a><span class="sd">        The sequence of actions occuring while baron robot works to pick and place</span>
</span><span id="Robot-1977"><a href="#Robot-1977"><span class="linenos">1977</span></a><span class="sd">        all toy blocks to the construction zone. This function lists the steps needed</span>
</span><span id="Robot-1978"><a href="#Robot-1978"><span class="linenos">1978</span></a><span class="sd">        for the robot to complete the orders passed to it at the beginning of competition</span>
</span><span id="Robot-1979"><a href="#Robot-1979"><span class="linenos">1979</span></a><span class="sd">        </span>
</span><span id="Robot-1980"><a href="#Robot-1980"><span class="linenos">1980</span></a><span class="sd">        Args:</span>
</span><span id="Robot-1981"><a href="#Robot-1981"><span class="linenos">1981</span></a><span class="sd">            order: List[Blocks] list of all toy blocks needed to complete challenge</span>
</span><span id="Robot-1982"><a href="#Robot-1982"><span class="linenos">1982</span></a><span class="sd">        </span>
</span><span id="Robot-1983"><a href="#Robot-1983"><span class="linenos">1983</span></a><span class="sd">        Returns:</span>
</span><span id="Robot-1984"><a href="#Robot-1984"><span class="linenos">1984</span></a><span class="sd">            None</span>
</span><span id="Robot-1985"><a href="#Robot-1985"><span class="linenos">1985</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot-1986"><a href="#Robot-1986"><span class="linenos">1986</span></a>        
</span><span id="Robot-1987"><a href="#Robot-1987"><span class="linenos">1987</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Robot-1988"><a href="#Robot-1988"><span class="linenos">1988</span></a>            <span class="c1"># Assign order from object initialization</span>
</span><span id="Robot-1989"><a href="#Robot-1989"><span class="linenos">1989</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Robot-1990"><a href="#Robot-1990"><span class="linenos">1990</span></a>        
</span><span id="Robot-1991"><a href="#Robot-1991"><span class="linenos">1991</span></a>            <span class="c1"># First wait until startup QR Code has been read</span>
</span><span id="Robot-1992"><a href="#Robot-1992"><span class="linenos">1992</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot-1993"><a href="#Robot-1993"><span class="linenos">1993</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait2start</span><span class="p">():</span>
</span><span id="Robot-1994"><a href="#Robot-1994"><span class="linenos">1994</span></a>                    <span class="k">break</span>
</span><span id="Robot-1995"><a href="#Robot-1995"><span class="linenos">1995</span></a>            
</span><span id="Robot-1996"><a href="#Robot-1996"><span class="linenos">1996</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Robot-1997"><a href="#Robot-1997"><span class="linenos">1997</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;While Robot is still active, resume challenge&quot;&quot;&quot;</span>
</span><span id="Robot-1998"><a href="#Robot-1998"><span class="linenos">1998</span></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span><span class="p">):</span>
</span><span id="Robot-1999"><a href="#Robot-1999"><span class="linenos">1999</span></a>
</span><span id="Robot-2000"><a href="#Robot-2000"><span class="linenos">2000</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot-2001"><a href="#Robot-2001"><span class="linenos">2001</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_order_no</span> <span class="o">+=</span><span class="mi">1</span>
</span><span id="Robot-2002"><a href="#Robot-2002"><span class="linenos">2002</span></a>
</span><span id="Robot-2003"><a href="#Robot-2003"><span class="linenos">2003</span></a>                    <span class="c1"># Begin challenge with choesn block</span>
</span><span id="Robot-2004"><a href="#Robot-2004"><span class="linenos">2004</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="Robot-2005"><a href="#Robot-2005"><span class="linenos">2005</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*** Picking Up </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="Robot-2006"><a href="#Robot-2006"><span class="linenos">2006</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="Robot-2007"><a href="#Robot-2007"><span class="linenos">2007</span></a>                
</span><span id="Robot-2008"><a href="#Robot-2008"><span class="linenos">2008</span></a>                    <span class="c1"># Track the number of times robot drives to search area</span>
</span><span id="Robot-2009"><a href="#Robot-2009"><span class="linenos">2009</span></a>                    <span class="n">search</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot-2010"><a href="#Robot-2010"><span class="linenos">2010</span></a>                    
</span><span id="Robot-2011"><a href="#Robot-2011"><span class="linenos">2011</span></a>                    <span class="c1"># Drive robot to center of arena, get view of toy blocks and begin</span>
</span><span id="Robot-2012"><a href="#Robot-2012"><span class="linenos">2012</span></a>                    <span class="c1"># extracting blocks</span>
</span><span id="Robot-2013"><a href="#Robot-2013"><span class="linenos">2013</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;cluttered environment&#39;</span><span class="p">)</span>
</span><span id="Robot-2014"><a href="#Robot-2014"><span class="linenos">2014</span></a>                
</span><span id="Robot-2015"><a href="#Robot-2015"><span class="linenos">2015</span></a>                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot-2016"><a href="#Robot-2016"><span class="linenos">2016</span></a>                
</span><span id="Robot-2017"><a href="#Robot-2017"><span class="linenos">2017</span></a>                        <span class="c1"># Begin by scanning for toy block object</span>
</span><span id="Robot-2018"><a href="#Robot-2018"><span class="linenos">2018</span></a>                        <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="Robot-2019"><a href="#Robot-2019"><span class="linenos">2019</span></a>                        
</span><span id="Robot-2020"><a href="#Robot-2020"><span class="linenos">2020</span></a>                        <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-2021"><a href="#Robot-2021"><span class="linenos">2021</span></a>                        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-2022"><a href="#Robot-2022"><span class="linenos">2022</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-2023"><a href="#Robot-2023"><span class="linenos">2023</span></a>                        
</span><span id="Robot-2024"><a href="#Robot-2024"><span class="linenos">2024</span></a>                        <span class="c1"># Drive toward block if successful, else pivot to</span>
</span><span id="Robot-2025"><a href="#Robot-2025"><span class="linenos">2025</span></a>                        <span class="c1"># a free space and drive</span>
</span><span id="Robot-2026"><a href="#Robot-2026"><span class="linenos">2026</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>
</span><span id="Robot-2027"><a href="#Robot-2027"><span class="linenos">2027</span></a>                            <span class="c1">#self._logger(f&quot;Pivoting Robot towards {self._block_now} block&quot;)</span>
</span><span id="Robot-2028"><a href="#Robot-2028"><span class="linenos">2028</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-2029"><a href="#Robot-2029"><span class="linenos">2029</span></a>                            
</span><span id="Robot-2030"><a href="#Robot-2030"><span class="linenos">2030</span></a>                            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-2031"><a href="#Robot-2031"><span class="linenos">2031</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-2032"><a href="#Robot-2032"><span class="linenos">2032</span></a>                            <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span><span class="n">__</span><span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="Robot-2033"><a href="#Robot-2033"><span class="linenos">2033</span></a>                            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot-2034"><a href="#Robot-2034"><span class="linenos">2034</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-2035"><a href="#Robot-2035"><span class="linenos">2035</span></a>                            
</span><span id="Robot-2036"><a href="#Robot-2036"><span class="linenos">2036</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drive Robot forward to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="Robot-2037"><a href="#Robot-2037"><span class="linenos">2037</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">()</span>
</span><span id="Robot-2038"><a href="#Robot-2038"><span class="linenos">2038</span></a>                            
</span><span id="Robot-2039"><a href="#Robot-2039"><span class="linenos">2039</span></a>                            <span class="c1"># # Update global x and y</span>
</span><span id="Robot-2040"><a href="#Robot-2040"><span class="linenos">2040</span></a>                            <span class="c1"># self.global_x += self._x</span>
</span><span id="Robot-2041"><a href="#Robot-2041"><span class="linenos">2041</span></a>                            <span class="c1"># self.global_y += self._y</span>
</span><span id="Robot-2042"><a href="#Robot-2042"><span class="linenos">2042</span></a>                            
</span><span id="Robot-2043"><a href="#Robot-2043"><span class="linenos">2043</span></a>                            <span class="c1">##self._logger(f&quot;{self._name} is now at x- {self.global_x} and y- {self.global_y}&quot;)</span>
</span><span id="Robot-2044"><a href="#Robot-2044"><span class="linenos">2044</span></a>                            
</span><span id="Robot-2045"><a href="#Robot-2045"><span class="linenos">2045</span></a>                            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot-2046"><a href="#Robot-2046"><span class="linenos">2046</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot-2047"><a href="#Robot-2047"><span class="linenos">2047</span></a>                            <span class="c1">#cntr_bbox.img_show(&quot;Arrived at Block&quot;,self._img_frame)</span>
</span><span id="Robot-2048"><a href="#Robot-2048"><span class="linenos">2048</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot-2049"><a href="#Robot-2049"><span class="linenos">2049</span></a>                            
</span><span id="Robot-2050"><a href="#Robot-2050"><span class="linenos">2050</span></a>                            <span class="c1">##self._logger(f&quot;Pick up {self._block_now} block with gripper&quot;)</span>
</span><span id="Robot-2051"><a href="#Robot-2051"><span class="linenos">2051</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_pick_up</span><span class="p">()</span>
</span><span id="Robot-2052"><a href="#Robot-2052"><span class="linenos">2052</span></a>                            
</span><span id="Robot-2053"><a href="#Robot-2053"><span class="linenos">2053</span></a>                            <span class="c1"># Drive robot to construction zone to place block</span>
</span><span id="Robot-2054"><a href="#Robot-2054"><span class="linenos">2054</span></a>                            <span class="c1">##self._logger(f&quot;Take {self._block_now} block to construction zone&quot;)</span>
</span><span id="Robot-2055"><a href="#Robot-2055"><span class="linenos">2055</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">const_zone</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;construction zone&#39;</span><span class="p">)</span>
</span><span id="Robot-2056"><a href="#Robot-2056"><span class="linenos">2056</span></a>                            
</span><span id="Robot-2057"><a href="#Robot-2057"><span class="linenos">2057</span></a>                            <span class="c1">#self._logger(f&quot;Place {self._block_now} block inside construction zone&quot;)</span>
</span><span id="Robot-2058"><a href="#Robot-2058"><span class="linenos">2058</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_place</span><span class="p">()</span>
</span><span id="Robot-2059"><a href="#Robot-2059"><span class="linenos">2059</span></a>                            
</span><span id="Robot-2060"><a href="#Robot-2060"><span class="linenos">2060</span></a><span class="c1">#                             #self._logger(&quot;Localizing to get accurate location of robot&quot;)</span>
</span><span id="Robot-2061"><a href="#Robot-2061"><span class="linenos">2061</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_localize</span><span class="p">()</span>
</span><span id="Robot-2062"><a href="#Robot-2062"><span class="linenos">2062</span></a>                            
</span><span id="Robot-2063"><a href="#Robot-2063"><span class="linenos">2063</span></a>                            <span class="c1">##self._logger(f&quot;Pick up and place the next order in the queue&quot;)</span>
</span><span id="Robot-2064"><a href="#Robot-2064"><span class="linenos">2064</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot-2065"><a href="#Robot-2065"><span class="linenos">2065</span></a>                            <span class="k">break</span>
</span><span id="Robot-2066"><a href="#Robot-2066"><span class="linenos">2066</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-2067"><a href="#Robot-2067"><span class="linenos">2067</span></a>                            <span class="c1">#self._logger(&quot;No toy blocks found in current pose. Change pose and&quot;)</span>
</span><span id="Robot-2068"><a href="#Robot-2068"><span class="linenos">2068</span></a>                            <span class="c1">#self._logger(&quot;try again.&quot;)</span>
</span><span id="Robot-2069"><a href="#Robot-2069"><span class="linenos">2069</span></a>                            
</span><span id="Robot-2070"><a href="#Robot-2070"><span class="linenos">2070</span></a>                            <span class="c1"># Drive robot to the predetermined survey locations</span>
</span><span id="Robot-2071"><a href="#Robot-2071"><span class="linenos">2071</span></a>                            <span class="k">if</span> <span class="n">search</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Robot-2072"><a href="#Robot-2072"><span class="linenos">2072</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_survey_loc</span><span class="p">[</span><span class="n">search</span><span class="p">],</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;Alternative survey area&#39;</span><span class="p">)</span>
</span><span id="Robot-2073"><a href="#Robot-2073"><span class="linenos">2073</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-2074"><a href="#Robot-2074"><span class="linenos">2074</span></a>                                <span class="c1">#self._logger(f&quot;Robot can&#39;t find {self._block_now} block in time.&quot;)</span>
</span><span id="Robot-2075"><a href="#Robot-2075"><span class="linenos">2075</span></a>                                <span class="c1">#self._logger(&quot;In pursuit of time, moving on to next block in queue&quot;)</span>
</span><span id="Robot-2076"><a href="#Robot-2076"><span class="linenos">2076</span></a>                                <span class="k">break</span>
</span><span id="Robot-2077"><a href="#Robot-2077"><span class="linenos">2077</span></a>                            <span class="n">search</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot-2078"><a href="#Robot-2078"><span class="linenos">2078</span></a>                            
</span><span id="Robot-2079"><a href="#Robot-2079"><span class="linenos">2079</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Robot-2080"><a href="#Robot-2080"><span class="linenos">2080</span></a>                <span class="c1">#self._logger(f&quot;Mission complete. Take robot back to home base&quot;)</span>
</span><span id="Robot-2081"><a href="#Robot-2081"><span class="linenos">2081</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;home base&#39;</span><span class="p">)</span>
</span><span id="Robot-2082"><a href="#Robot-2082"><span class="linenos">2082</span></a>                <span class="k">return</span> 
</span><span id="Robot-2083"><a href="#Robot-2083"><span class="linenos">2083</span></a>        
</span><span id="Robot-2084"><a href="#Robot-2084"><span class="linenos">2084</span></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot-2085"><a href="#Robot-2085"><span class="linenos">2085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</span><span id="Robot-2086"><a href="#Robot-2086"><span class="linenos">2086</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="Robot-2087"><a href="#Robot-2087"><span class="linenos">2087</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-2088"><a href="#Robot-2088"><span class="linenos">2088</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Robot-2089"><a href="#Robot-2089"><span class="linenos">2089</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot-2090"><a href="#Robot-2090"><span class="linenos">2090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot-2091"><a href="#Robot-2091"><span class="linenos">2091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="Robot-2092"><a href="#Robot-2092"><span class="linenos">2092</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot-2093"><a href="#Robot-2093"><span class="linenos">2093</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>A class defining basic attributes of Baron robot that
will be autonomously achieving objective</p>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>name (str):</strong>  Name of robot</li>
<li><strong>_x (float):</strong>  horizontal position of robot from start postion</li>
<li><strong>_y (float):</strong>  vertical position of robot from start position</li>
<li><strong>_yaw (float):</strong>  yaw orientation from +x as horizontal [0,180] or (-180,0)</li>
<li><strong>_travel(float):</strong>  estimating the distance to drive and reach block</li>
<li><strong>_turn (float):</strong>  keeps the next turn needed by block</li>
<li><strong>_depth (float):</strong>  measures distance of obstacle in front of robot from image</li>
<li><strong>_path (list):</strong>  stores the path traveled by robot as list of (x,y) points and yaw</li>
<li><strong>_pwms (list):</strong>  stores a list of pwms for the robot motors</li>
<li><strong>_dutycycle (dict):</strong>  holds the baseline pwm dutycycle for forward,reverse,
pivotleft and pivotright</li>
<li><strong>_success (bool):</strong>  keeps track whether a given task is successful or not</li>
<li><strong>_gripper_state (str):</strong>  stores gripper duty cycle state as opened or closed</li>
<li><strong>_order(list):</strong>  List of blocks to pickup</li>
<li><strong>_end_game (bool):</strong>  tells competition is over by victory or failure</li>
<li><strong>_order_no (int):</strong>  keeps track of number of orders completed</li>
<li><strong>_block_now (str):</strong>  the block being pursued now</li>
<li><strong>_task_now (str):</strong>  keeps track of the task being completed at the moment</li>
<li><strong>_actions (dict):</strong>  holding list of all service actions robot performs with bool
on which process is being done at a given time</li>
<li><strong>_status (dict):</strong>  a dictionary keeping track of completed actions along with</li>
<li><strong>_img_frame (img):</strong>  saves current image frame</li>
<li><strong>_out (cv2 video obj):</strong>  gather all frames into a video</li>
<li><strong>_logger (log):</strong>  log statements for debuging and status over the terminal</li>
<li><strong>_kp (float):</strong>  proportional gain</li>
<li><strong>_ki (float):</strong>  integral gain</li>
<li><strong>_kd (float):</strong>  derivative gain</li>
<li><strong>_direction (str):</strong>  tells weather robot is moving forward or reverse</li>
<li><strong>_event (event):</strong>  event object to end the thread call</li>
<li><strong>_pause_event (event):</strong>  event object to pause and resume thread</li>
<li><strong>imu_reader (thread):</strong>  threading object to read from imu during forward run</li>
<li><strong>_ser (serial):</strong>  object reading serial input streams from imu sensor</li>
<li><strong>_img_saved (img):</strong>  keeping track of saved image to send in an email</li>
<li><strong>_survey_loc (List):</strong>  containes x,y locations for the robot to navigate and scan
so that to extract toy blocks for mission</li>
</ul>
</div>


                            <div id="Robot.__init__" class="classattr">
                                        <input id="Robot.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Robot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="Robot.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Robot.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Robot.__init__-145"><a href="#Robot.__init__-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Robot.__init__-146"><a href="#Robot.__init__-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot.__init__-147"><a href="#Robot.__init__-147"><span class="linenos">147</span></a><span class="sd">        Initialize Robot attributes</span>
</span><span id="Robot.__init__-148"><a href="#Robot.__init__-148"><span class="linenos">148</span></a><span class="sd">        </span>
</span><span id="Robot.__init__-149"><a href="#Robot.__init__-149"><span class="linenos">149</span></a><span class="sd">        Args:</span>
</span><span id="Robot.__init__-150"><a href="#Robot.__init__-150"><span class="linenos">150</span></a><span class="sd">            name: str - takes name of robot</span>
</span><span id="Robot.__init__-151"><a href="#Robot.__init__-151"><span class="linenos">151</span></a><span class="sd">        </span>
</span><span id="Robot.__init__-152"><a href="#Robot.__init__-152"><span class="linenos">152</span></a><span class="sd">        Returns:</span>
</span><span id="Robot.__init__-153"><a href="#Robot.__init__-153"><span class="linenos">153</span></a><span class="sd">            None</span>
</span><span id="Robot.__init__-154"><a href="#Robot.__init__-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot.__init__-155"><a href="#Robot.__init__-155"><span class="linenos">155</span></a>
</span><span id="Robot.__init__-156"><a href="#Robot.__init__-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Robot.__init__-157"><a href="#Robot.__init__-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot.__init__-158"><a href="#Robot.__init__-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot.__init__-159"><a href="#Robot.__init__-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_yaw</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Robot.__init__-160"><a href="#Robot.__init__-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_travel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot.__init__-161"><a href="#Robot.__init__-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_turn</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot.__init__-162"><a href="#Robot.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot.__init__-163"><a href="#Robot.__init__-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="Robot.__init__-164"><a href="#Robot.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pwms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot.__init__-165"><a href="#Robot.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dutycycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duty</span>
</span><span id="Robot.__init__-166"><a href="#Robot.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot.__init__-167"><a href="#Robot.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip_state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span>
</span><span id="Robot.__init__-168"><a href="#Robot.__init__-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Robot.__init__-169"><a href="#Robot.__init__-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Robot.__init__-170"><a href="#Robot.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_order_no</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot.__init__-171"><a href="#Robot.__init__-171"><span class="linenos">171</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Robot.__init__-172"><a href="#Robot.__init__-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_task_now</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Robot.__init__-173"><a href="#Robot.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;driving&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;rotating&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;picking&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;placing&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;localizing&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;returning&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;scanning&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)])</span>
</span><span id="Robot.__init__-174"><a href="#Robot.__init__-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;started&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;picked_up&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;found&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;placed&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;finished&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;arrived&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)])</span>
</span><span id="Robot.__init__-175"><a href="#Robot.__init__-175"><span class="linenos">175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="Robot.__init__-176"><a href="#Robot.__init__-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s1">&#39;grand_chall_vid.avi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fourcc</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">))</span>
</span><span id="Robot.__init__-177"><a href="#Robot.__init__-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Robot.__init__-178"><a href="#Robot.__init__-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span>
</span><span id="Robot.__init__-179"><a href="#Robot.__init__-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ki</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span>
</span><span id="Robot.__init__-180"><a href="#Robot.__init__-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span>
</span><span id="Robot.__init__-181"><a href="#Robot.__init__-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
</span><span id="Robot.__init__-182"><a href="#Robot.__init__-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="Robot.__init__-183"><a href="#Robot.__init__-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="Robot.__init__-184"><a href="#Robot.__init__-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">imu_reader</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imu_serial_straight</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,))</span>
</span><span id="Robot.__init__-185"><a href="#Robot.__init__-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;/dev/ttyUSB0&#39;</span><span class="p">,</span> <span class="mi">19200</span><span class="p">)</span>
</span><span id="Robot.__init__-186"><a href="#Robot.__init__-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_img_saved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="Robot.__init__-187"><a href="#Robot.__init__-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_survey_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_spots</span>
</span><span id="Robot.__init__-188"><a href="#Robot.__init__-188"><span class="linenos">188</span></a>        
</span><span id="Robot.__init__-189"><a href="#Robot.__init__-189"><span class="linenos">189</span></a>        <span class="c1"># Set up logger with Debug initially</span>
</span><span id="Robot.__init__-190"><a href="#Robot.__init__-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="Robot.__init__-191"><a href="#Robot.__init__-191"><span class="linenos">191</span></a>        <span class="c1"># Create console handler and set level to debug</span>
</span><span id="Robot.__init__-192"><a href="#Robot.__init__-192"><span class="linenos">192</span></a>        <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span><span id="Robot.__init__-193"><a href="#Robot.__init__-193"><span class="linenos">193</span></a>        <span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="Robot.__init__-194"><a href="#Robot.__init__-194"><span class="linenos">194</span></a>        <span class="c1"># log terminal messages to a file</span>
</span><span id="Robot.__init__-195"><a href="#Robot.__init__-195"><span class="linenos">195</span></a>        <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;gc_log_3.log&#39;</span><span class="p">)</span>
</span><span id="Robot.__init__-196"><a href="#Robot.__init__-196"><span class="linenos">196</span></a>        <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="Robot.__init__-197"><a href="#Robot.__init__-197"><span class="linenos">197</span></a>        <span class="c1"># Create formatter</span>
</span><span id="Robot.__init__-198"><a href="#Robot.__init__-198"><span class="linenos">198</span></a>        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Robot.__init__-199"><a href="#Robot.__init__-199"><span class="linenos">199</span></a>        <span class="c1"># Add formatter to handler</span>
</span><span id="Robot.__init__-200"><a href="#Robot.__init__-200"><span class="linenos">200</span></a>        <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="Robot.__init__-201"><a href="#Robot.__init__-201"><span class="linenos">201</span></a>        <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="Robot.__init__-202"><a href="#Robot.__init__-202"><span class="linenos">202</span></a>        <span class="c1"># Add console handler to logger</span>
</span><span id="Robot.__init__-203"><a href="#Robot.__init__-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
</span><span id="Robot.__init__-204"><a href="#Robot.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</span><span id="Robot.__init__-205"><a href="#Robot.__init__-205"><span class="linenos">205</span></a>        <span class="c1"># Initialize gpios and pwms</span>
</span><span id="Robot.__init__-206"><a href="#Robot.__init__-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize Robot attributes</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name:</strong>  str - takes name of robot</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                            <div id="Robot.plot_path" class="classattr">
                                        <input id="Robot.plot_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Robot.plot_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Robot.plot_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Robot.plot_path-1944"><a href="#Robot.plot_path-1944"><span class="linenos">1944</span></a>    <span class="k">def</span> <span class="nf">plot_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Robot.plot_path-1945"><a href="#Robot.plot_path-1945"><span class="linenos">1945</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot.plot_path-1946"><a href="#Robot.plot_path-1946"><span class="linenos">1946</span></a><span class="sd">        Plot the path of the robot during the grand challenge. </span>
</span><span id="Robot.plot_path-1947"><a href="#Robot.plot_path-1947"><span class="linenos">1947</span></a><span class="sd">        </span>
</span><span id="Robot.plot_path-1948"><a href="#Robot.plot_path-1948"><span class="linenos">1948</span></a><span class="sd">        Args:</span>
</span><span id="Robot.plot_path-1949"><a href="#Robot.plot_path-1949"><span class="linenos">1949</span></a><span class="sd">            None</span>
</span><span id="Robot.plot_path-1950"><a href="#Robot.plot_path-1950"><span class="linenos">1950</span></a><span class="sd">        Return:</span>
</span><span id="Robot.plot_path-1951"><a href="#Robot.plot_path-1951"><span class="linenos">1951</span></a><span class="sd">            None</span>
</span><span id="Robot.plot_path-1952"><a href="#Robot.plot_path-1952"><span class="linenos">1952</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot.plot_path-1953"><a href="#Robot.plot_path-1953"><span class="linenos">1953</span></a>        <span class="c1"># Take in the path list as an array 2D NumPy array</span>
</span><span id="Robot.plot_path-1954"><a href="#Robot.plot_path-1954"><span class="linenos">1954</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
</span><span id="Robot.plot_path-1955"><a href="#Robot.plot_path-1955"><span class="linenos">1955</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Robot.plot_path-1956"><a href="#Robot.plot_path-1956"><span class="linenos">1956</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Robot.plot_path-1957"><a href="#Robot.plot_path-1957"><span class="linenos">1957</span></a>        
</span><span id="Robot.plot_path-1958"><a href="#Robot.plot_path-1958"><span class="linenos">1958</span></a>        <span class="c1"># Create figure and plot</span>
</span><span id="Robot.plot_path-1959"><a href="#Robot.plot_path-1959"><span class="linenos">1959</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot.plot_path-1960"><a href="#Robot.plot_path-1960"><span class="linenos">1960</span></a>        
</span><span id="Robot.plot_path-1961"><a href="#Robot.plot_path-1961"><span class="linenos">1961</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Motor Encoder Analysis&#39;</span><span class="p">)</span>
</span><span id="Robot.plot_path-1962"><a href="#Robot.plot_path-1962"><span class="linenos">1962</span></a>
</span><span id="Robot.plot_path-1963"><a href="#Robot.plot_path-1963"><span class="linenos">1963</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s1"> Path&#39;</span><span class="p">)</span>
</span><span id="Robot.plot_path-1964"><a href="#Robot.plot_path-1964"><span class="linenos">1964</span></a>
</span><span id="Robot.plot_path-1965"><a href="#Robot.plot_path-1965"><span class="linenos">1965</span></a>        <span class="c1"># 3) Label the axes, title, legend</span>
</span><span id="Robot.plot_path-1966"><a href="#Robot.plot_path-1966"><span class="linenos">1966</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
</span><span id="Robot.plot_path-1967"><a href="#Robot.plot_path-1967"><span class="linenos">1967</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
</span><span id="Robot.plot_path-1968"><a href="#Robot.plot_path-1968"><span class="linenos">1968</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Robot.plot_path-1969"><a href="#Robot.plot_path-1969"><span class="linenos">1969</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Robot.plot_path-1970"><a href="#Robot.plot_path-1970"><span class="linenos">1970</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;grandChallenge-robotPath.png&#39;</span><span class="p">)</span>
</span><span id="Robot.plot_path-1971"><a href="#Robot.plot_path-1971"><span class="linenos">1971</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Robot.plot_path-1972"><a href="#Robot.plot_path-1972"><span class="linenos">1972</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plot the path of the robot during the grand challenge. </p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li>None</li>
</ul>

<h6 id="return">Return:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                            <div id="Robot.start" class="classattr">
                                        <input id="Robot.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">order</span><span class="p">:</span> <span class="n">List</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Robot.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Robot.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Robot.start-1974"><a href="#Robot.start-1974"><span class="linenos">1974</span></a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
</span><span id="Robot.start-1975"><a href="#Robot.start-1975"><span class="linenos">1975</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Robot.start-1976"><a href="#Robot.start-1976"><span class="linenos">1976</span></a><span class="sd">        The sequence of actions occuring while baron robot works to pick and place</span>
</span><span id="Robot.start-1977"><a href="#Robot.start-1977"><span class="linenos">1977</span></a><span class="sd">        all toy blocks to the construction zone. This function lists the steps needed</span>
</span><span id="Robot.start-1978"><a href="#Robot.start-1978"><span class="linenos">1978</span></a><span class="sd">        for the robot to complete the orders passed to it at the beginning of competition</span>
</span><span id="Robot.start-1979"><a href="#Robot.start-1979"><span class="linenos">1979</span></a><span class="sd">        </span>
</span><span id="Robot.start-1980"><a href="#Robot.start-1980"><span class="linenos">1980</span></a><span class="sd">        Args:</span>
</span><span id="Robot.start-1981"><a href="#Robot.start-1981"><span class="linenos">1981</span></a><span class="sd">            order: List[Blocks] list of all toy blocks needed to complete challenge</span>
</span><span id="Robot.start-1982"><a href="#Robot.start-1982"><span class="linenos">1982</span></a><span class="sd">        </span>
</span><span id="Robot.start-1983"><a href="#Robot.start-1983"><span class="linenos">1983</span></a><span class="sd">        Returns:</span>
</span><span id="Robot.start-1984"><a href="#Robot.start-1984"><span class="linenos">1984</span></a><span class="sd">            None</span>
</span><span id="Robot.start-1985"><a href="#Robot.start-1985"><span class="linenos">1985</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Robot.start-1986"><a href="#Robot.start-1986"><span class="linenos">1986</span></a>        
</span><span id="Robot.start-1987"><a href="#Robot.start-1987"><span class="linenos">1987</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Robot.start-1988"><a href="#Robot.start-1988"><span class="linenos">1988</span></a>            <span class="c1"># Assign order from object initialization</span>
</span><span id="Robot.start-1989"><a href="#Robot.start-1989"><span class="linenos">1989</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_order</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Robot.start-1990"><a href="#Robot.start-1990"><span class="linenos">1990</span></a>        
</span><span id="Robot.start-1991"><a href="#Robot.start-1991"><span class="linenos">1991</span></a>            <span class="c1"># First wait until startup QR Code has been read</span>
</span><span id="Robot.start-1992"><a href="#Robot.start-1992"><span class="linenos">1992</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot.start-1993"><a href="#Robot.start-1993"><span class="linenos">1993</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait2start</span><span class="p">():</span>
</span><span id="Robot.start-1994"><a href="#Robot.start-1994"><span class="linenos">1994</span></a>                    <span class="k">break</span>
</span><span id="Robot.start-1995"><a href="#Robot.start-1995"><span class="linenos">1995</span></a>            
</span><span id="Robot.start-1996"><a href="#Robot.start-1996"><span class="linenos">1996</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Robot.start-1997"><a href="#Robot.start-1997"><span class="linenos">1997</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;While Robot is still active, resume challenge&quot;&quot;&quot;</span>
</span><span id="Robot.start-1998"><a href="#Robot.start-1998"><span class="linenos">1998</span></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_game</span><span class="p">):</span>
</span><span id="Robot.start-1999"><a href="#Robot.start-1999"><span class="linenos">1999</span></a>
</span><span id="Robot.start-2000"><a href="#Robot.start-2000"><span class="linenos">2000</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Robot.start-2001"><a href="#Robot.start-2001"><span class="linenos">2001</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_order_no</span> <span class="o">+=</span><span class="mi">1</span>
</span><span id="Robot.start-2002"><a href="#Robot.start-2002"><span class="linenos">2002</span></a>
</span><span id="Robot.start-2003"><a href="#Robot.start-2003"><span class="linenos">2003</span></a>                    <span class="c1"># Begin challenge with choesn block</span>
</span><span id="Robot.start-2004"><a href="#Robot.start-2004"><span class="linenos">2004</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="Robot.start-2005"><a href="#Robot.start-2005"><span class="linenos">2005</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*** Picking Up </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="Robot.start-2006"><a href="#Robot.start-2006"><span class="linenos">2006</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="Robot.start-2007"><a href="#Robot.start-2007"><span class="linenos">2007</span></a>                
</span><span id="Robot.start-2008"><a href="#Robot.start-2008"><span class="linenos">2008</span></a>                    <span class="c1"># Track the number of times robot drives to search area</span>
</span><span id="Robot.start-2009"><a href="#Robot.start-2009"><span class="linenos">2009</span></a>                    <span class="n">search</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Robot.start-2010"><a href="#Robot.start-2010"><span class="linenos">2010</span></a>                    
</span><span id="Robot.start-2011"><a href="#Robot.start-2011"><span class="linenos">2011</span></a>                    <span class="c1"># Drive robot to center of arena, get view of toy blocks and begin</span>
</span><span id="Robot.start-2012"><a href="#Robot.start-2012"><span class="linenos">2012</span></a>                    <span class="c1"># extracting blocks</span>
</span><span id="Robot.start-2013"><a href="#Robot.start-2013"><span class="linenos">2013</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clutter_env</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;cluttered environment&#39;</span><span class="p">)</span>
</span><span id="Robot.start-2014"><a href="#Robot.start-2014"><span class="linenos">2014</span></a>                
</span><span id="Robot.start-2015"><a href="#Robot.start-2015"><span class="linenos">2015</span></a>                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Robot.start-2016"><a href="#Robot.start-2016"><span class="linenos">2016</span></a>                
</span><span id="Robot.start-2017"><a href="#Robot.start-2017"><span class="linenos">2017</span></a>                        <span class="c1"># Begin by scanning for toy block object</span>
</span><span id="Robot.start-2018"><a href="#Robot.start-2018"><span class="linenos">2018</span></a>                        <span class="n">degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan4object</span><span class="p">()</span>
</span><span id="Robot.start-2019"><a href="#Robot.start-2019"><span class="linenos">2019</span></a>                        
</span><span id="Robot.start-2020"><a href="#Robot.start-2020"><span class="linenos">2020</span></a>                        <span class="c1"># Take image and save to video object</span>
</span><span id="Robot.start-2021"><a href="#Robot.start-2021"><span class="linenos">2021</span></a>                        <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot.start-2022"><a href="#Robot.start-2022"><span class="linenos">2022</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot.start-2023"><a href="#Robot.start-2023"><span class="linenos">2023</span></a>                        
</span><span id="Robot.start-2024"><a href="#Robot.start-2024"><span class="linenos">2024</span></a>                        <span class="c1"># Drive toward block if successful, else pivot to</span>
</span><span id="Robot.start-2025"><a href="#Robot.start-2025"><span class="linenos">2025</span></a>                        <span class="c1"># a free space and drive</span>
</span><span id="Robot.start-2026"><a href="#Robot.start-2026"><span class="linenos">2026</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span>
</span><span id="Robot.start-2027"><a href="#Robot.start-2027"><span class="linenos">2027</span></a>                            <span class="c1">#self._logger(f&quot;Pivoting Robot towards {self._block_now} block&quot;)</span>
</span><span id="Robot.start-2028"><a href="#Robot.start-2028"><span class="linenos">2028</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span><span class="n">steady</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot.start-2029"><a href="#Robot.start-2029"><span class="linenos">2029</span></a>                            
</span><span id="Robot.start-2030"><a href="#Robot.start-2030"><span class="linenos">2030</span></a>                            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot.start-2031"><a href="#Robot.start-2031"><span class="linenos">2031</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot.start-2032"><a href="#Robot.start-2032"><span class="linenos">2032</span></a>                            <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span><span class="n">__</span><span class="o">=</span> <span class="n">cntr_bbox</span><span class="o">.</span><span class="n">bbox_detect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_image</span><span class="p">())</span>
</span><span id="Robot.start-2033"><a href="#Robot.start-2033"><span class="linenos">2033</span></a>                            <span class="c1">#cntr_bbox.img_show(&quot;Detecting Block&quot;,self._img_frame)</span>
</span><span id="Robot.start-2034"><a href="#Robot.start-2034"><span class="linenos">2034</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot.start-2035"><a href="#Robot.start-2035"><span class="linenos">2035</span></a>                            
</span><span id="Robot.start-2036"><a href="#Robot.start-2036"><span class="linenos">2036</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Drive Robot forward to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_block_now</span><span class="si">}</span><span class="s2"> block&quot;</span><span class="p">)</span>
</span><span id="Robot.start-2037"><a href="#Robot.start-2037"><span class="linenos">2037</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_go2block</span><span class="p">()</span>
</span><span id="Robot.start-2038"><a href="#Robot.start-2038"><span class="linenos">2038</span></a>                            
</span><span id="Robot.start-2039"><a href="#Robot.start-2039"><span class="linenos">2039</span></a>                            <span class="c1"># # Update global x and y</span>
</span><span id="Robot.start-2040"><a href="#Robot.start-2040"><span class="linenos">2040</span></a>                            <span class="c1"># self.global_x += self._x</span>
</span><span id="Robot.start-2041"><a href="#Robot.start-2041"><span class="linenos">2041</span></a>                            <span class="c1"># self.global_y += self._y</span>
</span><span id="Robot.start-2042"><a href="#Robot.start-2042"><span class="linenos">2042</span></a>                            
</span><span id="Robot.start-2043"><a href="#Robot.start-2043"><span class="linenos">2043</span></a>                            <span class="c1">##self._logger(f&quot;{self._name} is now at x- {self.global_x} and y- {self.global_y}&quot;)</span>
</span><span id="Robot.start-2044"><a href="#Robot.start-2044"><span class="linenos">2044</span></a>                            
</span><span id="Robot.start-2045"><a href="#Robot.start-2045"><span class="linenos">2045</span></a>                            <span class="c1"># Take image and save to video object</span>
</span><span id="Robot.start-2046"><a href="#Robot.start-2046"><span class="linenos">2046</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_picam_frame</span><span class="p">()</span>
</span><span id="Robot.start-2047"><a href="#Robot.start-2047"><span class="linenos">2047</span></a>                            <span class="c1">#cntr_bbox.img_show(&quot;Arrived at Block&quot;,self._img_frame)</span>
</span><span id="Robot.start-2048"><a href="#Robot.start-2048"><span class="linenos">2048</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img_frame</span><span class="p">)</span>
</span><span id="Robot.start-2049"><a href="#Robot.start-2049"><span class="linenos">2049</span></a>                            
</span><span id="Robot.start-2050"><a href="#Robot.start-2050"><span class="linenos">2050</span></a>                            <span class="c1">##self._logger(f&quot;Pick up {self._block_now} block with gripper&quot;)</span>
</span><span id="Robot.start-2051"><a href="#Robot.start-2051"><span class="linenos">2051</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_pick_up</span><span class="p">()</span>
</span><span id="Robot.start-2052"><a href="#Robot.start-2052"><span class="linenos">2052</span></a>                            
</span><span id="Robot.start-2053"><a href="#Robot.start-2053"><span class="linenos">2053</span></a>                            <span class="c1"># Drive robot to construction zone to place block</span>
</span><span id="Robot.start-2054"><a href="#Robot.start-2054"><span class="linenos">2054</span></a>                            <span class="c1">##self._logger(f&quot;Take {self._block_now} block to construction zone&quot;)</span>
</span><span id="Robot.start-2055"><a href="#Robot.start-2055"><span class="linenos">2055</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">const_zone</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;construction zone&#39;</span><span class="p">)</span>
</span><span id="Robot.start-2056"><a href="#Robot.start-2056"><span class="linenos">2056</span></a>                            
</span><span id="Robot.start-2057"><a href="#Robot.start-2057"><span class="linenos">2057</span></a>                            <span class="c1">#self._logger(f&quot;Place {self._block_now} block inside construction zone&quot;)</span>
</span><span id="Robot.start-2058"><a href="#Robot.start-2058"><span class="linenos">2058</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_place</span><span class="p">()</span>
</span><span id="Robot.start-2059"><a href="#Robot.start-2059"><span class="linenos">2059</span></a>                            
</span><span id="Robot.start-2060"><a href="#Robot.start-2060"><span class="linenos">2060</span></a><span class="c1">#                             #self._logger(&quot;Localizing to get accurate location of robot&quot;)</span>
</span><span id="Robot.start-2061"><a href="#Robot.start-2061"><span class="linenos">2061</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_localize</span><span class="p">()</span>
</span><span id="Robot.start-2062"><a href="#Robot.start-2062"><span class="linenos">2062</span></a>                            
</span><span id="Robot.start-2063"><a href="#Robot.start-2063"><span class="linenos">2063</span></a>                            <span class="c1">##self._logger(f&quot;Pick up and place the next order in the queue&quot;)</span>
</span><span id="Robot.start-2064"><a href="#Robot.start-2064"><span class="linenos">2064</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Robot.start-2065"><a href="#Robot.start-2065"><span class="linenos">2065</span></a>                            <span class="k">break</span>
</span><span id="Robot.start-2066"><a href="#Robot.start-2066"><span class="linenos">2066</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Robot.start-2067"><a href="#Robot.start-2067"><span class="linenos">2067</span></a>                            <span class="c1">#self._logger(&quot;No toy blocks found in current pose. Change pose and&quot;)</span>
</span><span id="Robot.start-2068"><a href="#Robot.start-2068"><span class="linenos">2068</span></a>                            <span class="c1">#self._logger(&quot;try again.&quot;)</span>
</span><span id="Robot.start-2069"><a href="#Robot.start-2069"><span class="linenos">2069</span></a>                            
</span><span id="Robot.start-2070"><a href="#Robot.start-2070"><span class="linenos">2070</span></a>                            <span class="c1"># Drive robot to the predetermined survey locations</span>
</span><span id="Robot.start-2071"><a href="#Robot.start-2071"><span class="linenos">2071</span></a>                            <span class="k">if</span> <span class="n">search</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Robot.start-2072"><a href="#Robot.start-2072"><span class="linenos">2072</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_survey_loc</span><span class="p">[</span><span class="n">search</span><span class="p">],</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;Alternative survey area&#39;</span><span class="p">)</span>
</span><span id="Robot.start-2073"><a href="#Robot.start-2073"><span class="linenos">2073</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Robot.start-2074"><a href="#Robot.start-2074"><span class="linenos">2074</span></a>                                <span class="c1">#self._logger(f&quot;Robot can&#39;t find {self._block_now} block in time.&quot;)</span>
</span><span id="Robot.start-2075"><a href="#Robot.start-2075"><span class="linenos">2075</span></a>                                <span class="c1">#self._logger(&quot;In pursuit of time, moving on to next block in queue&quot;)</span>
</span><span id="Robot.start-2076"><a href="#Robot.start-2076"><span class="linenos">2076</span></a>                                <span class="k">break</span>
</span><span id="Robot.start-2077"><a href="#Robot.start-2077"><span class="linenos">2077</span></a>                            <span class="n">search</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Robot.start-2078"><a href="#Robot.start-2078"><span class="linenos">2078</span></a>                            
</span><span id="Robot.start-2079"><a href="#Robot.start-2079"><span class="linenos">2079</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Robot.start-2080"><a href="#Robot.start-2080"><span class="linenos">2080</span></a>                <span class="c1">#self._logger(f&quot;Mission complete. Take robot back to home base&quot;)</span>
</span><span id="Robot.start-2081"><a href="#Robot.start-2081"><span class="linenos">2081</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_go2</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pt</span><span class="p">,</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;home base&#39;</span><span class="p">)</span>
</span><span id="Robot.start-2082"><a href="#Robot.start-2082"><span class="linenos">2082</span></a>                <span class="k">return</span> 
</span><span id="Robot.start-2083"><a href="#Robot.start-2083"><span class="linenos">2083</span></a>        
</span><span id="Robot.start-2084"><a href="#Robot.start-2084"><span class="linenos">2084</span></a>        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot.start-2085"><a href="#Robot.start-2085"><span class="linenos">2085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</span><span id="Robot.start-2086"><a href="#Robot.start-2086"><span class="linenos">2086</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="Robot.start-2087"><a href="#Robot.start-2087"><span class="linenos">2087</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot.start-2088"><a href="#Robot.start-2088"><span class="linenos">2088</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Robot.start-2089"><a href="#Robot.start-2089"><span class="linenos">2089</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span><span id="Robot.start-2090"><a href="#Robot.start-2090"><span class="linenos">2090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Robot.start-2091"><a href="#Robot.start-2091"><span class="linenos">2091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gameover</span><span class="p">()</span>
</span><span id="Robot.start-2092"><a href="#Robot.start-2092"><span class="linenos">2092</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Robot.start-2093"><a href="#Robot.start-2093"><span class="linenos">2093</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>The sequence of actions occuring while baron robot works to pick and place
all toy blocks to the construction zone. This function lists the steps needed
for the robot to complete the orders passed to it at the beginning of competition</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>order:</strong>  List[Blocks] list of all toy blocks needed to complete challenge</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
</body>
</html>